<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 10 | Michelson Labs</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
    <meta name="description" content="This chapter is going to introduce three complex types of data that are extremely important for your smart contracts.">
    <meta name="image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:title" content="Chapter 10">
    <meta name="twitter:description" content="This chapter is going to introduce three complex types of data that are extremely important for your smart contracts.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:url" content="https://michelson.baking-bad.org/chapters/10.html">
    <meta name="twitter:site" content="@TezosBakingBad">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Chapter 10">
    <meta property="og:description" content="This chapter is going to introduce three complex types of data that are extremely important for your smart contracts.">
    <meta property="og:image" content="https://michelson.baking-bad.org/og.png">
    <meta property="og:url" content="https://michelson.baking-bad.org/chapters/10.html">
    <meta property="og:site_name" content="Michelson Labs">
    <meta itemprop="name" content="Chapter 10">
    <meta itemprop="description" content="This chapter is going to introduce three complex types of data that are extremely important for your smart contracts.">
    <meta itemprop="image" content="https://michelson.baking-bad.org/og.png">
    <link rel="preload" href="/assets/css/0.styles.41c7ef0c.css" as="style"><link rel="preload" href="/assets/js/app.54ffbb4a.js" as="script"><link rel="preload" href="/assets/js/2.430b66b2.js" as="script"><link rel="preload" href="/assets/js/19.b4ac3825.js" as="script"><link rel="preload" href="/assets/js/4.c279c943.js" as="script"><link rel="preload" href="/assets/js/3.550cb5aa.js" as="script"><link rel="prefetch" href="/assets/js/10.39ae3c42.js"><link rel="prefetch" href="/assets/js/11.897dacfb.js"><link rel="prefetch" href="/assets/js/12.083d37d3.js"><link rel="prefetch" href="/assets/js/13.a75e832a.js"><link rel="prefetch" href="/assets/js/14.ff27c1a8.js"><link rel="prefetch" href="/assets/js/15.2d0a9cd5.js"><link rel="prefetch" href="/assets/js/16.51aee1af.js"><link rel="prefetch" href="/assets/js/17.09cee802.js"><link rel="prefetch" href="/assets/js/18.bc1d5da2.js"><link rel="prefetch" href="/assets/js/20.d6a0692d.js"><link rel="prefetch" href="/assets/js/21.2bcbd1eb.js"><link rel="prefetch" href="/assets/js/22.42b58ecc.js"><link rel="prefetch" href="/assets/js/23.cfbbd282.js"><link rel="prefetch" href="/assets/js/24.3069e4b3.js"><link rel="prefetch" href="/assets/js/25.9bb53cdf.js"><link rel="prefetch" href="/assets/js/5.b2436255.js"><link rel="prefetch" href="/assets/js/6.c09f7c7f.js"><link rel="prefetch" href="/assets/js/7.16d6fa11.js"><link rel="prefetch" href="/assets/js/8.c7c848cc.js"><link rel="prefetch" href="/assets/js/9.d1dbceb8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41c7ef0c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_small.png" alt="Michelson Labs" class="logo"> <span class="site-name can-hide">Michelson Labs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learn.html" class="sidebar-link">Learn Michelson</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn.html#why-ðŸ¤”" class="sidebar-link">Why ðŸ¤”</a></li><li class="sidebar-sub-header"><a href="/learn.html#how" class="sidebar-link">How</a></li><li class="sidebar-sub-header"><a href="/learn.html#resources" class="sidebar-link">Resources</a></li><li class="sidebar-sub-header"><a href="/learn.html#contact-us" class="sidebar-link">Contact us</a></li><li class="sidebar-sub-header"><a href="/learn.html#about" class="sidebar-link">About</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Notebooks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction.html" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/introduction.html#try-online" class="sidebar-link">Try online</a></li><li class="sidebar-sub-header"><a href="/introduction.html#run-in-docker" class="sidebar-link">Run in Docker</a></li><li class="sidebar-sub-header"><a href="/introduction.html#install-jupyter" class="sidebar-link">Install Jupyter</a></li><li class="sidebar-sub-header"><a href="/introduction.html#notebook-workflow" class="sidebar-link">Notebook workflow</a></li></ul></li><li><a href="/chapters/01.html" class="sidebar-link">Chapter 1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/01.html#understanding-the-stack" class="sidebar-link">Understanding the stack</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#structure-of-a-smart-contract" class="sidebar-link">Structure of a Smart Contract</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#operation-codes" class="sidebar-link">Operation codes</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#running-the-contract-step-by-step" class="sidebar-link">Running the contract step-by-step</a></li></ul></li><li><a href="/chapters/02.html" class="sidebar-link">Chapter 2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/02.html#types-in-michelson" class="sidebar-link">Types in Michelson</a></li><li class="sidebar-sub-header"><a href="/chapters/02.html#advanced-stack-usage" class="sidebar-link">Advanced stack usage</a></li></ul></li><li><a href="/chapters/03.html" class="sidebar-link">Chapter 3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/03.html#compare-and-generic-comparisons" class="sidebar-link">Compare and generic comparisons</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#conditionals" class="sidebar-link">Conditionals</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#fail-and-assert" class="sidebar-link">FAIL and ASSERT</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#recap" class="sidebar-link">Recap</a></li></ul></li><li><a href="/chapters/04.html" class="sidebar-link">Chapter 4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/04.html#available-types-for-arithmetic-operations" class="sidebar-link">Available types for arithmetic operations</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-add-instruction" class="sidebar-link">The `ADD` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-sub-instruction" class="sidebar-link">The `SUB` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-mul-instruction" class="sidebar-link">The `MUL` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-ediv-instruction" class="sidebar-link">The `EDIV` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#other-operations-on-numeric-values" class="sidebar-link">Other operations on numeric values</a></li></ul></li><li><a href="/chapters/05.html" class="sidebar-link">Chapter 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/05.html#mutez-and-mutez-operations" class="sidebar-link">mutez and mutez operations</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#balance-amount-and-now" class="sidebar-link">`BALANCE`, `AMOUNT` and `NOW`</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#address-contract-and-token-transfer" class="sidebar-link">Address, contract and token transfer</a></li></ul></li><li><a href="/chapters/06.html" class="sidebar-link">Chapter 6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/06.html#boolean-type-and-operations-on-booleans" class="sidebar-link">Boolean type and operations on booleans</a></li><li class="sidebar-sub-header"><a href="/chapters/06.html#cryptographic-operations" class="sidebar-link">Cryptographic operations</a></li></ul></li><li><a href="/chapters/07.html" class="sidebar-link">Chapter 7</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/07.html#strings-and-string-manipulations" class="sidebar-link">Strings and string manipulations</a></li><li class="sidebar-sub-header"><a href="/chapters/07.html#working-with-lists" class="sidebar-link">Working with lists</a></li></ul></li><li><a href="/chapters/08.html" class="sidebar-link">Chapter 8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/08.html#overview-of-the-pair-type" class="sidebar-link">Overview of the pair type</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#operations-on-pairs" class="sidebar-link">Operations on pairs</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#pairing-and-unpairing" class="sidebar-link">Pairing and unpairing</a></li></ul></li><li><a href="/chapters/09.html" class="sidebar-link">Chapter 9</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/09.html#casting-types" class="sidebar-link">Casting types</a></li><li class="sidebar-sub-header"><a href="/chapters/09.html#working-with-bytes" class="sidebar-link">Working with bytes</a></li></ul></li><li><a href="/chapters/10.html" aria-current="page" class="active sidebar-link">Chapter 10</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-sets" class="sidebar-link">Working with sets</a></li><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-maps" class="sidebar-link">Working with maps</a></li></ul></li><li><a href="/chapters/11.html" class="sidebar-link">Chapter 11</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/11.html#the-loop-instruction" class="sidebar-link">The `LOOP` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-sets" class="sidebar-link">Iterating on sets</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-maps" class="sidebar-link">Iterating on maps</a></li></ul></li><li><a href="/chapters/12.html" class="sidebar-link">Chapter 12</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/12.html#union-types-and-entrypoints" class="sidebar-link">Union types and entrypoints</a></li></ul></li><li><a href="/chapters/13.html" class="sidebar-link">Chapter 13</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/13.html#address-and-contract-types" class="sidebar-link">Address and contract types</a></li><li class="sidebar-sub-header"><a href="/chapters/13.html#self-source-and-sender" class="sidebar-link">SELF, SOURCE and SENDER</a></li></ul></li><li><a href="/chapters/14.html" class="sidebar-link">Chapter 14</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/14.html#creating-and-sending-transactions" class="sidebar-link">Creating and sending transactions</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#delegating-contract-funds" class="sidebar-link">Delegating contract funds</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#originating-new-contracts" class="sidebar-link">Originating new contracts</a></li></ul></li><li><a href="/chapters/15.html" class="sidebar-link">Chapter 15</a></li><li><a href="/chapters/99.html" class="sidebar-link">Kernel helpers</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-10"><a href="#chapter-10" class="header-anchor">#</a> Chapter 10</h1> <p>This chapter is going to introduce three complex types of data that are extremely important for your smart contracts.</p> <p>So far, the smart contracts we have written were quite simple: they received data as input, applied some logic to the data and output a result. However, this is not what most contracts do. Smart contracts are an interesting solution to many problems because they can retain information and the new input sent to the contract can be compared and/or used against the data that's already in the contract!</p> <p>In a previous chapter, we introduced the <code>list</code> type. Lists allow us to store multiple values of the same type in an ordered fashion. However, they lack some features that you may need for your smart contract. For example, it is not possible natively to know if a list contains a certain value (i.e without implementing a loop).</p> <p>Michelson provides three other types of values that can store other values: sets, maps and big maps. Their different properties will be explained below but in a nutshell, sets are lists of unique elements, maps are tables where each value matches a unique key and big maps are maps containing a large number of values. Let's start with sets!</p> <h2 id="working-with-sets"><a href="#working-with-sets" class="header-anchor">#</a> Working with sets</h2> <p>Sets are a sorted collection of unique values. A <code>set</code> is like a <code>list</code> with the main difference of storing only unique values in a definite order. While <code>{ 1 ; 2 ; 1 ; 2 ; 1 ; 2 }</code> is a valid value of type <code>(list int)</code>, it wouldn't be a valid value of type <code>(set int)</code>. Here is how to create an empty set:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">set</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">EMPTY_SET</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">1</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * {1})
DROP / (Unit * {1}) =&gt; _
EMPTY_SET / _ =&gt; {}
NIL / _ =&gt; []
PAIR / [] : {} =&gt; ([] * {})
END %default / ([] * {}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                    </th><th>value                                  </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">set</pre></td><td><pre style="text-align:left;">[]</pre></td></tr></tbody></table></div> <p>You can use the <strong><code>EMPTY_SET</code></strong> instruction to create an empty set. It takes 1 argument, the type of the elements you will store in the set. It must be a comparable type: you can, for example, put strings or integers in a set but you cannot put a map or a set inside a set.</p> <p>Next, you want to save some data inside the set. You can use the <strong><code>UPDATE</code></strong> instruction to push new values in the set. This instruction requires a little setup illustrated in the example below:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">set</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">EMPTY_SET</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">True</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">1</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * {1})
DROP / (Unit * {1}) =&gt; _
EMPTY_SET / _ =&gt; {}
PUSH / _ =&gt; True
PUSH / _ =&gt; 5
UPDATE / 5 : True : {} =&gt; {5}
NIL / _ =&gt; []
PAIR / [] : {5} =&gt; ([] * {5})
END %default / ([] * {5}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                          </th><th>value                                   </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">set (int)</pre></td><td><pre style="text-align:left;">[5]</pre></td></tr></tbody></table></div> <p>We could also have used the set in the storage:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">set</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CDR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">True</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">1</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * {1})
CDR / (Unit * {1}) =&gt; {1}
PUSH / _ =&gt; True
PUSH / _ =&gt; 5
UPDATE / 5 : True : {1} =&gt; {1, 5}
NIL / _ =&gt; []
PAIR / [] : {1, 5} =&gt; ([] * {1, 5})
END %default / ([] * {1, 5}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                          </th><th>value                                      </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">set (int)</pre></td><td><pre style="text-align:left;">[1, 5]</pre></td></tr></tbody></table></div> <p>Here is what happens in the stack: the <strong><code>UPDATE</code></strong> instruction requires 3 elements in the stack before proceeding:</p> <ol><li>The element to add to the set</li> <li>A boolean value set to <code>True</code> to indicate that you want to add a new element to the set</li> <li>The set in which you want to store the new value</li></ol> <p>If the element is already present in the stack, the execution will just continue without any change. Otherwise, the new element will be pushed at the head position of the set.</p> <p>If you set the boolean value to <code>False</code> and provide a value that already exists in the set, <strong><code>UPDATE</code></strong> will remove this element from the set:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">set</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CDR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">False</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">1</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">2</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * {1, 2, 3, 4, 5})
CDR / (Unit * {1, 2, 3, 4, 5}) =&gt; {1, 2, 3, 4, 5}
PUSH / _ =&gt; False
PUSH / _ =&gt; 5
UPDATE / 5 : False : {1, 2, 3, 4, 5} =&gt; {1, 2, 3, 4}
NIL / _ =&gt; []
PAIR / [] : {1, 2, 3, 4} =&gt; ([] * {1, 2, 3, 4})
END %default / ([] * {1, 2, 3, 4}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                          </th><th>value                                            </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">set (int)</pre></td><td><pre style="text-align:left;">[1, 2, 3, 4]</pre></td></tr></tbody></table></div> <p>Now you understand why you must set up correctly the stack before using <strong><code>UPDATE</code></strong>: the 3 required elements must be in the right order and the boolean element must be set to the right value in order to add or remove a value from the set. Here is a more complex example:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">set</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">pair</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">UNPPAIAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">True</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">False</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">Pair</span><span class="token punctuation"> </span><span class="token number">&quot;mango&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;apple&quot;</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">&quot;apple&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;strawberry&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (('mango' * 'apple') * {'apple', 'banana', 'strawberry'})
UNPAIR / (('mango' * 'apple') * {'apple', 'banana', 'strawberry'}) =&gt; ('mango' * 'apple') : {'apple', 'banana', 'strawberry'}
UNPAIR / ('mango' * 'apple') =&gt; 'mango' : 'apple'
DIP / * =&gt; _
SWAP / 'apple' : {'apple', 'banana', 'strawberry'} =&gt; {'apple', 'banana', 'strawberry'} : 'apple'
DIP 1 / _ =&gt; *
PUSH / _ =&gt; True
SWAP / True : 'mango' =&gt; 'mango' : True
UPDATE / 'mango' : True : {'apple', 'banana', 'strawberry'} =&gt; {'apple', 'banana', 'mango', 'strawberry'}
SWAP / {'apple', 'banana', 'mango', 'strawberry'} : 'apple' =&gt; 'apple' : {'apple', 'banana', 'mango', 'strawberry'}
PUSH / _ =&gt; False
SWAP / False : 'apple' =&gt; 'apple' : False
UPDATE / 'apple' : False : {'apple', 'banana', 'mango', 'strawberry'} =&gt; {'banana', 'mango', 'strawberry'}
NIL / _ =&gt; []
PAIR / [] : {'banana', 'mango', 'strawberry'} =&gt; ([] * {'banana', 'mango', 'strawberry'})
END %default / ([] * {'banana', 'mango', 'strawberry'}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                             </th><th>value                                                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">set (string)</pre></td><td><pre style="text-align:left;">['banana', 'mango', 'strawberry']</pre></td></tr></tbody></table></div> <p>First, we deconstruct the parameter with <strong><code>UNPPAIAIR</code></strong> to get our two fruits on the stack with the set of fruits below. Then, we push <em>mango</em> into the set of fruits before removing <em>apple</em>. A few <strong><code>SWAP</code></strong> instructions are necessary to put all the elements in the right order. Observe how the boolean values are set to <code>True</code> and <code>False</code> according to the effect you want to create on the set.</p> <p>Before trying to remove or add a value to a set, it would be great to check if the value is already inside. This is what you can achieve with the <strong><code>MEM</code></strong> instruction:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">set</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">UNPAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">MEM</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">True</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;mango&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">&quot;apple&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;strawberry&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('mango' * {'apple', 'banana', 'strawberry'})
UNPAIR / ('mango' * {'apple', 'banana', 'strawberry'}) =&gt; 'mango' : {'apple', 'banana', 'strawberry'}
DIP / * =&gt; _
DUP / {'apple', 'banana', 'strawberry'} =&gt; {'apple', 'banana', 'strawberry'} : {'apple', 'banana', 'strawberry'}
DIP 1 / _ =&gt; *
DUP / 'mango' =&gt; 'mango' : 'mango'
DIP / * =&gt; _
SWAP / 'mango' : {'apple', 'banana', 'strawberry'} =&gt; {'apple', 'banana', 'strawberry'} : 'mango'
DIP 1 / _ =&gt; *
MEM / 'mango' : {'apple', 'banana', 'strawberry'} =&gt; False
IF / False =&gt; _
PUSH / _ =&gt; True
SWAP / True : 'mango' =&gt; 'mango' : True
UPDATE / 'mango' : True : {'apple', 'banana', 'strawberry'} =&gt; {'apple', 'banana', 'mango', 'strawberry'}
NIL / _ =&gt; []
PAIR / [] : {'apple', 'banana', 'mango', 'strawberry'} =&gt; ([] * {'apple', 'banana', 'mango', 'strawberry'})
END %default / ([] * {'apple', 'banana', 'mango', 'strawberry'}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                             </th><th>value                                                                          </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">set (string)</pre></td><td><pre style="text-align:left;">['apple', 'banana', 'mango', 'strawberry']</pre></td></tr></tbody></table></div> <p>In this contract, we duplicate the values passed in the parameter because <strong><code>MEM</code></strong> is going to remove the element and the set we want to test. If the value is not in the set, it will be added, otherwise, the contract will fail. As expected, <em>mango</em> is not in the set, so the value gets added to the final set. If you replace <em>mango</em> with <em>apple</em>, you will see the contract fail.</p> <p>As it is also the case for other types storing multiple values, you can check the size of a set by using the <strong><code>SIZE</code></strong> instruction:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">set</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SIZE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">&quot;apple&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;strawberry&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ({'apple', 'banana', 'strawberry'} * 0)
CAR / ({'apple', 'banana', 'strawberry'} * 0) =&gt; {'apple', 'banana', 'strawberry'}
SIZE / {'apple', 'banana', 'strawberry'} =&gt; 3
NIL / _ =&gt; []
PAIR / [] : 3 =&gt; ([] * 3)
END %default / ([] * 3) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                    </th><th>value                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">nat</pre></td><td><pre style="text-align:left;">3</pre></td></tr></tbody></table></div> <p>The <strong><code>SIZE</code></strong> instruction returns a value of type <code>nat</code>. Add more strings to the set to see it working!</p> <h2 id="working-with-maps"><a href="#working-with-maps" class="header-anchor">#</a> Working with maps</h2> <p>Maps and big maps are probably the type of complex values you will work with most of the time. As big maps are a kind of map, we start with maps!</p> <p>Maps provide a very convenient way of storing data: they are like a table with two columns, a simple value on the left side that you can use to retrieve the data on the right side. This allows to store complex data that you can find very quickly and easily. For example, in a token contract, you can associate an address with its balance and the chosen allowances. When creating a new map, you have to specifiy the type of the keys and the type of the values, as you won't be able to store data that are not of the specified type. Here is how to create an empty map:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">EMPTY_MAP</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * {})
DROP / (Unit * {}) =&gt; _
EMPTY_MAP / _ =&gt; {}
NIL / _ =&gt; []
PAIR / [] : {} =&gt; ([] * {})
END %default / ([] * {}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                                  </th><th>value                                  </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">map (address nat)</pre></td><td><pre style="text-align:left;">{}</pre></td></tr></tbody></table></div> <p>You can use any type you want as a key as long as it is a comparable type. Note also that map keys are lexicographically sorted.</p> <p>Adding and removing values from a map is going to be a little easier than doing it with a set ðŸ˜… However, we are going to use the same instruction, <strong><code>UPDATE</code></strong>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">EMPTY_MAP</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">option</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">Some</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token number">&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * {})
DROP / (Unit * {}) =&gt; _
EMPTY_MAP / _ =&gt; {}
PUSH / _ =&gt; 5?
PUSH / _ =&gt; tz1VSUâ€¦cjb
UPDATE / tz1VSUâ€¦cjb : 5? : {} =&gt; {tz1VSUâ€¦cjb: 5}
NIL / _ =&gt; []
PAIR / [] : {tz1VSUâ€¦cjb: 5} =&gt; ([] * {tz1VSUâ€¦cjb: 5})
END %default / ([] * {tz1VSUâ€¦cjb: 5}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                                  </th><th>value                                                                           </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">map (address nat)</pre></td><td><pre style="text-align:left;">{'tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb': 5}</pre></td></tr></tbody></table></div> <p>In order to add a new key/pair value to a map, the stack must have three elements in the following order:</p> <ol><li>The key associated to the value to add</li> <li>The value you want to add</li> <li>The map that you want to update</li></ol> <p>When the stack is correctly set up, you can call the <strong><code>UPDATE</code></strong> instruction. It is important that the value you use to update the map is an <code>optional</code> value with an argument whose type is going to be the expected type of the values in the map. If you use <code>(Some type)</code>, you will add a new value to the map. However, if you use <code>(None)</code>, you will remove the value at the provided key:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CDR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">option</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">None</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token number">&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;tz1UVzNHTxMzkPn1uMXaSCTJYBQQc4x5dyNE&quot;</span><span class="token punctuation"> </span><span class="token number">10</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5})
CDR / (Unit * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}) =&gt; {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}
PUSH / _ =&gt; None
PUSH / _ =&gt; tz1VSUâ€¦cjb
UPDATE / tz1VSUâ€¦cjb : None : {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5} =&gt; {tz1UVzâ€¦yNE: 10}
NIL / _ =&gt; []
PAIR / [] : {tz1UVzâ€¦yNE: 10} =&gt; ([] * {tz1UVzâ€¦yNE: 10})
END %default / ([] * {tz1UVzâ€¦yNE: 10}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                                  </th><th>value                                                                            </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">map (address nat)</pre></td><td><pre style="text-align:left;">{'tz1UVzNHTxMzkPn1uMXaSCTJYBQQc4x5dyNE': 10}</pre></td></tr></tbody></table></div> <p>As you can see from this example, giving a <code>(None)</code> value to the map value before calling <strong><code>UPDATE</code></strong> will remove the corresponding key/value pair. If the key doesn't exist, this will have no effect on the map or the contract. Because of this, you may want to check first if a key exists in a map before removing it or updating it. This is what the <strong><code>MEM</code></strong> instruction is for:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token number">&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">MEM</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;tz1UVzNHTxMzkPn1uMXaSCTJYBQQc4x5dyNE&quot;</span><span class="token punctuation"> </span><span class="token number">10</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token number">False</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ({tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5} * False)
CAR / ({tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5} * False) =&gt; {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}
PUSH / _ =&gt; tz1VSUâ€¦cjb
MEM / tz1VSUâ€¦cjb : {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5} =&gt; True
NIL / _ =&gt; []
PAIR / [] : True =&gt; ([] * True)
END %default / ([] * True) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                     </th><th>value                                    </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">bool</pre></td><td><pre style="text-align:left;">True</pre></td></tr></tbody></table></div> <p>This very simple contract checks if a single address is present in the map passed as a parameter. Please remember that <strong><code>MEM</code></strong> is going to pop the key and the map from the stack, so you should duplicate them if you want to use them later:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">UNPAIR</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">UNPAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">MEM</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">option</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">None</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token comment">## Removes key/value pair if exists</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">option</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">Some</span><span class="token punctuation"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## Adds key/value pair if doesn't exist</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDDrzB&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;tz1UVzNHTxMzkPn1uMXaSCTJYBQQc4x5dyNE&quot;</span><span class="token punctuation"> </span><span class="token number">10</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (tz1NhNâ€¦rzB * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5})
DUP / (tz1NhNâ€¦rzB * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}) =&gt; (tz1NhNâ€¦rzB * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}) : (tz1NhNâ€¦rzB * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5})
DIP / * =&gt; _
UNPAIR / (tz1NhNâ€¦rzB * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}) =&gt; tz1NhNâ€¦rzB : {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}
DIP 1 / _ =&gt; *
UNPAIR / (tz1NhNâ€¦rzB * {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}) =&gt; tz1NhNâ€¦rzB : {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}
MEM / tz1NhNâ€¦rzB : {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5} =&gt; False
IF / False =&gt; _
PUSH / _ =&gt; 1?
SWAP / 1? : tz1NhNâ€¦rzB =&gt; tz1NhNâ€¦rzB : 1?
UPDATE / tz1NhNâ€¦rzB : 1? : {tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5} =&gt; {tz1NhNâ€¦rzB: 1, tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}
NIL / _ =&gt; []
PAIR / [] : {tz1NhNâ€¦rzB: 1, tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5} =&gt; ([] * {tz1NhNâ€¦rzB: 1, tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5})
END %default / ([] * {tz1NhNâ€¦rzB: 1, tz1UVzâ€¦yNE: 10, tz1VSUâ€¦cjb: 5}) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                                  </th><th>value                                                                                                                                                                  </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">map (address nat)</pre></td><td><pre style="text-align:left;">{'tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDDrzB': 1, 'tz1UVzNHTxMzkPn1uMXaSCTJYBQQc4x5dyNE': 10, 'tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb': 5}</pre></td></tr></tbody></table></div> <p>The provided address was not a value in the map, so the contract added it and gave it a balance of <code>1</code>. Now, if you change the address in the parameter for an address that's already in the map, you will see it disappear in the final map!</p> <p>After checking if a key exists in a map, you probably want to get the value that's associated with it! Michelson provides the <strong><code>GET</code></strong> instruction to retrieve values bound to a key in a map:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">pair</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">UNPAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">GET</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF_NONE</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;none&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">Pair</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;apple&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;green&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;yellow&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;cherry&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;red&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}) * '')
CAR / (('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}) * '') =&gt; ('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'})
UNPAIR / ('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}) =&gt; 'banana' : {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}
GET / 'banana' : {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'} =&gt; 'yellow'?
IF_NONE / 'yellow'? =&gt; 'yellow'
NIL / _ =&gt; []
PAIR / [] : 'yellow' =&gt; ([] * 'yellow')
END %default / ([] * 'yellow') =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                       </th><th>value                                      </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">yellow</pre></td></tr></tbody></table></div> <p>This very simple code sends a string and a map to the contract that will check if the string is a key in the map. If it is, it will save the color of the fruit in the storage. If it is not, it will save <code>&quot;none&quot;</code> in the storage instead. We could also have gone a different road and used <strong><code>IF_SOME</code></strong> to check if the <strong><code>GET</code></strong> instruction returns anything:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">pair</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">UNPAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">GET</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">IF_SOME</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;none&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">Pair</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;apple&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;green&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;yellow&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;cherry&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;red&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}) * '')
CAR / (('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}) * '') =&gt; ('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'})
UNPAIR / ('banana' * {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}) =&gt; 'banana' : {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'}
GET / 'banana' : {'apple': 'green', 'banana': 'yellow', 'cherry': 'red'} =&gt; 'yellow'?
IF_NONE / 'yellow'? =&gt; 'yellow'
NIL / _ =&gt; []
PAIR / [] : 'yellow' =&gt; ([] * 'yellow')
END %default / ([] * 'yellow') =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                       </th><th>value                                      </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">yellow</pre></td></tr></tbody></table></div> <p>Whether you use <strong><code>IF_NONE</code></strong> or <strong><code>IF_SOME</code></strong>, if a value is found, it will be unwrapped from the optional value and dumped onto the stack. In this example, the values in the map are of type <code>string</code>, so <strong><code>GET</code></strong> returns <code>(Some string)</code> and <strong><code>IF_NONE</code></strong>/<strong><code>IF_SOME</code></strong> unwraps it and brings <code>string</code> to the stack.</p> <p>There is a last instruction to check before ending our tour of maps. Michelson provides an instruction to know the size of a given map, you guessed it, <strong><code>SIZE</code></strong>!</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">map</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SIZE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;apple&quot;</span><span class="token punctuation"> </span><span class="token number">32</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token number">24</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">Elt</span><span class="token punctuation"> </span><span class="token number">&quot;cherry&quot;</span><span class="token punctuation"> </span><span class="token number">16</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ({'apple': 32, 'banana': 24, 'cherry': 16} * 0)
CAR / ({'apple': 32, 'banana': 24, 'cherry': 16} * 0) =&gt; {'apple': 32, 'banana': 24, 'cherry': 16}
SIZE / {'apple': 32, 'banana': 24, 'cherry': 16} =&gt; 3
NIL / _ =&gt; []
PAIR / [] : 3 =&gt; ([] * 3)
END %default / ([] * 3) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                    </th><th>value                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">nat</pre></td><td><pre style="text-align:left;">3</pre></td></tr></tbody></table></div> <p>As usual, this kind of instruction returns a <code>nat</code> value.</p> <p>Now that you have a better understanding of <code>maps</code> in Michelson, we can check <code>big maps</code>. Under the hood, big maps are actually maps. The only major difference is that when Michelson loads a map into memory, it goes through all the key/value pairs and get them ready to be used by your code. This consumes gas and can become very expensive if the map is huge. In the case of a big map, Michelson does not prepare the map and will only access the key/value pair you request. This will be a lot cheaper than using a map with a big drawback though: you won't get any information about the map outside of the key/value pair you are trying to access. This means instructions available on <code>map</code> like <strong><code>SIZE</code></strong>, as well as iterative instructions like <strong><code>ITER</code></strong> and <strong><code>MAP</code></strong>, are not possible on <code>big_map</code> (more on that in the next chapter). The only instructions you can use with big maps are <strong><code>EMPTY_BIG_MAP</code></strong>, <strong><code>GET</code></strong>, <strong><code>MEM</code></strong> and <strong><code>UPDATE</code></strong>. Let's try to create an example that uses all the available instructions for big maps!</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">big_map</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">EMPTY_BIG_MAP</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">15</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SOME</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;cherry&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">22</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SOME</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;banana&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;cherry&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">MEM</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">GET</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">IF_SOME</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">ADD</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">SOME</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">UPDATE</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; (Unit * &lt;-1&gt;)
DROP / (Unit * &lt;-1&gt;) =&gt; _
EMPTY_BIG_MAP / _ =&gt; &lt;-2&gt;
PUSH / _ =&gt; 15
SOME / 15 =&gt; 15?
PUSH / _ =&gt; 'cherry'
UPDATE / 'cherry' : 15? : &lt;-2&gt; =&gt; &lt;-2&gt;
PUSH / _ =&gt; 22
SOME / 22 =&gt; 22?
PUSH / _ =&gt; 'banana'
UPDATE / 'banana' : 22? : &lt;-2&gt; =&gt; &lt;-2&gt;
DUP / &lt;-2&gt; =&gt; &lt;-2&gt; : &lt;-2&gt;
PUSH / _ =&gt; 'cherry'
DUP / 'cherry' =&gt; 'cherry' : 'cherry'
SWAP / 'cherry' : 'cherry' =&gt; 'cherry' : 'cherry'
DIP / * =&gt; _
SWAP / 'cherry' : &lt;-2&gt; =&gt; &lt;-2&gt; : 'cherry'
DIP 1 / _ =&gt; *
MEM / 'cherry' : &lt;-2&gt; =&gt; True
IF / True =&gt; _
DIP / * =&gt; _
DUP / &lt;-2&gt; =&gt; &lt;-2&gt; : &lt;-2&gt;
DIP 1 / _ =&gt; *
DUP / 'cherry' =&gt; 'cherry' : 'cherry'
DIP / * =&gt; _
SWAP / 'cherry' : &lt;-2&gt; =&gt; &lt;-2&gt; : 'cherry'
DIP 1 / _ =&gt; *
GET / 'cherry' : &lt;-2&gt; =&gt; 15?
IF_NONE / 15? =&gt; 15
PUSH / _ =&gt; 5
ADD / 5 : 15 =&gt; 20
SOME / 20 =&gt; 20?
SWAP / 20? : 'cherry' =&gt; 'cherry' : 20?
UPDATE / 'cherry' : 20? : &lt;-2&gt; =&gt; &lt;-2&gt;
NIL / _ =&gt; []
PAIR / [] : &lt;-2&gt; =&gt; ([] * &lt;-2&gt;)
END %default / ([] * &lt;-2&gt;) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                                     </th><th>value                                  </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">big_map (string nat)</pre></td><td><pre style="text-align:left;">-2</pre></td></tr></tbody></table></div> <p>This example is a little far-fetched but it demonstrates how you can use the different instructions available with big maps.</p> <div id="bottom-right-wrapper" class="fab-wrapper" style="right:5vw;bottom:4vh;z-index:999;position:fixed;" data-v-f9cfe6e4><div id="bottom-right-action" class="actions-container" style="bottom:-20px;padding-bottom:20px;" data-v-f9cfe6e4><ul class="fab-list" style="display:none;" data-v-f9cfe6e4 data-v-f9cfe6e4><!----><!----></ul></div> <div class="fab-main pointer" style="background-color:#c6b29b;padding:28px;" data-v-f9cfe6e4><i class="md-24 material-icons main" data-v-f9cfe6e4>add</i> <i class="md-24 material-icons close" data-v-f9cfe6e4>add</i></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/chapters/09.html" class="prev">
        Chapter 9
      </a></span> <span class="next"><a href="/chapters/11.html">
        Chapter 11
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.54ffbb4a.js" defer></script><script src="/assets/js/2.430b66b2.js" defer></script><script src="/assets/js/19.b4ac3825.js" defer></script><script src="/assets/js/4.c279c943.js" defer></script><script src="/assets/js/3.550cb5aa.js" defer></script>
  </body>
</html>
