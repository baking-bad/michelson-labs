<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 3 | Michelson Labs</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
    <meta name="description" content="Interactive learning course">
    <link rel="preload" href="/assets/css/0.styles.86ed2476.css" as="style"><link rel="preload" href="/assets/js/app.3bc4d0dc.js" as="script"><link rel="preload" href="/assets/js/2.f4f16137.js" as="script"><link rel="preload" href="/assets/js/11.50879eea.js" as="script"><link rel="preload" href="/assets/js/4.ac851716.js" as="script"><link rel="preload" href="/assets/js/3.2c98d5d1.js" as="script"><link rel="prefetch" href="/assets/js/10.b65f81b5.js"><link rel="prefetch" href="/assets/js/12.9f4477a1.js"><link rel="prefetch" href="/assets/js/13.871518a0.js"><link rel="prefetch" href="/assets/js/14.31b3c10a.js"><link rel="prefetch" href="/assets/js/15.376c5f77.js"><link rel="prefetch" href="/assets/js/16.f6f0de8c.js"><link rel="prefetch" href="/assets/js/17.3b673c56.js"><link rel="prefetch" href="/assets/js/18.dd8f9148.js"><link rel="prefetch" href="/assets/js/19.e0a1a628.js"><link rel="prefetch" href="/assets/js/20.dc822c9e.js"><link rel="prefetch" href="/assets/js/21.26d015f6.js"><link rel="prefetch" href="/assets/js/22.39bfed70.js"><link rel="prefetch" href="/assets/js/23.1b0ba217.js"><link rel="prefetch" href="/assets/js/24.01c9793a.js"><link rel="prefetch" href="/assets/js/5.464f1237.js"><link rel="prefetch" href="/assets/js/6.f8279457.js"><link rel="prefetch" href="/assets/js/7.7079b0c4.js"><link rel="prefetch" href="/assets/js/8.f2522e14.js"><link rel="prefetch" href="/assets/js/9.a6b0ba72.js">
    <link rel="stylesheet" href="/assets/css/0.styles.86ed2476.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Michelson Labs" class="logo"> <span class="site-name can-hide">Michelson Labs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learn.html" class="sidebar-link">Learn Michelson</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn.html#why-ðŸ¤”" class="sidebar-link">Why ðŸ¤”</a></li><li class="sidebar-sub-header"><a href="/learn.html#how" class="sidebar-link">How</a></li><li class="sidebar-sub-header"><a href="/learn.html#resources" class="sidebar-link">Resources</a></li><li class="sidebar-sub-header"><a href="/learn.html#contact-us" class="sidebar-link">Contact us</a></li><li class="sidebar-sub-header"><a href="/learn.html#about" class="sidebar-link">About</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Notebooks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction.html" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/introduction.html#notebook-workflow" class="sidebar-link">Notebook workflow</a></li><li class="sidebar-sub-header"><a href="/introduction.html#run-online" class="sidebar-link">Run online</a></li><li class="sidebar-sub-header"><a href="/introduction.html#run-in-docker" class="sidebar-link">Run in Docker</a></li><li class="sidebar-sub-header"><a href="/introduction.html#install-jupyter" class="sidebar-link">Install Jupyter</a></li></ul></li><li><a href="/chapters/01.html" class="sidebar-link">Chapter 1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/01.html#understanding-the-stack" class="sidebar-link">Understanding the stack</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#structure-of-a-smart-contract" class="sidebar-link">Structure of a Smart Contract</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#operation-codes" class="sidebar-link">Operation codes</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#running-the-contract-step-by-step" class="sidebar-link">Running the contract step-by-step</a></li></ul></li><li><a href="/chapters/02.html" class="sidebar-link">Chapter 2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/02.html#types-in-michelson" class="sidebar-link">Types in Michelson</a></li><li class="sidebar-sub-header"><a href="/chapters/02.html#advanced-stack-usage" class="sidebar-link">Advanced stack usage</a></li></ul></li><li><a href="/chapters/03.html" aria-current="page" class="active sidebar-link">Chapter 3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/03.html#compare-and-generic-comparisons" class="sidebar-link">Compare and generic comparisons</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#conditionals" class="sidebar-link">Conditionals</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#fail-and-assert" class="sidebar-link">FAIL and ASSERT</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#recap" class="sidebar-link">Recap</a></li></ul></li><li><a href="/chapters/04.html" class="sidebar-link">Chapter 4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/04.html#available-types-for-arithmetic-operations" class="sidebar-link">Available types for arithmetic operations</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-add-instruction" class="sidebar-link">The `ADD` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-sub-instruction" class="sidebar-link">The `SUB` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-mul-instruction" class="sidebar-link">The `MUL` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-ediv-instruction" class="sidebar-link">The `EDIV` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#other-operations-on-numeric-values" class="sidebar-link">Other operations on numeric values</a></li></ul></li><li><a href="/chapters/05.html" class="sidebar-link">Chapter 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/05.html#mutez-and-mutez-operations" class="sidebar-link">mutez and mutez operations</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#balance-amount-and-now" class="sidebar-link">`BALANCE`, `AMOUNT` and `NOW`</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#address-contract-and-token-transfer" class="sidebar-link">Address, contract and token transfer</a></li></ul></li><li><a href="/chapters/06.html" class="sidebar-link">Chapter 6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/06.html#boolean-type-and-operations-on-booleans" class="sidebar-link">Boolean type and operations on booleans</a></li><li class="sidebar-sub-header"><a href="/chapters/06.html#cryptographic-operations" class="sidebar-link">Cryptographic operations</a></li></ul></li><li><a href="/chapters/07.html" class="sidebar-link">Chapter 7</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/07.html#strings-and-string-manipulations" class="sidebar-link">Strings and string manipulations</a></li><li class="sidebar-sub-header"><a href="/chapters/07.html#working-with-lists" class="sidebar-link">Working with lists</a></li></ul></li><li><a href="/chapters/08.html" class="sidebar-link">Chapter 8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/08.html#overview-of-the-pair-type" class="sidebar-link">Overview of the pair type</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#operations-on-pairs" class="sidebar-link">Operations on pairs</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#pairing-and-unpairing" class="sidebar-link">Pairing and unpairing</a></li></ul></li><li><a href="/chapters/99.html" class="sidebar-link">/chapters/99.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-3"><a href="#chapter-3" class="header-anchor">#</a> Chapter 3</h1> <p>This chapter introduces conditional structures, fail operators and some useful macros to use in your Michelson code.</p> <p>It is always crucial in your smart contracts to compare values with each other. You may want to make sure that your users send the values your contract is expecting, that a value exists, that the amount sent by your users is sufficient or that the initiator of the transaction has the right to access some part of your code.</p> <p>Like a lot of other languages, Michelson offers conditional structures that will allow you to compare values together and execute code depending on the result of the comparison of these values.</p> <p>As you may expect, the instructions involved in these comparisons will look a lot like what you will find in high-level programming languages, with some very specific constraints and considerations due to the low-level nature of Michelson.</p> <p>In this chapter, we are not going to write a full functional smart contract but manipulate the stack by sending instructions. You will notice that some code snippets start with the <strong><code>DROP</code></strong> instruction which function will simply be to remove the element created by the previous instruction from the stack and start with a clean stack. It is not involved in the functionalities that are presented.</p> <h2 id="compare-and-generic-comparisons"><a href="#compare-and-generic-comparisons" class="header-anchor">#</a> Compare and generic comparisons</h2> <p>As usual, let's declare the storage and parameter type and initialize the smart contract:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage int;
parameter int;</pre></div> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">BEGIN</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                        </th><th>type                                             </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">Pair 3 4</pre></td><td><pre style="text-align:left;">pair int int</pre></td></tr></tbody></table></div> <p>Now it's time to play with our stack!<br>
The following line is more of a refresher about basic instructions to extract the parameter and the storage.<br>
Notice the keyword after <strong><code>CAR</code></strong> and <strong><code>CDR</code></strong>? It is an <em>annotation</em>, you can use it to track different values in the stack and see how they move:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token attr-name">@param</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">CDR</span><span class="token punctuation"> </span><span class="token attr-name">@storage</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DUP: push (3, 4);
CAR: pop (3, 4); push 3;
SWAP: pop 3, (3, 4); push 3; push (3, 4);
CDR: pop (3, 4); push 4;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                 </th><th>type                                    </th><th>name                                         </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">4</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">@storage</pre></td></tr> <tr><td><pre style="text-align:left;">3</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">@param</pre></td></tr></tbody></table></div> <p>Let's introduce our first comparison instruction!<br> <strong><code>COMPARE</code></strong> is an instruction that compares numeric values (integer or natural numbers) and returns a value between -1 and 1. This is how it works:</p> <ol><li><strong><code>COMPARE</code></strong> takes the two elements currently at the top out of the stack. These two elements <strong>must</strong> be both of a comparable type.</li> <li>The two elements are compared against each other. The comparison will yield one of the three values below:
<ul><li>If the two elements are equal, the result is <code>int 0</code>.</li> <li>If the first element is greater than the second one, the result is <code>int 1</code>.</li> <li>If the second element is greater than the first one, the result is <code>int -1</code>.</li></ul></li> <li>The result is pushed onto the stack.</li></ol> <p>Observe the effect of <strong><code>COMPARE</code></strong> below. After the instruction is run, the two integer values that were in the stack are gone and an element of type <code>int</code> containing the value <code>1</code> is present (<code>1</code> indicates that <code>4</code> is greater than <code>3</code>, which is the case):</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">COMPARE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                 </th><th>type                                    </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">1</pre></td><td><pre style="text-align:left;">int</pre></td></tr></tbody></table></div> <p>In the next snippet, we clean up our stack to start from fresh!<br>
Let's check what happens when the values we used above are reversed. Remember that the values are stacked one above the other, so pushing <code>4</code> then <code>3</code> means that <code>4</code> is the second element and <code>3</code> the first:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">COMPARE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop 1;
PUSH: push 4;
PUSH: push 3;
COMPARE: pop 3, 4; push -1;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                  </th><th>type                                    </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">-1</pre></td><td><pre style="text-align:left;">int</pre></td></tr></tbody></table></div> <p>The result is <code>-1</code>, which indicates that the first element is less than the second one.</p> <p>Now, you may be wondering: &quot;getting <code>1</code>, <code>0</code> or <code>-1</code> from the comparison is cool, but what to do with that value?&quot; This is exactly what we are going to see! We can use the value returned by <strong><code>COMPARE</code></strong> and get a boolean value out of it.<br>
The <strong><code>EQ</code></strong> instruction checks the value on top of the stack. If the value is equal to <code>int 0</code>, <strong><code>EQ</code></strong> returns <code>true</code>. Otherwise, it returns <code>false</code>. This is exactly what we need to verify whether our two values are equal or not:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">COMPARE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">EQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop -1;
PUSH: push 4;
PUSH: push 3;
COMPARE: pop 3, 4; push -1;
EQ: pop -1; push False;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                     </th><th>type                                     </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">False</pre></td><td><pre style="text-align:left;">bool</pre></td></tr></tbody></table></div> <p>Let's detail the different steps of the code snippet above:</p> <ol><li>We add an element on top of the stack of type <code>int</code> with the value <code>4</code>.</li> <li>We add another element on top of the previous one of type <code>int</code> with the value <code>3</code>.</li> <li>We use the <strong><code>COMPARE</code></strong> instruction. It removes the two elements on the stack. <code>3</code> is less than <code>4</code>, so <strong><code>COMPARE</code></strong> returns <code>int -1</code> and pushes this new value on our empty stack.</li> <li><strong><code>EQ</code></strong> checks the first (and only) element in the stack. It is not equal to <code>0</code>, so it returns false.</li></ol> <p>Now let's see what happens if we use two equal values:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">COMPARE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">EQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop False;
PUSH: push 4;
PUSH: push 4;
COMPARE: pop 4, 4; push 0;
EQ: pop 0; push True;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                    </th><th>type                                     </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">True</pre></td><td><pre style="text-align:left;">bool</pre></td></tr></tbody></table></div> <p>As expected, <strong><code>COMPARE</code></strong> returns <code>0</code> because the two values are identical and <strong><code>EQ</code></strong> turns the <code>0</code> in the stack into the boolean value <code>true</code>.</p> <p>What about checking if the two values are NOT equal? There is an instruction for that too! You can use <strong><code>NEQ</code></strong> in the same way to return <code>false</code> if the two values are equal or <code>true</code> if they are not equal:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">COMPARE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">NEQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop True;
PUSH: push 3;
PUSH: push 4;
COMPARE: pop 4, 3; push 1;
NEQ: pop 1; push True;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                    </th><th>type                                     </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">True</pre></td><td><pre style="text-align:left;">bool</pre></td></tr></tbody></table></div> <p>There are a few other instructions you can use like <strong><code>EQ</code></strong> or <strong><code>NEQ</code></strong> to check the value returned by <strong><code>COMPARE</code></strong>:</p> <ol><li><strong><code>LT</code></strong>: checks if the value is less than <code>0</code>, <strong><code>COMPARE</code></strong> returns <code>-1</code> if the first element is less than the second, using <strong><code>LT</code></strong> will return <code>true</code> if <strong><code>COMPARE</code></strong> returns <code>-1</code>.</li> <li><strong><code>GT</code></strong>: checks if the value is greater than <code>0</code>, <strong><code>COMPARE</code></strong> returns <code>1</code> if the first element is greater than the second, using <strong><code>GT</code></strong> will return <code>true</code> if <strong><code>COMPARE</code></strong> returns <code>1</code>.</li> <li><strong><code>LE</code></strong>: checks if the value is equal or less than <code>0</code>, <strong><code>COMPARE</code></strong> returns <code>0</code> or <code>-1</code> if the first element is equal or less than the second, using <strong><code>LE</code></strong> will return <code>true</code> if <strong><code>COMPARE</code></strong> returns <code>0</code> or <code>-1</code>.</li> <li><strong><code>GE</code></strong>: checks if the value is equal or greater than <code>0</code>, <strong><code>COMPARE</code></strong> returns <code>0</code> or <code>1</code> if the first element is equal or greater than the second, using <strong><code>GE</code></strong> will return <code>true</code> if <strong><code>COMPARE</code></strong> returns <code>0</code> or <code>1</code>.</li></ol> <p>Writing two instructions one after the other and remembering that <strong><code>COMPARE</code></strong> will return <code>-1</code>, <code>0</code> or <code>1</code> that you can then use with another instruction can seem a bit tedious. Michelson knows you want to do more and write less, so it provides useful macros that group instructions together in one single instruction ðŸ˜‰<br>
For example, instead of writing <strong><code>COMPARE ; EQ ;</code></strong>, you can use <strong><code>CMPEQ</code></strong>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token variable">CMPEQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop True;
PUSH: push 4;
PUSH: push 4;
COMPARE: pop 4, 4; push 0;
EQ: pop 0; push True;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                    </th><th>type                                     </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">True</pre></td><td><pre style="text-align:left;">bool</pre></td></tr></tbody></table></div> <p>As you can see, it does exactly the same thing as two code snippets above. You can use any of these macros by using the <strong><code>CMP</code></strong> prefix followed by one of the instructions listed above: <strong><code>CMPEQ</code></strong>, <strong><code>CMPNEQ</code></strong>, <strong><code>CMPLT</code></strong>, <strong><code>CMPGT</code></strong>, <strong><code>CMPLE</code></strong>, <strong><code>CMPGE</code></strong>.</p> <h2 id="conditionals"><a href="#conditionals" class="header-anchor">#</a> Conditionals</h2> <p>Now, let's get things a little further. What about running a piece of code only if a <strong><code>CMP{EQ|NEQ|LT|GT|LE|GE}</code></strong> instruction returns true or false? In a lot of other programming languages, the <strong><code>IF</code></strong> keyword is used to check if a condition is met and run code accordingly. This is also the case in Michelson. However, when using <strong><code>IF</code></strong> in Michelson, you have to keep in mind that you <em>must</em> have a boolean value in the top element of the stack. Michelson doesn't take shortcuts and only boolean values evaluate to <code>true</code> or <code>false</code>.</p> <p>Here is an example (remember that we have <code>true</code> on top of the stack from the previous example):</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">IF</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Is true&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Is false&quot;</span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>IF: pop True;
  PUSH: push Is true;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                         </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;Is true&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <p>This is obviously a very naive example, but it showcases well what the <strong><code>IF</code></strong> instruction does in Michelson: it takes the element of type <code>bool</code> from the top of the stack and evaluates it. If the element is <code>true</code>, it will execute the code in the first block delimited by curly braces. If the element is <code>false</code>, it will execute the code in the second block.</p> <p>Here is a full example to follow what happens step-by-step:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token operator">COMPARE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">EQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">IF</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;It's equal :)&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;It is not equal :(&quot;</span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop Is true;
PUSH: push 4;
PUSH: push 4;
COMPARE: pop 4, 4; push 0;
EQ: pop 0; push True;
IF: pop True;
  PUSH: push It's equal :);</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                               </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;It's equal :)&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <p>Let's detail the magic happening in the code above:</p> <ol><li><strong><code>PUSH int 4 ; PUSH int 4 ;</code></strong>: pushes 2 integers with the same value on top of the stack.</li> <li><strong><code>COMPARE</code></strong>: checks if the values are equal or not and returns the result as an integer with a value between <code>-1</code> and <code>1</code>.</li> <li><strong><code>EQ</code></strong>: checks the value at the top of the stack and verifies if it is equal to <code>0</code>. If it is, it returns <code>true</code>, otherwise, it returns <code>false</code>.</li> <li><strong><code>IF</code></strong>: checks the boolean value on top of the stack and runs specific code accordingly. If the value is <code>true</code>, the first block between curly braces is run. If it is <code>false</code>, the second one is run.</li></ol> <p>You already know by now that Michelson doesn't want you to type a long series of instructions just to check if two integers are of the same value ðŸ˜œ You remember how it was possible to crush <strong><code>COMPARE</code></strong> and <strong><code>EQ</code></strong> together to get <strong><code>CMPEQ</code></strong>? It is also possible with <strong><code>COMPARE</code></strong>, <strong><code>EQ</code></strong> and <strong><code>IF</code></strong>!</p> <p>Let's see how that would work:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token variable">IFCMPEQ</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;It's equal :)&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;It is not equal :(&quot;</span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop It's equal :);
PUSH: push 4;
PUSH: push 4;
COMPARE: pop 4, 4; push 0;
EQ: pop 0; push True;
IF: pop True;
  PUSH: push It's equal :);</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                               </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;It's equal :)&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <p>You must admit that this is a lot shorter and simpler! After pushing the two integers on top of the stack, we use the <strong><code>IFCMPEQ</code></strong> instruction to check if the two values are equal and run some code according to the result. You can also use any of the following combinations: <strong><code>IFCMP{EQ|NEQ|LT|GT|LE|GE}</code></strong>.</p> <p>We have been using integers since the beginning to demonstrate how comparisons and conditionals work in Michelson, but you can actually use any comparable type of value. For example, you can also verify whether two strings are the same:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;hello world&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;hello world&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token variable">IFCMPEQ</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;It's the same string :)&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;It is not the same string :(&quot;</span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop It's equal :);
PUSH: push hello world;
PUSH: push hello world;
COMPARE: pop hello world, hello world; push 0;
EQ: pop 0; push True;
IF: pop True;
  PUSH: push It's the same string :);</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                                         </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;It's the same string :)&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <h2 id="fail-and-assert"><a href="#fail-and-assert" class="header-anchor">#</a> FAIL and ASSERT</h2> <p>In a real-world smart contract, you want to protect the data saved into the storage from attackers or from undesirable behaviors. If you create the next big token on Tezos, you must make sure the funds stored in your contract are safe. In some cases, you want a kind of &quot;circuit breaker&quot; that will just abort the current execution of the contract if something unexpected or undesirable happens. This will be the job of the <strong><code>FAIL</code></strong> instruction.</p> <p>Every time your contract will meet a <strong><code>FAIL</code></strong> instruction, it will drop everything it is doing and go directly to the end. Nothing is returned (more accurately, a <code>unit</code> is returned, which is nothing in practice), nothing is changed:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token variable">IFCMPEQ</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Same number!&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop It's the same string :);
PUSH: push 4;
PUSH: push 5;
COMPARE: pop 5, 4; push 1;
EQ: pop 1; push False;
IF: pop False;
  UNIT: push Unit;
  FAILWITH: pop Unit;</pre></div> <div class="stderr"><pre><span class="stream-name">stderr</span><br>MichelsonRuntimeError: Unit
at IF -&gt; FAILWITH</pre></div> <p>You can see that <strong><code>IFCMPEQ</code></strong> is going to check whether <code>4</code> is equal to <code>5</code>. As it is not the case, the second code block will be executed, the one containing <strong><code>FAIL</code></strong>. The contract raises a <code>MichelsonRuntimeError</code> followed by the unit returned after <strong><code>FAIL</code></strong>. The execution is stopped and nothing happens.</p> <p>The <strong><code>IF</code></strong> instruction allows to check the result of the comparison of two values of the same type. However, in Michelson, we also have a special type of value called an <code>option</code>. This value can be <code>(Some value)</code> if there is a value or <code>None</code> if there is no value. In some cases, you are going to make operations that will push an option on top of the stack. You want then to verify if the option has a value (<code>Some</code>) or is empty (<code>None</code>).<br>
To this purpose, you can use a special instruction: <strong><code>IF_NONE</code></strong>. <strong><code>IF_NONE</code></strong> takes the top element of the stack out (it must be of type <code>option</code> though) and will execute the first code block if the value is equal to <code>None</code>. Otherwise, it will exectute the second code block. Note that if the value is equal to <code>(Some value)</code>, the <code>value</code> between parentheses will be pushed on to the stack.</p> <p>Here is what happens if the value on top of the stack is <strong><code>None</code></strong>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">option</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token number">None</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">IF_NONE</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;No value!&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop 4;
PUSH: push None;
IF_NONE: pop None;
  PUSH: push No value!;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                           </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;No value!&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <p>Now this is what happens if there is <strong><code>(Some value)</code></strong> on top of the stack:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">option</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token number">Some</span><span class="token punctuation"> </span><span class="token number">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">IF_NONE</span><span class="token punctuation"> </span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop No value!;
PUSH: push ('hello world',);
IF_NONE: pop ('hello world',); push hello world;</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                             </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;hello world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <p>You can now see that the string that was wrapped in the <code>(Some value)</code> is at the top of the stack.</p> <p>What if I told you that there is another shortcut to check the value present at the top of the stack? The <strong><code>ASSERT</code></strong> instruction!<br> <strong><code>ASSERT</code></strong> expects a boolean value and under the hood, it is a macro for <strong><code>IF { } { FAIL }</code></strong>. You probably understand this last code by now: if the boolean value is <code>true</code>, the code will just continue its execution. If it is <code>false</code>, it will fail and return nothing.<br>
Here is a simple example:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">True</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token variable">ASSERT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP: pop hello world;
PUSH: push True;
IF: pop True;</pre></div> <p>As you can see, the contract pushes a boolean value equal to <code>true</code> on top of the stack. <strong><code>ASSERT</code></strong> will then check this value and because it is <code>true</code>, the contract doesn't fail and continue its execution.</p> <p>Now we can take the power of <strong><code>ASSERT</code></strong> even further and extend its capabilities with other macros. Just like <strong><code>IF</code></strong>, you can use comparison instructions if you want to use other types but booleans.<br>
Let's check how <strong><code>ASSERT_CMPEQ</code></strong> would work:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token variable">ASSERT_CMPEQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH: push 4;
PUSH: push 5;
COMPARE: pop 5, 4; push 1;
EQ: pop 1; push False;
IF: pop False;
  UNIT: push Unit;
  FAILWITH: pop Unit;</pre></div> <div class="stderr"><pre><span class="stream-name">stderr</span><br>MichelsonRuntimeError: Unit
at IF -&gt; FAILWITH</pre></div> <p>The code above pushes two integers on top of the stack, compares them against each other and returns <code>-1</code>, <code>0</code> or <code>1</code>, checks if the returned value is equal to zero or not and returns a boolean value, then finally, checks if the boolean value is <code>true</code> or <code>false</code>.</p> <p>Now if you use two values that are actually equal, you will see no runtime error:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token variable">ASSERT_CMPEQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH: push 5;
PUSH: push 5;
COMPARE: pop 5, 5; push 0;
EQ: pop 0; push True;
IF: pop True;</pre></div> <p>To finish with this chapter packed with new information, let's see another way of making your contracts fail.<br>
Until now, we have used the <strong><code>FAIL</code></strong> instruction. If you remember, it stops everything and returns nothing or more precisely, it returns a unit. Actually, <strong><code>FAIL</code></strong> is also a macro and replaces <code>UNIT ; FAILWITH ;</code>. The <strong><code>FAILWITH</code></strong> instruction is also going to make your contract fail but it will return whatever value is at the top of the stack at this moment. This can be a good solution if you would like to return an error message!</p> <p>Check the example below:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">bool</span><span class="token punctuation"> </span><span class="token number">False</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">IF</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Is true!&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Is false!&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">FAILWITH</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH: push False;
IF: pop False;
  PUSH: push Is false!;
  FAILWITH: pop Is false!;</pre></div> <div class="stderr"><pre><span class="stream-name">stderr</span><br>MichelsonRuntimeError: Is false!
at IF -&gt; FAILWITH</pre></div> <p>As you can see in the red runtime error box, the error message <em>Is false!</em> has been returned instead of <em>Unit</em> as it was the case in the previous error messages.</p> <h2 id="recap"><a href="#recap" class="header-anchor">#</a> Recap</h2> <p>This chapter was a bit lengthy but it introduces fundamental concepts to write Michelson smart contracts: comparisons, conditions and fails.<br>
With these tools, you can write safer, more robust and more complex contracts that can analyze the data you feed them, run specific code according to the data they receive and fail if they encounter an unexpected situation. Sure, it seems trivial to compare <code>5</code> and <code>4</code> or to push <code>true</code> before running <code>IF</code>, but in a real-life scenario, you may want to compare the balance of your users with their withdrawal request before sending them money or verify if a certain user is allowed to withdraw money from a certain account!</p> <div id="bottom-right-wrapper" class="fab-wrapper" style="right:5vw;bottom:4vh;z-index:999;position:fixed;" data-v-f9cfe6e4><div id="bottom-right-action" class="actions-container" style="bottom:-20px;padding-bottom:20px;" data-v-f9cfe6e4><ul class="fab-list" style="display:none;" data-v-f9cfe6e4 data-v-f9cfe6e4><!----><!----></ul></div> <div class="fab-main pointer" style="background-color:#c6b29b;padding:28px;" data-v-f9cfe6e4><i class="md-24 material-icons main" data-v-f9cfe6e4>add</i> <i class="md-24 material-icons close" data-v-f9cfe6e4>add</i></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/chapters/02.html" class="prev">
        Chapter 2
      </a></span> <span class="next"><a href="/chapters/04.html">
        Chapter 4
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3bc4d0dc.js" defer></script><script src="/assets/js/2.f4f16137.js" defer></script><script src="/assets/js/11.50879eea.js" defer></script><script src="/assets/js/4.ac851716.js" defer></script><script src="/assets/js/3.2c98d5d1.js" defer></script>
  </body>
</html>
