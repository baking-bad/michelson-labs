<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 7 | Michelson Labs</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
    <meta name="description" content="This new chapter will be the occasion to work a little more in-depth with two data types that are pretty important on a smart contract: strings and lists.">
    <meta name="image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:title" content="Chapter 7">
    <meta name="twitter:description" content="This new chapter will be the occasion to work a little more in-depth with two data types that are pretty important on a smart contract: strings and lists.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:url" content="https://michelson.baking-bad.org/chapters/07.html">
    <meta name="twitter:site" content="@TezosBakingBad">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Chapter 7">
    <meta property="og:description" content="This new chapter will be the occasion to work a little more in-depth with two data types that are pretty important on a smart contract: strings and lists.">
    <meta property="og:image" content="https://michelson.baking-bad.org/og.png">
    <meta property="og:url" content="https://michelson.baking-bad.org/chapters/07.html">
    <meta property="og:site_name" content="Michelson Labs">
    <meta itemprop="name" content="Chapter 7">
    <meta itemprop="description" content="This new chapter will be the occasion to work a little more in-depth with two data types that are pretty important on a smart contract: strings and lists.">
    <meta itemprop="image" content="https://michelson.baking-bad.org/og.png">
    <link rel="preload" href="/assets/css/0.styles.41c7ef0c.css" as="style"><link rel="preload" href="/assets/js/app.2d71d757.js" as="script"><link rel="preload" href="/assets/js/2.430b66b2.js" as="script"><link rel="preload" href="/assets/js/16.5316cf4d.js" as="script"><link rel="preload" href="/assets/js/4.c279c943.js" as="script"><link rel="preload" href="/assets/js/3.550cb5aa.js" as="script"><link rel="prefetch" href="/assets/js/10.39ae3c42.js"><link rel="prefetch" href="/assets/js/11.897dacfb.js"><link rel="prefetch" href="/assets/js/12.083d37d3.js"><link rel="prefetch" href="/assets/js/13.a75e832a.js"><link rel="prefetch" href="/assets/js/14.d7e9078d.js"><link rel="prefetch" href="/assets/js/15.2d0a9cd5.js"><link rel="prefetch" href="/assets/js/17.f4089664.js"><link rel="prefetch" href="/assets/js/18.bc1d5da2.js"><link rel="prefetch" href="/assets/js/19.2f489976.js"><link rel="prefetch" href="/assets/js/20.d6a0692d.js"><link rel="prefetch" href="/assets/js/21.2bcbd1eb.js"><link rel="prefetch" href="/assets/js/22.42b58ecc.js"><link rel="prefetch" href="/assets/js/23.cfbbd282.js"><link rel="prefetch" href="/assets/js/24.3069e4b3.js"><link rel="prefetch" href="/assets/js/25.9bb53cdf.js"><link rel="prefetch" href="/assets/js/5.b2436255.js"><link rel="prefetch" href="/assets/js/6.c09f7c7f.js"><link rel="prefetch" href="/assets/js/7.16d6fa11.js"><link rel="prefetch" href="/assets/js/8.c7c848cc.js"><link rel="prefetch" href="/assets/js/9.d1dbceb8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41c7ef0c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_small.png" alt="Michelson Labs" class="logo"> <span class="site-name can-hide">Michelson Labs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learn.html" class="sidebar-link">Learn Michelson</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn.html#why-ðŸ¤”" class="sidebar-link">Why ðŸ¤”</a></li><li class="sidebar-sub-header"><a href="/learn.html#how" class="sidebar-link">How</a></li><li class="sidebar-sub-header"><a href="/learn.html#resources" class="sidebar-link">Resources</a></li><li class="sidebar-sub-header"><a href="/learn.html#contact-us" class="sidebar-link">Contact us</a></li><li class="sidebar-sub-header"><a href="/learn.html#about" class="sidebar-link">About</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Notebooks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction.html" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/introduction.html#try-online" class="sidebar-link">Try online</a></li><li class="sidebar-sub-header"><a href="/introduction.html#run-in-docker" class="sidebar-link">Run in Docker</a></li><li class="sidebar-sub-header"><a href="/introduction.html#install-jupyter" class="sidebar-link">Install Jupyter</a></li><li class="sidebar-sub-header"><a href="/introduction.html#notebook-workflow" class="sidebar-link">Notebook workflow</a></li></ul></li><li><a href="/chapters/01.html" class="sidebar-link">Chapter 1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/01.html#understanding-the-stack" class="sidebar-link">Understanding the stack</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#structure-of-a-smart-contract" class="sidebar-link">Structure of a Smart Contract</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#operation-codes" class="sidebar-link">Operation codes</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#running-the-contract-step-by-step" class="sidebar-link">Running the contract step-by-step</a></li></ul></li><li><a href="/chapters/02.html" class="sidebar-link">Chapter 2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/02.html#types-in-michelson" class="sidebar-link">Types in Michelson</a></li><li class="sidebar-sub-header"><a href="/chapters/02.html#advanced-stack-usage" class="sidebar-link">Advanced stack usage</a></li></ul></li><li><a href="/chapters/03.html" class="sidebar-link">Chapter 3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/03.html#compare-and-generic-comparisons" class="sidebar-link">Compare and generic comparisons</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#conditionals" class="sidebar-link">Conditionals</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#fail-and-assert" class="sidebar-link">FAIL and ASSERT</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#recap" class="sidebar-link">Recap</a></li></ul></li><li><a href="/chapters/04.html" class="sidebar-link">Chapter 4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/04.html#available-types-for-arithmetic-operations" class="sidebar-link">Available types for arithmetic operations</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-add-instruction" class="sidebar-link">The `ADD` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-sub-instruction" class="sidebar-link">The `SUB` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-mul-instruction" class="sidebar-link">The `MUL` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-ediv-instruction" class="sidebar-link">The `EDIV` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#other-operations-on-numeric-values" class="sidebar-link">Other operations on numeric values</a></li></ul></li><li><a href="/chapters/05.html" class="sidebar-link">Chapter 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/05.html#mutez-and-mutez-operations" class="sidebar-link">mutez and mutez operations</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#balance-amount-and-now" class="sidebar-link">`BALANCE`, `AMOUNT` and `NOW`</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#address-contract-and-token-transfer" class="sidebar-link">Address, contract and token transfer</a></li></ul></li><li><a href="/chapters/06.html" class="sidebar-link">Chapter 6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/06.html#boolean-type-and-operations-on-booleans" class="sidebar-link">Boolean type and operations on booleans</a></li><li class="sidebar-sub-header"><a href="/chapters/06.html#cryptographic-operations" class="sidebar-link">Cryptographic operations</a></li></ul></li><li><a href="/chapters/07.html" aria-current="page" class="active sidebar-link">Chapter 7</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/07.html#strings-and-string-manipulations" class="sidebar-link">Strings and string manipulations</a></li><li class="sidebar-sub-header"><a href="/chapters/07.html#working-with-lists" class="sidebar-link">Working with lists</a></li></ul></li><li><a href="/chapters/08.html" class="sidebar-link">Chapter 8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/08.html#overview-of-the-pair-type" class="sidebar-link">Overview of the pair type</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#operations-on-pairs" class="sidebar-link">Operations on pairs</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#pairing-and-unpairing" class="sidebar-link">Pairing and unpairing</a></li></ul></li><li><a href="/chapters/09.html" class="sidebar-link">Chapter 9</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/09.html#casting-types" class="sidebar-link">Casting types</a></li><li class="sidebar-sub-header"><a href="/chapters/09.html#working-with-bytes" class="sidebar-link">Working with bytes</a></li></ul></li><li><a href="/chapters/10.html" class="sidebar-link">Chapter 10</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-sets" class="sidebar-link">Working with sets</a></li><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-maps" class="sidebar-link">Working with maps</a></li></ul></li><li><a href="/chapters/11.html" class="sidebar-link">Chapter 11</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/11.html#the-loop-instruction" class="sidebar-link">The `LOOP` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-sets" class="sidebar-link">Iterating on sets</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-maps" class="sidebar-link">Iterating on maps</a></li></ul></li><li><a href="/chapters/12.html" class="sidebar-link">Chapter 12</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/12.html#union-types-and-entrypoints" class="sidebar-link">Union types and entrypoints</a></li></ul></li><li><a href="/chapters/13.html" class="sidebar-link">Chapter 13</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/13.html#address-and-contract-types" class="sidebar-link">Address and contract types</a></li><li class="sidebar-sub-header"><a href="/chapters/13.html#self-source-and-sender" class="sidebar-link">SELF, SOURCE and SENDER</a></li></ul></li><li><a href="/chapters/14.html" class="sidebar-link">Chapter 14</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/14.html#creating-and-sending-transactions" class="sidebar-link">Creating and sending transactions</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#delegating-contract-funds" class="sidebar-link">Delegating contract funds</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#originating-new-contracts" class="sidebar-link">Originating new contracts</a></li></ul></li><li><a href="/chapters/15.html" class="sidebar-link">Chapter 15</a></li><li><a href="/chapters/99.html" class="sidebar-link">Kernel helpers</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-7"><a href="#chapter-7" class="header-anchor">#</a> Chapter 7</h1> <p>This new chapter will be the occasion to work a little more in-depth with two data types that are pretty important on a smart contract: strings and lists.</p> <p>In most projects that you will work on, you will probably have to manipulate strings. Whether you want to save some data provided by your users or compare inputs, strings are an essential component of smart contracts. Unlike other smart contract languages whose developers have been asking for these features for years (for example Solidity), Michelson offers string manipulation functions out of the box. Although still limited compared to other high level languages, these functions will still provide enough flexibility to get the job done.</p> <p>Once you have strings in your smart contract, what about storing them somewhere? Lists could be the perfect place for that! Michelson offers different possibilities in terms of storage for multiple pieces of data and lists are one of them. Before choosing a list for your needs, you must know more about what make them different and how they work. This will have no more secret for you at the end of this tutorial!</p> <h2 id="strings-and-string-manipulations"><a href="#strings-and-string-manipulations" class="header-anchor">#</a> Strings and string manipulations</h2> <p>We have already worked with strings in the previous chapters, so you should already be familiar with this type. Strings are one character or a series of characters delimited by double-quotes and including only the characters present in the English alphabet (and the escape character in <a href="https://tezos.gitlab.io/whitedoc/michelson.html#constants" target="_blank" rel="noopener noreferrer">certain circumstances<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>). Strings are comparable values that can be added to contract from different sources: they can come from the parameter, the storage or the <strong><code>PUSH</code></strong> instruction.</p> <p>Once the string is present in the stack, you can work with it!<br>
First, you can check the length of the string with the <strong><code>SIZE</code></strong> opcode:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SIZE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('tezos' * 0)
CAR / ('tezos' * 0) =&gt; 'tezos'
SIZE / 'tezos' =&gt; 5
NIL / _ =&gt; []
PAIR / [] : 5 =&gt; ([] * 5)
END %default / ([] * 5) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                    </th><th>value                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">nat</pre></td><td><pre style="text-align:left;">5</pre></td></tr></tbody></table></div> <p>As expected, the length of the string <em>&quot;Tezos&quot;</em> is <code>5</code>. Note that the length is returned as a <code>nat</code> because negative length are not possible.<br>
Knowing the length of a string can be useful if you want to limit the size of the strings saved into your contract. Let's write an example that will reject string parameters if their length exceeds <code>5</code>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SIZE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">5</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">IFCMPLT</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('tezos' * '')
CAR / ('tezos' * '') =&gt; 'tezos'
DUP / 'tezos' =&gt; 'tezos' : 'tezos'
SIZE / 'tezos' =&gt; 5
PUSH / _ =&gt; 5
COMPARE / 5 : 5 =&gt; 0
LT / 0 =&gt; False
IF / False =&gt; _
NIL / _ =&gt; []
PAIR / [] : 'tezos' =&gt; ([] * 'tezos')
END %default / ([] * 'tezos') =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                       </th><th>value                                     </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">tezos</pre></td></tr></tbody></table></div> <p>If you add another character to &quot;tezos&quot;, you will see the contract fail ðŸ˜Š</p> <p>One of the most common actions on strings is concatenation. Michelson provides an instruction that allows you to put two separate strings together: <strong><code>CONCAT</code></strong>. This is how it works:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Hello &quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONCAT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;Tezos&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('Tezos' * '')
CAR / ('Tezos' * '') =&gt; 'Tezos'
PUSH / _ =&gt; 'Hello '
CONCAT / 'Hello ' : 'Tezos' =&gt; 'Hello Tezos'
NIL / _ =&gt; []
PAIR / [] : 'Hello Tezos' =&gt; ([] * 'Hello Tezos')
END %default / ([] * 'Hello Tezos') =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                       </th><th>value                                           </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">Hello Tezos</pre></td></tr></tbody></table></div> <p>This smart contract does a very simple thing: it takes a string as a parameter and put it together with &quot;Hello &quot; before saving it in the storage. When using <strong><code>CONCAT</code></strong>, just make sure you have two strings on top of the stack and that they are in the right order, the element 1 will be the first one in the new string and element 2 will be the second one.</p> <p>If you want to concatenate multiple strings, you just have to add them to the stack and concatenate the <strong><code>CONCAT</code></strong> instructions!</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Tezos &quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Hello &quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONCAT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONCAT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;World&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('World' * '')
CAR / ('World' * '') =&gt; 'World'
PUSH / _ =&gt; 'Tezos '
PUSH / _ =&gt; 'Hello '
CONCAT / 'Hello ' : 'Tezos ' =&gt; 'Hello Tezos '
CONCAT / 'Hello Tezos ' : 'World' =&gt; 'Hello Tezos World'
NIL / _ =&gt; []
PAIR / [] : 'Hello Tezos World' =&gt; ([] * 'Hello Tezos World')
END %default / ([] * 'Hello Tezos World') =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                       </th><th>value                                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">Hello Tezos World</pre></td></tr></tbody></table></div> <p>The opposite action is <strong><code>SLICE</code></strong>: instead of putting two strings together, we are cutting one in pieces! This instruction takes three parameters: the starting point for the slice, the character length you want to slice and the string. Let's observe a few examples:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">BEGIN</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token comment">## Pushes a string and extract the first 6 characters</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token attr-name">@string_to_slice</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;BakingBad&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token attr-name">@length</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">6</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## length</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token attr-name">@offset</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## offset</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
BEGIN %default / _ =&gt; (Unit * Unit)
DROP / (Unit * Unit) =&gt; _
PUSH / _ =&gt; 'BakingBad'
PUSH / _ =&gt; 6
PUSH / _ =&gt; 0
DUMP =&gt; [0, 6, 'BakingBad']</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                       </th><th>value                                         </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">nat</pre></td><td><pre style="text-align:left;">0</pre></td></tr> <tr><td><pre style="text-align:left;">1</pre></td><td><pre style="text-align:left;">nat</pre></td><td><pre style="text-align:left;">6</pre></td></tr> <tr><td><pre style="text-align:left;">2</pre></td><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">BakingBad</pre></td></tr></tbody></table></div> <p>This is how the stack looks like before the slicing begins...</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">SLICE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>SLICE / 0 : 6 : 'BakingBad' =&gt; 'Baking'?</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                                </th><th>value                                      </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">option (string)</pre></td><td><pre style="text-align:left;">Baking</pre></td></tr></tbody></table></div> <p>You probably notice that the result of <strong><code>SLICE</code></strong> is wrapped in an <code>option</code> value. If the offset or the length you set go beyond the bounds of the string, the opcode returns <code>None</code>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;BakingBad&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">6</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## length</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">6</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## offset</span><span class="token punctuation">
</span><span class="token operator">SLICE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP / 'Baking'? =&gt; _
PUSH / _ =&gt; 'BakingBad'
PUSH / _ =&gt; 6
PUSH / _ =&gt; 6
SLICE / 6 : 6 : 'BakingBad' =&gt; None</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                       </th><th>value                                    </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">option</pre></td><td><pre style="text-align:left;">None</pre></td></tr></tbody></table></div> <p>Obviously, you are not limited to extract slices of strings from the first character, you can start at whichever position you like, keeping in mind the bounds of the string:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;BakingBadIsAwesome&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">7</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## length</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">11</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## offset</span><span class="token punctuation">
</span><span class="token operator">SLICE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP / None =&gt; _
PUSH / _ =&gt; 'BakingBadIsAwesome'
PUSH / _ =&gt; 7
PUSH / _ =&gt; 11
SLICE / 11 : 7 : 'BakingBadIsAwesome' =&gt; 'Awesome'?</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                                </th><th>value                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">option (string)</pre></td><td><pre style="text-align:left;">Awesome</pre></td></tr></tbody></table></div> <p>Slicing a string in two pieces is going to ask for a little extra work but it is totally possible. Here is how to do it:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;BakingBadIsAwesome&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## Push the string to slice in two</span><span class="token punctuation">
</span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## Duplicate the string</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">9</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## The length of the first piece</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## The offset of the first piece</span><span class="token punctuation">
</span><span class="token operator">SLICE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## Extract the first piece of the string</span><span class="token punctuation">
</span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## Get the duplicated original string on top of the stack</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">9</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## The lenght of the second piece</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token number">9</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## The offset of the second piece</span><span class="token punctuation">
</span><span class="token operator">SLICE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## Extract the second piece of the string</span><span class="token punctuation">
</span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## Put the pieces in the right order</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DROP / 'Awesome'? =&gt; _
PUSH / _ =&gt; 'BakingBadIsAwesome'
DUP / 'BakingBadIsAwesome' =&gt; 'BakingBadIsAwesome' : 'BakingBadIsAwesome'
PUSH / _ =&gt; 9
PUSH / _ =&gt; 0
SLICE / 0 : 9 : 'BakingBadIsAwesome' =&gt; 'BakingBad'?
SWAP / 'BakingBad'? : 'BakingBadIsAwesome' =&gt; 'BakingBadIsAwesome' : 'BakingBad'?
PUSH / _ =&gt; 9
PUSH / _ =&gt; 9
SLICE / 9 : 9 : 'BakingBadIsAwesome' =&gt; 'IsAwesome'?
SWAP / 'IsAwesome'? : 'BakingBad'? =&gt; 'BakingBad'? : 'IsAwesome'?
DUMP =&gt; ['BakingBad'?, 'IsAwesome'?]</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                                </th><th>value                                         </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">option (string)</pre></td><td><pre style="text-align:left;">BakingBad</pre></td></tr> <tr><td><pre style="text-align:left;">1</pre></td><td><pre style="text-align:left;">option (string)</pre></td><td><pre style="text-align:left;">IsAwesome</pre></td></tr></tbody></table></div> <p>The last instruction in our tool box for strings in Michelson is <strong><code>COMPARE</code></strong>. As it does it for other types, the instruction compares two strings. You can then use it with the usual macros to check if two strings are the same or are different:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">DROP_ALL</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token variable">CMPEQ</span><span class="token punctuation"> </span><span class="token attr-name">@first_example</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;bakingbad&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;BakingBad&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token variable">CMPEQ</span><span class="token punctuation"> </span><span class="token attr-name">@second_example</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH / _ =&gt; 'tezos'
PUSH / _ =&gt; 'tezos'
COMPARE / 'tezos' : 'tezos' =&gt; 0
EQ / 0 =&gt; True
PUSH / _ =&gt; 'bakingbad'
PUSH / _ =&gt; 'BakingBad'
COMPARE / 'BakingBad' : 'bakingbad' =&gt; -1
EQ / -1 =&gt; False
DUMP =&gt; [False, True]</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                     </th><th>value                                     </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">bool</pre></td><td><pre style="text-align:left;">False</pre></td></tr> <tr><td><pre style="text-align:left;">1</pre></td><td><pre style="text-align:left;">bool</pre></td><td><pre style="text-align:left;">True</pre></td></tr></tbody></table></div> <p>As you can see, <strong><code>COMPARE</code></strong> is case-sensitive, so it is very important to verify this won't produce false negative results.</p> <h2 id="working-with-lists"><a href="#working-with-lists" class="header-anchor">#</a> Working with lists</h2> <p>After manipulating strings, you may want to save them in the storage of the smart contract. Michelson offers different solutions for that, for example sets and maps, but you may prefer a <em>list</em>. A list is a special structure that contains different values of the same type. One of its characteristics is that a list is <em>immutable</em>, meaning that when you want to add an element to a list, you actually create a new list made of the new element in the first position (which we call the <em>head</em>) and the elements of the previous list starting at the second position (the previous list is called the <em>tail</em>). Lists are also ordered, which means that their elements are in a specific order.</p> <p>You probably remember how to create an empty list from the contracts we already wrote so far, with <code>NIL &quot;type&quot;</code>. The <strong><code>NIL</code></strong> instruction creates a new empty list that will accept elements of the type you specified. For example, <strong><code>NIL operation</code></strong> is a list that accepts elements of type <code>operation</code>. Once you created an empty list, you can easily add an element with the <strong><code>CONS</code></strong> instruction. First, you push the element onto the stack, next to the list before using <strong><code>CONS</code></strong>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONS</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('tezos' * [])
CAR / ('tezos' * []) =&gt; 'tezos'
NIL / _ =&gt; []
SWAP / [] : 'tezos' =&gt; 'tezos' : []
CONS / 'tezos' : [] =&gt; ['tezos']
NIL / _ =&gt; []
PAIR / [] : ['tezos'] =&gt; ([] * ['tezos'])
END %default / ([] * ['tezos']) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                              </th><th>value                                         </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">list (string)</pre></td><td><pre style="text-align:left;">['tezos']</pre></td></tr></tbody></table></div> <p>If you wish, you can also push an existing list onto the stack like so:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token number">&quot;baking&quot;</span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;bad&quot;</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('tezos' * [])
DROP / ('tezos' * []) =&gt; _
PUSH / _ =&gt; ['baking', 'bad']
NIL / _ =&gt; []
PAIR / [] : ['baking', 'bad'] =&gt; ([] * ['baking', 'bad'])
END %default / ([] * ['baking', 'bad']) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                              </th><th>value                                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">list (string)</pre></td><td><pre style="text-align:left;">['baking', 'bad']</pre></td></tr></tbody></table></div> <p>After the list has been added to the stack, you can add new elements at the beginning (<em>the head</em>):</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token number">&quot;baking&quot;</span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;bad&quot;</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONS</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('tezos' * [])
CAR / ('tezos' * []) =&gt; 'tezos'
PUSH / _ =&gt; ['baking', 'bad']
SWAP / ['baking', 'bad'] : 'tezos' =&gt; 'tezos' : ['baking', 'bad']
CONS / 'tezos' : ['baking', 'bad'] =&gt; ['tezos', 'baking', 'bad']
NIL / _ =&gt; []
PAIR / [] : ['tezos', 'baking', 'bad'] =&gt; ([] * ['tezos', 'baking', 'bad'])
END %default / ([] * ['tezos', 'baking', 'bad']) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                              </th><th>value                                                          </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">list (string)</pre></td><td><pre style="text-align:left;">['tezos', 'baking', 'bad']</pre></td></tr></tbody></table></div> <p>Sometimes, you may want to check a list and implement different behaviors if the list is empty or not. In this case, you can use <strong><code>IF_CONS</code></strong> which verifies if there is a head to the provided list. Like the other <strong><code>IF</code></strong> instructions, you need to create two branches, the first one will be executed if <strong><code>IF_CONS</code></strong> is <code>True</code> and the second one will be executed if it is <code>False</code>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CDR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF_CONS</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">CONS</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;tezos&quot;</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token comment">## RUN %default &quot;tezos&quot; { &quot;test&quot; } ;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ('tezos' * [])
DUP / ('tezos' * []) =&gt; ('tezos' * []) : ('tezos' * [])
CAR / ('tezos' * []) =&gt; 'tezos'
SWAP / 'tezos' : ('tezos' * []) =&gt; ('tezos' * []) : 'tezos'
CDR / ('tezos' * []) =&gt; []
IF_CONS / [] =&gt; _
NIL / _ =&gt; []
SWAP / [] : 'tezos' =&gt; 'tezos' : []
CONS / 'tezos' : [] =&gt; ['tezos']
NIL / _ =&gt; []
PAIR / [] : ['tezos'] =&gt; ([] * ['tezos'])
END %default / ([] * ['tezos']) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                              </th><th>value                                         </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">list (string)</pre></td><td><pre style="text-align:left;">['tezos']</pre></td></tr></tbody></table></div> <p>Be careful as <strong><code>IF_CONS</code></strong> is going to remove the list you are checking. You should duplicate it with <strong><code>DUP</code></strong> first or if you are checking for an empty string like in this example, you can just push another empty string.<br>
If you comment the first <code>RUN</code> and comment out the second, you will see the expected behavior of the contract as it fails when the list in the storage is not empty.</p> <p>Another useful instruction to check lists is <strong><code>SIZE</code></strong> which returns the number of elements in a list as a <code>nat</code> (as usual, the number of elements cannot be negative):</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SIZE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">7</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">6</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
code: updated
BEGIN %default / _ =&gt; ([7, 4, 6] * 0)
CAR / ([7, 4, 6] * 0) =&gt; [7, 4, 6]
SIZE / [7, 4, 6] =&gt; 3
NIL / _ =&gt; []
PAIR / [] : 3 =&gt; ([] * 3)
END %default / ([] * 3) =&gt; _</pre></div> <div class="embedded-html"><h4>Operations</h4><h4>Storage</h4><table><thead><tr><th>type                                    </th><th>value                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">nat</pre></td><td><pre style="text-align:left;">3</pre></td></tr></tbody></table></div> <p>This is a very simple contract that saves in its storage the length of a list. Try to add or remove elements in the list to see it work ðŸ˜Š</p> <p>One of the powers of list is that they are <em>iterable</em>, it means that you can go through the elements one by one, either to check them or modify them. Michelson offers two instructions to loop through lists: <strong><code>ITER</code></strong> and <strong><code>MAP</code></strong>. Although they work in a very similar way, they yield very different results. Let's start with <strong><code>ITER</code></strong>. One of the best ways to understand what it does is to see it in action:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">BEGIN</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">7</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">9</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage: updated
parameter: updated
BEGIN %default / _ =&gt; ([7, 9, 3] * 0)
CAR / ([7, 9, 3] * 0) =&gt; [7, 9, 3]
DUMP =&gt; [[7, 9, 3]]</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                           </th><th>value                                         </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">list (int)</pre></td><td><pre style="text-align:left;">[7, 9, 3]</pre></td></tr></tbody></table></div> <p>This part is simple, we create a new contract and use a list of <code>int</code> as a parameter before extracting the list and putting it on top of the stack. Now comes <strong><code>ITER</code></strong>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">ITER</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>ITER / [7, 9, 3] =&gt; 7
ITER / _ =&gt; 9
ITER / _ =&gt; 3
DUMP =&gt; [3, 9, 7]</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                    </th><th>value                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">3</pre></td></tr> <tr><td><pre style="text-align:left;">1</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">9</pre></td></tr> <tr><td><pre style="text-align:left;">2</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">7</pre></td></tr></tbody></table></div> <p>In its simplest form, <strong><code>ITER</code></strong> only takes a <em>body expression</em> (the two curly braces) and runs every element of the list against the code inside the curly braces. The first element is pushed onto the stack and the instructions inside the curly braces are run as usual. When there are no more instructions to run, <strong><code>ITER</code></strong> pushes the second element of the list onto the stack, runs the instructions, and so on until the end of the list.</p> <p>To demonstrate it, we could take each element of the list and add <code>2</code> to it:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">DROP_ALL</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">7</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">9</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">ITER</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">2</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">ADD</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH / _ =&gt; [7, 9, 3]
ITER / [7, 9, 3] =&gt; 7
PUSH / _ =&gt; 2
ADD / 2 : 7 =&gt; 9
ITER / _ =&gt; 9
PUSH / _ =&gt; 2
ADD / 2 : 9 =&gt; 11
ITER / _ =&gt; 3
PUSH / _ =&gt; 2
ADD / 2 : 3 =&gt; 5
DUMP =&gt; [5, 11, 9]</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                    </th><th>value                                  </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">5</pre></td></tr> <tr><td><pre style="text-align:left;">1</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">11</pre></td></tr> <tr><td><pre style="text-align:left;">2</pre></td><td><pre style="text-align:left;">int</pre></td><td><pre style="text-align:left;">9</pre></td></tr></tbody></table></div> <p>First observation from this code snippet, <strong><code>ITER</code></strong> removes the list from the stack. Make sure to duplicate it if you need it later.<br>
Next, the elements present in the stack are indeed the values from the list + <code>2</code> for each value. Remember that the first value in the list will be the last one in the resulting stack. Here is another example:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">DROP_ALL</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">&quot;John&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;Amir&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">&quot;Stella&quot;</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">ITER</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Hello &quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">CONCAT</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH / _ =&gt; ['John', 'Amir', 'Stella']
ITER / ['John', 'Amir', 'Stella'] =&gt; 'John'
PUSH / _ =&gt; 'Hello '
CONCAT / 'Hello ' : 'John' =&gt; 'Hello John'
ITER / _ =&gt; 'Amir'
PUSH / _ =&gt; 'Hello '
CONCAT / 'Hello ' : 'Amir' =&gt; 'Hello Amir'
ITER / _ =&gt; 'Stella'
PUSH / _ =&gt; 'Hello '
CONCAT / 'Hello ' : 'Stella' =&gt; 'Hello Stella'
DUMP =&gt; ['Hello Stella', 'Hello Amir', 'Hello John']</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                       </th><th>value                                            </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">Hello Stella</pre></td></tr> <tr><td><pre style="text-align:left;">1</pre></td><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">Hello Amir</pre></td></tr> <tr><td><pre style="text-align:left;">2</pre></td><td><pre style="text-align:left;">string</pre></td><td><pre style="text-align:left;">Hello John</pre></td></tr></tbody></table></div> <p>This is how you can greet all the people in a list! <strong><code>ITER</code></strong> goes through the list, takes the elements one by one and adds &quot;Hello &quot; in front of each name. You can add the level of complexity you want in the body expression (we'll keep that for the exercices!)</p> <p>The second iterative instruction is <strong><code>MAP</code></strong>. It works in a very similar fashion: you write a body expression next to the instruction with the instructions you want to apply to the elements of the list. However, this time, <strong><code>MAP</code></strong> is going to return a new list!</p> <p>To observe clearly the difference between these two instruction, let's get our first example and replace <strong><code>ITER</code></strong> with <strong><code>MAP</code></strong>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">DROP_ALL</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">7</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">9</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">MAP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">2</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">ADD</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH / _ =&gt; [7, 9, 3]
MAP / [7, 9, 3] =&gt; 7
PUSH / _ =&gt; 2
ADD / 2 : 7 =&gt; 9
MAP / 9 =&gt; 9
PUSH / _ =&gt; 2
ADD / 2 : 9 =&gt; 11
MAP / 11 =&gt; 3
PUSH / _ =&gt; 2
ADD / 2 : 3 =&gt; 5
MAP / 5 =&gt; [9, 11, 5]
DUMP =&gt; [[9, 11, 5]]</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                           </th><th>value                                          </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">list (int)</pre></td><td><pre style="text-align:left;">[9, 11, 5]</pre></td></tr></tbody></table></div> <p>As you can see, instead of having all the updated elements of the list one on top of the other in the stack, we have a single list where all the elements are in the same order as the previous one and are the result of the previous element value + <code>2</code>.</p> <p>As you can imagine, this is a powerful feature, it allows you to update a list of values in the same exact way. We can go even further with the pattern and apply a conditional to it. For example, you can ask the contract to increase the value in the list only if it is above a certain value:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">DROP_ALL</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">list</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token number">7</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">9</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token number">2</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token operator">MAP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">4</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">IFCMPGT</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">2</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token operator">ADD</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PUSH / _ =&gt; [7, 9, 3, 4, 2]
MAP / [7, 9, 3, 4, 2] =&gt; 7
DUP / 7 =&gt; 7 : 7
PUSH / _ =&gt; 4
SWAP / 4 : 7 =&gt; 7 : 4
COMPARE / 7 : 4 =&gt; 1
GT / 1 =&gt; True
IF / True =&gt; _
PUSH / _ =&gt; 2
ADD / 2 : 7 =&gt; 9
MAP / 9 =&gt; 9
DUP / 9 =&gt; 9 : 9
PUSH / _ =&gt; 4
SWAP / 4 : 9 =&gt; 9 : 4
COMPARE / 9 : 4 =&gt; 1
GT / 1 =&gt; True
IF / True =&gt; _
PUSH / _ =&gt; 2
ADD / 2 : 9 =&gt; 11
MAP / 11 =&gt; 3
DUP / 3 =&gt; 3 : 3
PUSH / _ =&gt; 4
SWAP / 4 : 3 =&gt; 3 : 4
COMPARE / 3 : 4 =&gt; -1
GT / -1 =&gt; False
IF / False =&gt; _
MAP / 3 =&gt; 4
DUP / 4 =&gt; 4 : 4
PUSH / _ =&gt; 4
SWAP / 4 : 4 =&gt; 4 : 4
COMPARE / 4 : 4 =&gt; 0
GT / 0 =&gt; False
IF / False =&gt; _
MAP / 4 =&gt; 2
DUP / 2 =&gt; 2 : 2
PUSH / _ =&gt; 4
SWAP / 4 : 2 =&gt; 2 : 4
COMPARE / 2 : 4 =&gt; -1
GT / -1 =&gt; False
IF / False =&gt; _
MAP / 2 =&gt; [9, 11, 3, 4, 2]
DUMP =&gt; [[9, 11, 3, 4, 2]]</pre></div> <div class="embedded-html"><h4>Stack updates</h4><table><thead><tr><th>index                                 </th><th>type                                           </th><th>value                                                </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">0</pre></td><td><pre style="text-align:left;">list (int)</pre></td><td><pre style="text-align:left;">[9, 11, 3, 4, 2]</pre></td></tr></tbody></table></div> <p>Don't let the long list of operations scare you, what happens under the hood is actually quite simple!<br>
First, we add a new list of <code>int</code> on top of the stack. Then, we loop through it using the <strong><code>MAP</code></strong> instruction. At the beginning of each iteration, the <strong><code>MAP</code></strong> instruction pushes the current value on the stack. We duplicate it (because we will need this value later if the comparison yields <code>True</code>), we push <code>4</code> onto the stack for the comparison and we swap the position of the list value and the comparison element to put them in the right order. <strong><code>IFCMPGT</code></strong> checks if the top element is greater than the element below. If <code>True</code>, we push <code>2</code> and add it to the number remaining on the stack. Otherwise, the value from the list is pushed into the new list with no change. You can use the same type for the new list (like in our example) or you can create a list with a different type too!</p> <div id="bottom-right-wrapper" class="fab-wrapper" style="right:5vw;bottom:4vh;z-index:999;position:fixed;" data-v-f9cfe6e4><div id="bottom-right-action" class="actions-container" style="bottom:-20px;padding-bottom:20px;" data-v-f9cfe6e4><ul class="fab-list" style="display:none;" data-v-f9cfe6e4 data-v-f9cfe6e4><!----><!----></ul></div> <div class="fab-main pointer" style="background-color:#c6b29b;padding:28px;" data-v-f9cfe6e4><i class="md-24 material-icons main" data-v-f9cfe6e4>add</i> <i class="md-24 material-icons close" data-v-f9cfe6e4>add</i></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/chapters/06.html" class="prev">
        Chapter 6
      </a></span> <span class="next"><a href="/chapters/08.html">
        Chapter 8
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2d71d757.js" defer></script><script src="/assets/js/2.430b66b2.js" defer></script><script src="/assets/js/16.5316cf4d.js" defer></script><script src="/assets/js/4.c279c943.js" defer></script><script src="/assets/js/3.550cb5aa.js" defer></script>
  </body>
</html>
