<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 2 | Michelson Labs</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
    <meta name="description" content="This chapter introduces types in Michelson, advanced stack usage and stack protection instructions.">
    <meta name="image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:title" content="Chapter 2">
    <meta name="twitter:description" content="This chapter introduces types in Michelson, advanced stack usage and stack protection instructions.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:url" content="https://michelson.baking-bad.org/chapters/02.html">
    <meta name="twitter:site" content="@TezosBakingBad">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Chapter 2">
    <meta property="og:description" content="This chapter introduces types in Michelson, advanced stack usage and stack protection instructions.">
    <meta property="og:image" content="https://michelson.baking-bad.org/og.png">
    <meta property="og:url" content="https://michelson.baking-bad.org/chapters/02.html">
    <meta property="og:site_name" content="Michelson Labs">
    <meta itemprop="name" content="Chapter 2">
    <meta itemprop="description" content="This chapter introduces types in Michelson, advanced stack usage and stack protection instructions.">
    <meta itemprop="image" content="https://michelson.baking-bad.org/og.png">
    <link rel="preload" href="/assets/css/0.styles.30d6b7cd.css" as="style"><link rel="preload" href="/assets/js/app.0f07c6a2.js" as="script"><link rel="preload" href="/assets/js/2.430b66b2.js" as="script"><link rel="preload" href="/assets/js/11.c8bcd423.js" as="script"><link rel="preload" href="/assets/js/4.c279c943.js" as="script"><link rel="preload" href="/assets/js/3.550cb5aa.js" as="script"><link rel="prefetch" href="/assets/js/10.39ae3c42.js"><link rel="prefetch" href="/assets/js/12.4daeeb25.js"><link rel="prefetch" href="/assets/js/13.a75e832a.js"><link rel="prefetch" href="/assets/js/14.8778eaa1.js"><link rel="prefetch" href="/assets/js/15.8fc30b52.js"><link rel="prefetch" href="/assets/js/16.3dcbedbb.js"><link rel="prefetch" href="/assets/js/17.f4089664.js"><link rel="prefetch" href="/assets/js/18.8c8e2dab.js"><link rel="prefetch" href="/assets/js/19.2f489976.js"><link rel="prefetch" href="/assets/js/20.52755843.js"><link rel="prefetch" href="/assets/js/21.2bcbd1eb.js"><link rel="prefetch" href="/assets/js/22.77994f1a.js"><link rel="prefetch" href="/assets/js/23.cfbbd282.js"><link rel="prefetch" href="/assets/js/24.e396ce94.js"><link rel="prefetch" href="/assets/js/25.2624171d.js"><link rel="prefetch" href="/assets/js/5.b2436255.js"><link rel="prefetch" href="/assets/js/6.cb0bbb2c.js"><link rel="prefetch" href="/assets/js/7.16d6fa11.js"><link rel="prefetch" href="/assets/js/8.c7c848cc.js"><link rel="prefetch" href="/assets/js/9.d1dbceb8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.30d6b7cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_small.png" alt="Michelson Labs" class="logo"> <span class="site-name can-hide">Michelson Labs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learn.html" class="sidebar-link">Learn Michelson</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn.html#why-ü§î" class="sidebar-link">Why ü§î</a></li><li class="sidebar-sub-header"><a href="/learn.html#how" class="sidebar-link">How</a></li><li class="sidebar-sub-header"><a href="/learn.html#resources" class="sidebar-link">Resources</a></li><li class="sidebar-sub-header"><a href="/learn.html#contact-us" class="sidebar-link">Contact us</a></li><li class="sidebar-sub-header"><a href="/learn.html#about" class="sidebar-link">About</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Notebooks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction.html" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/introduction.html#try-online" class="sidebar-link">Try online</a></li><li class="sidebar-sub-header"><a href="/introduction.html#run-in-docker" class="sidebar-link">Run in Docker</a></li><li class="sidebar-sub-header"><a href="/introduction.html#install-jupyter" class="sidebar-link">Install Jupyter</a></li><li class="sidebar-sub-header"><a href="/introduction.html#notebook-workflow" class="sidebar-link">Notebook workflow</a></li></ul></li><li><a href="/chapters/01.html" class="sidebar-link">Chapter 1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/01.html#understanding-the-stack" class="sidebar-link">Understanding the stack</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#structure-of-a-smart-contract" class="sidebar-link">Structure of a Smart Contract</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#operation-codes" class="sidebar-link">Operation codes</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#running-the-contract-step-by-step" class="sidebar-link">Running the contract step-by-step</a></li></ul></li><li><a href="/chapters/02.html" aria-current="page" class="active sidebar-link">Chapter 2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/02.html#types-in-michelson" class="sidebar-link">Types in Michelson</a></li><li class="sidebar-sub-header"><a href="/chapters/02.html#advanced-stack-usage" class="sidebar-link">Advanced stack usage</a></li></ul></li><li><a href="/chapters/03.html" class="sidebar-link">Chapter 3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/03.html#compare-and-generic-comparisons" class="sidebar-link">Compare and generic comparisons</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#conditionals" class="sidebar-link">Conditionals</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#fail-and-assert" class="sidebar-link">FAIL and ASSERT</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#recap" class="sidebar-link">Recap</a></li></ul></li><li><a href="/chapters/04.html" class="sidebar-link">Chapter 4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/04.html#available-types-for-arithmetic-operations" class="sidebar-link">Available types for arithmetic operations</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-add-instruction" class="sidebar-link">The `ADD` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-sub-instruction" class="sidebar-link">The `SUB` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-mul-instruction" class="sidebar-link">The `MUL` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-ediv-instruction" class="sidebar-link">The `EDIV` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#other-operations-on-numeric-values" class="sidebar-link">Other operations on numeric values</a></li></ul></li><li><a href="/chapters/05.html" class="sidebar-link">Chapter 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/05.html#mutez-and-mutez-operations" class="sidebar-link">mutez and mutez operations</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#balance-amount-and-now" class="sidebar-link">`BALANCE`, `AMOUNT` and `NOW`</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#address-contract-and-token-transfer" class="sidebar-link">Address, contract and token transfer</a></li></ul></li><li><a href="/chapters/06.html" class="sidebar-link">Chapter 6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/06.html#boolean-type-and-operations-on-booleans" class="sidebar-link">Boolean type and operations on booleans</a></li><li class="sidebar-sub-header"><a href="/chapters/06.html#cryptographic-operations" class="sidebar-link">Cryptographic operations</a></li></ul></li><li><a href="/chapters/07.html" class="sidebar-link">Chapter 7</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/07.html#strings-and-string-manipulations" class="sidebar-link">Strings and string manipulations</a></li><li class="sidebar-sub-header"><a href="/chapters/07.html#working-with-lists" class="sidebar-link">Working with lists</a></li></ul></li><li><a href="/chapters/08.html" class="sidebar-link">Chapter 8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/08.html#overview-of-the-pair-type" class="sidebar-link">Overview of the pair type</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#operations-on-pairs" class="sidebar-link">Operations on pairs</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#pairing-and-unpairing" class="sidebar-link">Pairing and unpairing</a></li></ul></li><li><a href="/chapters/09.html" class="sidebar-link">Chapter 9</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/09.html#casting-types" class="sidebar-link">Casting types</a></li><li class="sidebar-sub-header"><a href="/chapters/09.html#working-with-bytes" class="sidebar-link">Working with bytes</a></li></ul></li><li><a href="/chapters/10.html" class="sidebar-link">Chapter 10</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-sets" class="sidebar-link">Working with sets</a></li><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-maps" class="sidebar-link">Working with maps</a></li></ul></li><li><a href="/chapters/11.html" class="sidebar-link">Chapter 11</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/11.html#the-loop-instruction" class="sidebar-link">The `LOOP` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-sets" class="sidebar-link">Iterating on sets</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-maps" class="sidebar-link">Iterating on maps</a></li></ul></li><li><a href="/chapters/12.html" class="sidebar-link">Chapter 12</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/12.html#union-types-and-entrypoints" class="sidebar-link">Union types and entrypoints</a></li></ul></li><li><a href="/chapters/13.html" class="sidebar-link">Chapter 13</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/13.html#address-and-contract-types" class="sidebar-link">Address and contract types</a></li><li class="sidebar-sub-header"><a href="/chapters/13.html#self-source-and-sender" class="sidebar-link">SELF, SOURCE and SENDER</a></li></ul></li><li><a href="/chapters/14.html" class="sidebar-link">Chapter 14</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/14.html#creating-and-sending-transactions" class="sidebar-link">Creating and sending transactions</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#delegating-contract-funds" class="sidebar-link">Delegating contract funds</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#originating-new-contracts" class="sidebar-link">Originating new contracts</a></li></ul></li><li><a href="/chapters/15.html" class="sidebar-link">Chapter 15</a></li><li><a href="/chapters/99.html" class="sidebar-link">Kernel helpers</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-2"><a href="#chapter-2" class="header-anchor">#</a> Chapter 2</h1> <p>This chapter introduces types in Michelson, advanced stack usage and stack protection instructions.</p> <h2 id="types-in-michelson"><a href="#types-in-michelson" class="header-anchor">#</a> Types in Michelson</h2> <p>Michelson is a strongly typed language with no type inference, which means that you must always indicate which type you are using to the typechecker. The typechecker will then check that all the values used in the contract are correctly typed.<br>
For example, if you write <code>PUSH int 3 ; PUSH string &quot;hello&quot; ; ADD ;</code>, the typechecker will throw an error as you cannot add an integer and a string together:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token comment">## THIS DOESN'T WORK!</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token number">3</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;Hello&quot;</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">ADD</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage unit;
parameter unit;
code { DROP ; PUSH int 3 ; PUSH string &quot;Hello&quot; ; ADD ; NIL operation ; PAIR };
RUN: use %default; drop all; push (Unit, Unit);
DROP: pop (Unit, Unit);
PUSH: push 3;
PUSH: push Hello;
ADD: pop Hello, 3;</pre></div> <div class="stderr"><pre><span class="stream-name">stderr</span><br>MichelsonRuntimeError: unsupported argument types String and Int
at RUN -&gt; ADD</pre></div> <p>It is also worth pointing out that the values you use on the stack are immutable, which means that you cannot &quot;modify&quot; them, you must remove them, add them or concatenate them together to change them.</p> <p>You can find below a list of the most common types in Michelson (a list of all the types is available <a href="https://michelson.nomadic-labs.com/#types" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>):</p> <ul><li>Core data types:
<ul><li><strong>int</strong> (positive and negative numbers)</li> <li><strong>nat</strong> (non negative numbers)</li> <li><strong>string</strong> (one or multiple characters, but can also be empty, as well as some escape sequences: <code>\n</code>, <code>\\</code> and <code>\&quot;</code>)</li> <li><strong>bytes</strong></li> <li><strong>pair</strong> (a pair of two values)</li> <li><strong>bool</strong> (boolean value)</li> <li><strong>unit</strong> (a placeholder type when no value or parameter is required)</li> <li><strong>option</strong> (optional value with 2 possible values: <em>SOME (type)</em> and <em>NONE</em> )</li> <li><strong>list</strong> (a list of ordered values of the same type)</li> <li><strong>set</strong> (a list of unordered unique values of the same type)</li> <li><strong>map</strong> (a list of key/value pairs)</li> <li><strong>big_map</strong> (a lazily deserialized list of key/value pairs, used for large amounts of data)</li></ul></li> <li>Domain specific data types:
<ul><li><strong>timestamp</strong> (dates in RFC 3339 format or unix timestamp)</li> <li><strong>mutez</strong> (Tezos tokens type, represents one millionth of a tez)</li> <li><strong>address</strong> (Tezos addresses)</li> <li><strong>operation</strong> (internal operation emitted by a contract)</li> <li><strong>key</strong> (public cryptographic key)</li></ul></li></ul> <p>Some of these types are called <a href="https://tezos.gitlab.io/whitedoc/michelson.html#full-grammar" target="_blank" rel="noopener noreferrer"><strong>comparable types</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which means that the comparison of two values of these types will yield an <em>integer</em> that you can then use to know if they are equal or if one is lower or higher than the other.<br>
For example, <em>int</em>, <em>nat</em>, <em>string</em>, <em>bytes</em>, <em>mutez</em>, <em>bool</em>, <em>timestamp</em> and <em>address</em> are all comparable types.</p> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>Be aware of the syntax for types of values that contain other values: for example <code>(option value)</code> for option, <code>(map key value)</code> for maps, <code>(pair left_value right_value)</code> for pairs, etc.</p></div> <h2 id="advanced-stack-usage"><a href="#advanced-stack-usage" class="header-anchor">#</a> Advanced stack usage</h2> <p>It is time to play with the stack!</p> <p>In order to manipulate the stack, you are going to use <em>instructions</em>. Instructions are generally short words that will create an effect on the stack. For example, you can use an instruction to push another element on top of the stack, an instruction to duplicate an element, an instruction to change the element position, etc.</p> <p>We are going to start with simple instructions for simple operations and write a smart contract that accepts a <em>unit</em> parameter, has a <em>string</em> in the storage and modifies the string in the storage.</p> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>we will use the terms &quot;instruction&quot; and &quot;opcode&quot; interchangeably throughout these tutorials. They both refer to the short words used to manipulate the stack in Michelson.</p></div> <h3 id="inline-code"><a href="#inline-code" class="header-anchor">#</a> Inline code</h3> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CDR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;world&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONCAT</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>storage string;
parameter unit;
code { DUP ; CAR ; SWAP ; CDR ; PUSH string &quot;world&quot; ; SWAP ; CONCAT ; DIP { DROP } ; NIL operation ; PAIR };</pre></div> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">&quot;Hello &quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>RUN: use %default; drop all; push (Unit, 'Hello ');
  DUP: push (Unit, 'Hello ');
  CAR: pop (Unit, 'Hello '); push Unit;
  SWAP: pop Unit, (Unit, 'Hello '); push Unit; push (Unit, 'Hello ');
  CDR: pop (Unit, 'Hello '); push Hello ;
  PUSH: push world;
  SWAP: pop world, Hello ; push world; push Hello ;
  CONCAT: pop Hello ; pop world; push Hello world;
  DIP: protect 1 item(s);
    DROP: pop Unit;
    restore 1 item(s);
  NIL: push [];
  PAIR: pop [], Hello world; push ([], 'Hello world');</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                             </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;Hello world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>this example does some unnecessary stack manipulations whose purpose is only to introduce new instructions and demonstrate how they work. The contract code above would be more efficient like this: <code>CDR ; PUSH string &quot;world&quot; ; SWAP ; CONCAT ; NIL operation ; PAIR</code>.</p></div> <h3 id="step-by-step-execution"><a href="#step-by-step-execution" class="header-anchor">#</a> Step-by-step execution</h3> <p>Every Michelson contract starts with two sections separated by semi-colons that indicate the type of the storage and the parameter.</p> <p>For this example, we want to create a storage that will keep a string and a parameter that will receive a unit:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>parameter unit;
storage string;</pre></div> <p>We start the step-by-step execution by initializing the storage of the smart contract and the received parameter:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">BEGIN</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">&quot;Hello &quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                                  </th><th>type                                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">Pair Unit &quot;Hello &quot;</pre></td><td><pre style="text-align:left;">pair unit string</pre></td></tr></tbody></table></div> <p>The first thing we want to do is duplicate the passed parameter.</p> <p>To <strong>dup</strong>licate an element of the stack, we use the <strong><code>DUP</code></strong> opcode. <strong><code>DUP</code></strong> takes the element at the top of the stack, copies it and pushes it above.</p> <p><em>In a real-world example, this would be an extra step that wouldn't be necessary, but the goal here is to showcase different instructions and how they work together üòÉ</em></p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DUP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                                  </th><th>type                                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">Pair Unit &quot;Hello &quot;</pre></td><td><pre style="text-align:left;">pair unit string</pre></td></tr> <tr><td><pre style="text-align:left;">Pair Unit &quot;Hello &quot;</pre></td><td><pre style="text-align:left;">pair unit string</pre></td></tr></tbody></table></div> <p>The element at the top of the stack is now a <code>pair</code>. A pair is a type of value that consists of two elements in fixed order, that can be labeled as left and right for simplicity. Michelson provides instructions to extract these values so we can manipulate them. The first one is <strong><code>CAR</code></strong> that takes a pair at the top of the stack and returns the value on the left side. Note that the value on the right is taken out of the stack and lost:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                                  </th><th>type                                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">Unit</pre></td><td><pre style="text-align:left;">unit</pre></td></tr> <tr><td><pre style="text-align:left;">Pair Unit &quot;Hello &quot;</pre></td><td><pre style="text-align:left;">pair unit string</pre></td></tr></tbody></table></div> <p>The execution of the contract code always goes from top to bottom, so you may be wondering how to access the pair at the bottom of the stack, if this is the one you want to work with now?</p> <p>Fortunately, Michelson provides opcodes to change the order of the elements on the stack. The first one we encounter, <strong><code>SWAP</code></strong> switches the position of the two elements on top of the stack: the element at index 0 goes to index 1 and the element at index 1 goes to index 0:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                                  </th><th>type                                                 </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">Pair Unit &quot;Hello &quot;</pre></td><td><pre style="text-align:left;">pair unit string</pre></td></tr> <tr><td><pre style="text-align:left;">Unit</pre></td><td><pre style="text-align:left;">unit</pre></td></tr></tbody></table></div> <p>We've introduced the <strong><code>CAR</code></strong> instruction which extract the left part of a pair.</p> <p>To extract the right part of the element on top of the stack, you can use <strong><code>CDR</code></strong>. As for <strong><code>CAR</code></strong>, the left part of the pair will be removed from the stack and lost:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">CDR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                        </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;Hello &quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr> <tr><td><pre style="text-align:left;">Unit</pre></td><td><pre style="text-align:left;">unit</pre></td></tr></tbody></table></div> <p>You can now see above that the stack consists of the string <em>&quot;Hello &quot;</em> and a unit.</p> <p>Let's continue and add a string on top of the stack with the <strong><code>PUSH</code></strong> instruction:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">string</span><span class="token punctuation"> </span><span class="token number">&quot;world&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                        </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr> <tr><td><pre style="text-align:left;">&quot;Hello &quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr> <tr><td><pre style="text-align:left;">Unit</pre></td><td><pre style="text-align:left;">unit</pre></td></tr></tbody></table></div> <p>We should put the two strings on top of the stack in the right order so we can store <em>&quot;Hello world&quot;</em>. We use the <strong><code>SWAP</code></strong> instruction for that:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">SWAP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                        </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;Hello &quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr> <tr><td><pre style="text-align:left;">&quot;world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr> <tr><td><pre style="text-align:left;">Unit</pre></td><td><pre style="text-align:left;">unit</pre></td></tr></tbody></table></div> <p>Once in the right order, we want to put the two strings together to write &quot;Hello world&quot;.</p> <p>Michelson provides an instruction that just does that: <strong><code>CONCAT</code></strong>. It takes the two strings at the top of the stack and returns a single string made of the two previous strings, one after the other.</p> <p>As usual, you must be sure there are two values of type <code>string</code> on top of the stack. <strong><code>CONCAT</code></strong> will not work with integers, booleans, etc. and it will raise an error at type checking:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">CONCAT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                             </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;Hello world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr> <tr><td><pre style="text-align:left;">Unit</pre></td><td><pre style="text-align:left;">unit</pre></td></tr></tbody></table></div> <p>The next line introduces two important instructions.</p> <p>We now have two elements in the stack: a string at <em>index 0</em> and a unit at <em>index 1</em>. We only want to keep the string and we want to get rid of the unit. We could use <strong><code>SWAP</code></strong> to put the unit on the top of the stack and remove it, but let's keep things interesting and use another approach.</p> <p>Michelson provides an instruction that will bypass the element at the indicated position and work on the element just below. This instruction is <strong><code>DIP n</code></strong> (<em>n</em> being the position of the element to bypass).</p> <p>Regarding the positions you may use after <strong><code>DIP</code></strong>, there are two situations that require a special attention:</p> <ul><li><strong><code>DIP 0</code></strong>: This is equivalent to not using the instruction at all (there is no element at the zero position)!</li> <li><strong><code>DIP 1</code></strong>: This is equivalent to using <strong><code>DIP</code></strong> without an element position number, it will bypass the first element of the stack and work on the second one.</li></ul> <p>The <strong><code>DIP</code></strong> instruction is followed by a piece of code that will be executed on the element <em>below</em> the element that was bypassed. This piece of code is surrounded by curly braces.</p> <p>After we bypassed the element in the first position, we want to remove the element at the second position (the <em>unit</em>). Michelson provides the <strong><code>DROP n</code></strong> instruction that just does that: it removes the element at the <em>n</em> position. As for <strong><code>DIP</code></strong>, there are two cases you want to keep in mind:</p> <ul><li><strong><code>DROP 0</code></strong>: This will do nothing as you will try to remove an element that doesn't exist (there is nothing at the zero position of the stack).</li> <li><strong><code>DROP 1</code></strong>: This is equivalent to using <strong><code>DROP</code></strong> without an element position number, it will simply remove the element at the top of the stack.</li></ul> <p>To sum up, the next instruction, <code>DIP { DROP }</code>, will bypass the first element of the stack (<code>DIP</code>) and remove the following element (<code>DROP</code>).</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">DIP</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>DIP: protect 1 item(s);
  DROP: pop Unit;
  restore 1 item(s);</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                             </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;Hello world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <p>Now there is a single string in our stack. It is time to wrap things up and return the final pair.</p> <p>First, we create an empty list of operations with <strong><code>NIL operation</code></strong>:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token keyword">DUMP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                             </th><th>type                                               </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">[]</pre></td><td><pre style="text-align:left;">list operation</pre></td></tr> <tr><td><pre style="text-align:left;">&quot;Hello world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <p>Then, we put the two elements of the stack in a pair:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token operator">PAIR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                                     </th><th>type                                                             </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">Pair {} &quot;Hello world&quot;</pre></td><td><pre style="text-align:left;">pair (list operation) string</pre></td></tr></tbody></table></div> <p>Finally, we use the <strong><code>COMMIT</code></strong> instruction provided by this Jupyter notebook to return the pair containing the empty list of operations and the new storage:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">COMMIT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="embedded-html"><table><thead><tr><th>value                                             </th><th>type                                       </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;Hello world&quot;</pre></td><td><pre style="text-align:left;">string</pre></td></tr></tbody></table></div> <div id="bottom-right-wrapper" class="fab-wrapper" style="right:5vw;bottom:4vh;z-index:999;position:fixed;" data-v-f9cfe6e4><div id="bottom-right-action" class="actions-container" style="bottom:-20px;padding-bottom:20px;" data-v-f9cfe6e4><ul class="fab-list" style="display:none;" data-v-f9cfe6e4 data-v-f9cfe6e4><!----><!----></ul></div> <div class="fab-main pointer" style="background-color:#c6b29b;padding:28px;" data-v-f9cfe6e4><i class="md-24 material-icons main" data-v-f9cfe6e4>add</i> <i class="md-24 material-icons close" data-v-f9cfe6e4>add</i></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/chapters/01.html" class="prev">
        Chapter 1
      </a></span> <span class="next"><a href="/chapters/03.html">
        Chapter 3
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0f07c6a2.js" defer></script><script src="/assets/js/2.430b66b2.js" defer></script><script src="/assets/js/11.c8bcd423.js" defer></script><script src="/assets/js/4.c279c943.js" defer></script><script src="/assets/js/3.550cb5aa.js" defer></script>
  </body>
</html>
