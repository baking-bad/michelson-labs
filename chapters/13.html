<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 13 | Michelson Labs</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
    <meta name="description" content="As much as internal operations are important, they all happen within a predefined context. The Michelson contract doesn't run in a container with no contact with the outside world. A few things that may be necessary for your contract depend on variables from outside the contract. For example, you may want to verify from which address the transaction originated or you may need to forge a transaction to another contract.  ">
    <meta name="image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:title" content="Chapter 13">
    <meta name="twitter:description" content="As much as internal operations are important, they all happen within a predefined context. The Michelson contract doesn't run in a container with no contact with the outside world. A few things that may be necessary for your contract depend on variables from outside the contract. For example, you may want to verify from which address the transaction originated or you may need to forge a transaction to another contract.  ">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://michelson.baking-bad.org/og.png">
    <meta name="twitter:url" content="https://michelson.baking-bad.org/chapters/13.html">
    <meta name="twitter:site" content="@TezosBakingBad">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Chapter 13">
    <meta property="og:description" content="As much as internal operations are important, they all happen within a predefined context. The Michelson contract doesn't run in a container with no contact with the outside world. A few things that may be necessary for your contract depend on variables from outside the contract. For example, you may want to verify from which address the transaction originated or you may need to forge a transaction to another contract.  ">
    <meta property="og:image" content="https://michelson.baking-bad.org/og.png">
    <meta property="og:url" content="https://michelson.baking-bad.org/chapters/13.html">
    <meta property="og:site_name" content="Michelson Labs">
    <meta itemprop="name" content="Chapter 13">
    <meta itemprop="description" content="As much as internal operations are important, they all happen within a predefined context. The Michelson contract doesn't run in a container with no contact with the outside world. A few things that may be necessary for your contract depend on variables from outside the contract. For example, you may want to verify from which address the transaction originated or you may need to forge a transaction to another contract.  ">
    <meta itemprop="image" content="https://michelson.baking-bad.org/og.png">
    <link rel="preload" href="/assets/css/0.styles.41c7ef0c.css" as="style"><link rel="preload" href="/assets/js/app.619c8c83.js" as="script"><link rel="preload" href="/assets/js/2.430b66b2.js" as="script"><link rel="preload" href="/assets/js/22.77994f1a.js" as="script"><link rel="preload" href="/assets/js/4.c279c943.js" as="script"><link rel="preload" href="/assets/js/3.550cb5aa.js" as="script"><link rel="prefetch" href="/assets/js/10.39ae3c42.js"><link rel="prefetch" href="/assets/js/11.c8bcd423.js"><link rel="prefetch" href="/assets/js/12.4daeeb25.js"><link rel="prefetch" href="/assets/js/13.a75e832a.js"><link rel="prefetch" href="/assets/js/14.8778eaa1.js"><link rel="prefetch" href="/assets/js/15.8fc30b52.js"><link rel="prefetch" href="/assets/js/16.3dcbedbb.js"><link rel="prefetch" href="/assets/js/17.f4089664.js"><link rel="prefetch" href="/assets/js/18.8c8e2dab.js"><link rel="prefetch" href="/assets/js/19.2f489976.js"><link rel="prefetch" href="/assets/js/20.52755843.js"><link rel="prefetch" href="/assets/js/21.2bcbd1eb.js"><link rel="prefetch" href="/assets/js/23.cfbbd282.js"><link rel="prefetch" href="/assets/js/24.e396ce94.js"><link rel="prefetch" href="/assets/js/25.2624171d.js"><link rel="prefetch" href="/assets/js/5.b2436255.js"><link rel="prefetch" href="/assets/js/6.cb0bbb2c.js"><link rel="prefetch" href="/assets/js/7.16d6fa11.js"><link rel="prefetch" href="/assets/js/8.c7c848cc.js"><link rel="prefetch" href="/assets/js/9.d1dbceb8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41c7ef0c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_small.png" alt="Michelson Labs" class="logo"> <span class="site-name can-hide">Michelson Labs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/introduction.html" class="nav-link">
  Notebooks 
</a></div><div class="nav-item"><a href="https://baking-bad.org/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learn.html" class="sidebar-link">Learn Michelson</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn.html#why-🤔" class="sidebar-link">Why 🤔</a></li><li class="sidebar-sub-header"><a href="/learn.html#how" class="sidebar-link">How</a></li><li class="sidebar-sub-header"><a href="/learn.html#resources" class="sidebar-link">Resources</a></li><li class="sidebar-sub-header"><a href="/learn.html#contact-us" class="sidebar-link">Contact us</a></li><li class="sidebar-sub-header"><a href="/learn.html#about" class="sidebar-link">About</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Notebooks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction.html" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/introduction.html#try-online" class="sidebar-link">Try online</a></li><li class="sidebar-sub-header"><a href="/introduction.html#run-in-docker" class="sidebar-link">Run in Docker</a></li><li class="sidebar-sub-header"><a href="/introduction.html#install-jupyter" class="sidebar-link">Install Jupyter</a></li><li class="sidebar-sub-header"><a href="/introduction.html#notebook-workflow" class="sidebar-link">Notebook workflow</a></li></ul></li><li><a href="/chapters/01.html" class="sidebar-link">Chapter 1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/01.html#understanding-the-stack" class="sidebar-link">Understanding the stack</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#structure-of-a-smart-contract" class="sidebar-link">Structure of a Smart Contract</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#operation-codes" class="sidebar-link">Operation codes</a></li><li class="sidebar-sub-header"><a href="/chapters/01.html#running-the-contract-step-by-step" class="sidebar-link">Running the contract step-by-step</a></li></ul></li><li><a href="/chapters/02.html" class="sidebar-link">Chapter 2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/02.html#types-in-michelson" class="sidebar-link">Types in Michelson</a></li><li class="sidebar-sub-header"><a href="/chapters/02.html#advanced-stack-usage" class="sidebar-link">Advanced stack usage</a></li></ul></li><li><a href="/chapters/03.html" class="sidebar-link">Chapter 3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/03.html#compare-and-generic-comparisons" class="sidebar-link">Compare and generic comparisons</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#conditionals" class="sidebar-link">Conditionals</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#fail-and-assert" class="sidebar-link">FAIL and ASSERT</a></li><li class="sidebar-sub-header"><a href="/chapters/03.html#recap" class="sidebar-link">Recap</a></li></ul></li><li><a href="/chapters/04.html" class="sidebar-link">Chapter 4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/04.html#available-types-for-arithmetic-operations" class="sidebar-link">Available types for arithmetic operations</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-add-instruction" class="sidebar-link">The `ADD` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-sub-instruction" class="sidebar-link">The `SUB` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-mul-instruction" class="sidebar-link">The `MUL` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#the-ediv-instruction" class="sidebar-link">The `EDIV` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/04.html#other-operations-on-numeric-values" class="sidebar-link">Other operations on numeric values</a></li></ul></li><li><a href="/chapters/05.html" class="sidebar-link">Chapter 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/05.html#mutez-and-mutez-operations" class="sidebar-link">mutez and mutez operations</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#balance-amount-and-now" class="sidebar-link">`BALANCE`, `AMOUNT` and `NOW`</a></li><li class="sidebar-sub-header"><a href="/chapters/05.html#address-contract-and-token-transfer" class="sidebar-link">Address, contract and token transfer</a></li></ul></li><li><a href="/chapters/06.html" class="sidebar-link">Chapter 6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/06.html#boolean-type-and-operations-on-booleans" class="sidebar-link">Boolean type and operations on booleans</a></li><li class="sidebar-sub-header"><a href="/chapters/06.html#cryptographic-operations" class="sidebar-link">Cryptographic operations</a></li></ul></li><li><a href="/chapters/07.html" class="sidebar-link">Chapter 7</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/07.html#strings-and-string-manipulations" class="sidebar-link">Strings and string manipulations</a></li><li class="sidebar-sub-header"><a href="/chapters/07.html#working-with-lists" class="sidebar-link">Working with lists</a></li></ul></li><li><a href="/chapters/08.html" class="sidebar-link">Chapter 8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/08.html#overview-of-the-pair-type" class="sidebar-link">Overview of the pair type</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#operations-on-pairs" class="sidebar-link">Operations on pairs</a></li><li class="sidebar-sub-header"><a href="/chapters/08.html#pairing-and-unpairing" class="sidebar-link">Pairing and unpairing</a></li></ul></li><li><a href="/chapters/09.html" class="sidebar-link">Chapter 9</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/09.html#casting-types" class="sidebar-link">Casting types</a></li><li class="sidebar-sub-header"><a href="/chapters/09.html#working-with-bytes" class="sidebar-link">Working with bytes</a></li></ul></li><li><a href="/chapters/10.html" class="sidebar-link">Chapter 10</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-sets" class="sidebar-link">Working with sets</a></li><li class="sidebar-sub-header"><a href="/chapters/10.html#working-with-maps" class="sidebar-link">Working with maps</a></li></ul></li><li><a href="/chapters/11.html" class="sidebar-link">Chapter 11</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/11.html#the-loop-instruction" class="sidebar-link">The `LOOP` instruction</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-sets" class="sidebar-link">Iterating on sets</a></li><li class="sidebar-sub-header"><a href="/chapters/11.html#iterating-on-maps" class="sidebar-link">Iterating on maps</a></li></ul></li><li><a href="/chapters/12.html" class="sidebar-link">Chapter 12</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/12.html#union-types-and-entrypoints" class="sidebar-link">Union types and entrypoints</a></li></ul></li><li><a href="/chapters/13.html" aria-current="page" class="active sidebar-link">Chapter 13</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/13.html#address-and-contract-types" class="sidebar-link">Address and contract types</a></li><li class="sidebar-sub-header"><a href="/chapters/13.html#self-source-and-sender" class="sidebar-link">SELF, SOURCE and SENDER</a></li></ul></li><li><a href="/chapters/14.html" class="sidebar-link">Chapter 14</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapters/14.html#creating-and-sending-transactions" class="sidebar-link">Creating and sending transactions</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#delegating-contract-funds" class="sidebar-link">Delegating contract funds</a></li><li class="sidebar-sub-header"><a href="/chapters/14.html#originating-new-contracts" class="sidebar-link">Originating new contracts</a></li></ul></li><li><a href="/chapters/15.html" class="sidebar-link">Chapter 15</a></li><li><a href="/chapters/99.html" class="sidebar-link">Kernel helpers</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-13"><a href="#chapter-13" class="header-anchor">#</a> Chapter 13</h1> <p>As much as internal operations are important, they all happen within a predefined context. The Michelson contract doesn't run in a container with no contact with the outside world. A few things that may be necessary for your contract depend on variables from outside the contract. For example, you may want to verify from which address the transaction originated or you may need to forge a transaction to another contract.<br>
Fortunately, Michelson includes several instructions that make manipulating data from the outside world easier. We are going to have a closer look first at the <code>address</code> and <code>contract</code> types before working with addresses available during the execution of the smart contract.</p> <h2 id="address-and-contract-types"><a href="#address-and-contract-types" class="header-anchor">#</a> Address and contract types</h2> <p>We have already encountered the <code>address</code> type in different contracts. The address type can be given to a string that complies with the Tezos address format, may it be the address of an implicit account or of a smart contract. The <code>address</code> type doesn't give any guarantee about the existence or validity of the address, only about its format. For example:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token number">&quot;tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDHrzB&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation"> </span><span class="token comment">## this address doesn't exist</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>parameter unit;
storage address;
code { DROP ; PUSH address &quot;tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDHrzB&quot; ; NIL operation ; PAIR };
RUN: use %default; drop all; push (Unit, '');
DROP: pop (Unit, '');
PUSH: push tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDHrzB;
NIL: push [];
PAIR: pop [], tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDHrzB; push ([], 'tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDHrzB');</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                                                      </th><th>type                                        </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;tz1NhNv9g7rtcjyNsH8Zqu79giY5aTqDHrzB&quot;</pre></td><td><pre style="text-align:left;">address</pre></td></tr></tbody></table></div> <p>As you can see, the interpreter doesn't complain you are using an invalid address 😜</p> <p>If you want to make sure the address is valid and existing, you can cast the address into the <code>contract</code> type. The <code>contract</code> type guarantees that the address is valid and exists in the network. A value of type <code>contract</code> receives a parameter which matches the parameter expected by the contract. It is important here to remember that although using the word <code>contract</code>, these values don't refer exclusively to smart contracts but can also be implicit accounts. An implicit account in the world of Michelson is just a value of type <code>contract</code> with a parameter of type <code>unit</code>. Let's see two examples:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">contract</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">contract</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token number">&quot;tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>parameter unit;
storage (contract unit);
code { DROP ; PUSH (contract unit) &quot;tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v&quot; ; NIL operation ; PAIR };
RUN: use %default; drop all; push (Unit, '');
DROP: pop (Unit, '');
PUSH:</pre></div> <div class="stderr"><pre><span class="stream-name">stderr</span><br>MichelsonRuntimeError: type is not pushable: contract unit
at RUN -&gt; PUSH</pre></div> <p>That's a bummer! Values of type <code>contract</code> are not <em>pushable</em> values, so we will have to cast an address into its <code>contract</code> value:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">contract</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PUSH</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token number">&quot;tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONTRACT</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF_NONE</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>parameter unit;
storage (contract unit);
code { DROP ; PUSH address &quot;tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v&quot; ; CONTRACT unit ; IF_NONE { { UNIT ; FAILWITH } } {} ; NIL operation ; PAIR };
RUN: use %default; drop all; push (Unit, '');
DROP: pop (Unit, '');
PUSH: push tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v;
CONTRACT: pop tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v; skip check; push ('tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v%default',);
IF_NONE: pop ('tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v%default',); push tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v%default;
NIL: push [];
PAIR: pop [], tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v%default; push ([], 'tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v%default');</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                                                              </th><th>type                                              </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v%default&quot;</pre></td><td><pre style="text-align:left;">contract unit</pre></td></tr></tbody></table></div> <p>This requires a few extra steps but that's the price to pay to make sure we have a valid existing value!<br>
First, there must be a value of type address on top of the stack (in this case, an implicit account address). Next, you use the <strong><code>CONTRACT</code></strong> instruction followed by the type of the parameter. In the case of an implicit account, the type is <code>unit</code>. Notice how the <strong><code>CONTRACT</code></strong> instruction returns an <code>optional</code> value. If the address you provided is not valid and/or doesn't exist, <strong><code>CONTRACT</code></strong> returns <code>(None)</code>. Otherwise, we can wrap things up and end the execution of the contract.</p> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>in the context of this notebook, the <strong><code>CONTRACT</code></strong> instruction always returns <code>Some</code> until you specify <code>RESET &quot;mainnet&quot;</code>.</p></div> <p>Let's see how it looks like now if we want to do the same with a contract address:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">contract</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">pair</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONTRACT</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">pair</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF_NONE</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>parameter address;
storage (contract (pair address nat));
code { CAR ; CONTRACT (pair address nat) ; IF_NONE { { UNIT ; FAILWITH } } {} ; NIL operation ; PAIR };
RUN: use %default; drop all; push ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS', '');
CAR: pop ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS', ''); push KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
CONTRACT: pop KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS; skip check; push ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default',);
IF_NONE: pop ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default',); push KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default;
NIL: push [];
PAIR: pop [], KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default; push ([], 'KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default');</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                                                              </th><th>type                                                            </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default&quot;</pre></td><td><pre style="text-align:left;">contract (pair address nat)</pre></td></tr></tbody></table></div> <p>This contract casts the provided address to a value of type <code>contract (pair address nat)</code>. This kind of operation assumes that you know beforehand the type of the parameter of the contract. It will fail if the address you provided cannot be cast to the matching contract type.</p> <p>As we demonstrated, it is possible to go from a value of type <code>address</code> to a value of type <code>contract</code> but the opposite is also possible! You can use the <strong><code>ADDRESS</code></strong> instruction to achieve this result:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CAR</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONTRACT</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">pair</span><span class="token punctuation"> </span><span class="token class-name">address</span><span class="token punctuation"> </span><span class="token class-name">nat</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF_NONE</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">ADDRESS</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">&quot;KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS&quot;</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>parameter address;
storage address;
code { CAR ; CONTRACT (pair address nat) ; IF_NONE { { UNIT ; FAILWITH } } {} ; ADDRESS ; NIL operation ; PAIR };
RUN: use %default; drop all; push ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS', '');
CAR: pop ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS', ''); push KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
CONTRACT: pop KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS; skip check; push ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default',);
IF_NONE: pop ('KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default',); push KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default;
ADDRESS: pop KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS%default; push KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
NIL: push [];
PAIR: pop [], KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS; push ([], 'KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS');</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                                                      </th><th>type                                        </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS&quot;</pre></td><td><pre style="text-align:left;">address</pre></td></tr></tbody></table></div> <p>The example above shows that if you cast a value of type <code>address</code> to a value of type <code>contract</code> before casting it again to a value of type <code>address</code>, you get the original address back!</p> <h2 id="self-source-and-sender"><a href="#self-source-and-sender" class="header-anchor">#</a> SELF, SOURCE and SENDER</h2> <p>A Michelson contract runs in an environment where different variables influencing the contract are available and only one instruction away from the stack! We already encountered different instructions that push environment information onto the stack like <strong><code>AMOUNT</code></strong> or <strong><code>NOW</code></strong>. Three instructions are related to the topic at hand, <code>address</code> and <code>contract</code> types.</p> <p>The first one is <strong><code>SELF</code></strong> that you can use to push the address of the current contract as a value of type <code>contract</code>. The parameter refers to the parameter of the current contract:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token punctuation">(</span><span class="token class-name">contract</span><span class="token punctuation"> </span><span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SELF</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">0</span><span class="token punctuation"> </span><span class="token number">&quot;&quot;</span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>parameter int;
storage (contract int);
code { DROP ; SELF ; NIL operation ; PAIR };
RUN: use %default; drop all; push (0, '');
DROP: pop (0, '');
SELF: use %default; push KT1BEqzn5Wx8uJrZNvuS9DVHmLvG9td3fDLi%default;
NIL: push [];
PAIR: pop [], KT1BEqzn5Wx8uJrZNvuS9DVHmLvG9td3fDLi%default; push ([], 'KT1BEqzn5Wx8uJrZNvuS9DVHmLvG9td3fDLi%default');</pre></div> <div class="embedded-html"><table><thead><tr><th>value                                                                              </th><th>type                                             </th></tr></thead> <tbody><tr><td><pre style="text-align:left;">&quot;KT1BEqzn5Wx8uJrZNvuS9DVHmLvG9td3fDLi%default&quot;</pre></td><td><pre style="text-align:left;">contract int</pre></td></tr></tbody></table></div> <p>Although it may be difficult to see the value of getting the address of the current contract, this will become a lot more valuable in the next chapter when we will explore inter-contract operations.</p> <p>Next, we are going to explore two instructions that are similar but widely different in what they achieve and it is very important to understand their difference to avoid bugs in your contracts. <strong><code>SOURCE</code></strong> and <strong><code>SENDER</code></strong> are two instructions that push onto the stack the address that created the transaction. However, the difference lays in the transaction we are talking about: in the case of <strong><code>SOURCE</code></strong>, the address you get is the address of the implicit account from which the very first transaction was sent (in general, this will be from a human user). There was nothing before the address that <strong><code>SOURCE</code></strong> pushes onto the stack. In the case of <strong><code>SENDER</code></strong>, the address you get on the stack is the immediate creator of the current transaction which means that in a row of transactions, the address could be the one of a smart contract. If a user sends a transaction from a dapp that will be relayed between a couple of smart contracts, <strong><code>SENDER</code></strong> will return the instigator of the current transaction while <strong><code>SOURCE</code></strong> will return the address that started all the subsequent transactions.<br>
It is particularly important to understand the difference in contracts that implement some kind of address-based authentication: if they use the address provided by <strong><code>SENDER</code></strong>, the address could be the one of a smart contract acting on someone else's behalf. If they use the address provided by <strong><code>SOURCE</code></strong>, the address will be the one of an implicit account.</p> <p>Let's see an example that verifies if the address returned by <strong><code>SENDER</code></strong> is an implicit account:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">PATCH</span><span class="token punctuation"> </span><span class="token operator">SENDER</span><span class="token punctuation"> </span><span class="token number">&quot;KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SENDER</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">CONTRACT</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">IF_NONE</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token variable">FAIL</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UNIT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">RESET</span><span class="token punctuation"> </span><span class="token number">&quot;mainnet&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PATCH: set SENDER=KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
RESET: set NETWORK='mainnet';
RESET: set NETWORK='mainnet';
PATCH: set SENDER=KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
storage unit;
parameter unit;
code { SENDER ; CONTRACT unit ; IF_NONE { { UNIT ; FAILWITH } } { DROP } ; UNIT ; NIL operation ; PAIR };
RUN: use %default; use mainnet; drop all; push (Unit, Unit);
SENDER: push KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
CONTRACT: pop KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS; not found; push None;
IF_NONE: pop None;
UNIT: push Unit;
FAILWITH: pop Unit;</pre></div> <div class="stderr"><pre><span class="stream-name">stderr</span><br>MichelsonRuntimeError: Unit
at RUN -&gt; IF_NONE -&gt; FAILWITH</pre></div> <p>The contract fails if you pass the address of a contract as parameter (note that it won't fail with a contract that accepts a parameter of type <code>unit</code>, this code is only used for the sake of demonstration).</p> <p>You could also compare <strong><code>SOURCE</code></strong> with <strong><code>SENDER</code></strong> to ensure that you are dealing with the very first transaction:</p> <div class="language-Michelson extra-class"><pre class="language-Michelson"><code class="language-Michelson"><span class="token keyword">PATCH</span><span class="token punctuation"> </span><span class="token operator">SOURCE</span><span class="token punctuation"> </span><span class="token number">&quot;tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">PATCH</span><span class="token punctuation"> </span><span class="token operator">SENDER</span><span class="token punctuation"> </span><span class="token number">&quot;KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS&quot;</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">parameter</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">storage</span><span class="token punctuation"> </span><span class="token class-name">unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token keyword">code</span><span class="token punctuation"> </span><span class="token punctuation">{</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">DROP</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SENDER</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">SOURCE</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token variable">ASSERT_CMPEQ</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">UNIT</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">NIL</span><span class="token punctuation"> </span><span class="token class-name">operation</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token punctuation"> </span><span class="token operator">PAIR</span><span class="token punctuation">
</span><span class="token punctuation">}</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span><span class="token punctuation">
</span><span class="token keyword">RUN</span><span class="token punctuation"> </span><span class="token attr-name">%default</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token number">Unit</span><span class="token punctuation"> </span><span class="token punctuation">;</span><span class="token punctuation">
</span></code></pre></div><div class="stdout"><pre><span class="stream-name">stdout</span><br>PATCH: set SOURCE=tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v;
PATCH: set SENDER=KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
parameter unit;
storage unit;
code { DROP ; SENDER ; SOURCE ; { { COMPARE ; EQ } ; IF {} { { UNIT ; FAILWITH } } } ; UNIT ; NIL operation ; PAIR };
RUN: use %default; drop all; push (Unit, Unit);
DROP: pop (Unit, Unit);
SENDER: push KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS;
SOURCE: push tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v;
COMPARE: pop tz1SjrNeUE4zyPGSZpogDZd5tvryixNDsD2v, KT1TUx83WuwtA2Ku1pi6A9AZqov7CZfYtLUS; push 1;
EQ: pop 1; push False;
IF: pop False;
UNIT: push Unit;
FAILWITH: pop Unit;</pre></div> <div class="stderr"><pre><span class="stream-name">stderr</span><br>MichelsonRuntimeError: Unit
at RUN -&gt; IF -&gt; FAILWITH</pre></div> <div id="bottom-right-wrapper" class="fab-wrapper" style="right:5vw;bottom:4vh;z-index:999;position:fixed;" data-v-f9cfe6e4><div id="bottom-right-action" class="actions-container" style="bottom:-20px;padding-bottom:20px;" data-v-f9cfe6e4><ul class="fab-list" style="display:none;" data-v-f9cfe6e4 data-v-f9cfe6e4><!----><!----></ul></div> <div class="fab-main pointer" style="background-color:#c6b29b;padding:28px;" data-v-f9cfe6e4><i class="md-24 material-icons main" data-v-f9cfe6e4>add</i> <i class="md-24 material-icons close" data-v-f9cfe6e4>add</i></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/chapters/12.html" class="prev">
        Chapter 12
      </a></span> <span class="next"><a href="/chapters/14.html">
        Chapter 14
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.619c8c83.js" defer></script><script src="/assets/js/2.430b66b2.js" defer></script><script src="/assets/js/22.77994f1a.js" defer></script><script src="/assets/js/4.c279c943.js" defer></script><script src="/assets/js/3.550cb5aa.js" defer></script>
  </body>
</html>
