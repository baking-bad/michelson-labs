(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{370:function(t,a,s){"use strict";s.r(a);var e=s(43),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"chapter-1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chapter-1"}},[t._v("#")]),t._v(" Chapter 1")]),t._v(" "),s("p",[t._v("This chapter is an introduction to Michelson smart contracts structure and conventions.")]),t._v(" "),s("h2",{attrs:{id:"understanding-the-stack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#understanding-the-stack"}},[t._v("#")]),t._v(" Understanding the stack")]),t._v(" "),s("p",[t._v("Michelson is a "),s("em",[t._v("low-level")]),t._v(" programming language, which means that it doesn't offer all the features of "),s("em",[t._v("high-level")]),t._v(" programming languages you may be used to, like JavaScript or C++. For example, there are no variables in Michelson.")]),t._v(" "),s("p",[t._v('Every time you write code in Michelson, you must keep something in mind called "'),s("strong",[t._v("the stack")]),t._v('". You can imagine the stack as a game of Jenga: it is a collection of elements that you pile up on top of each other, the goal of "Michelson Jenga" being to remove all the pieces except for a specific one that must remain at the end. In order to play, you are given a list of '),s("em",[t._v("instructions")]),t._v(" that can manipulate the pieces of the game: you can remove them, change their position, add some more on top, check if two pieces are the same to remove them, etc., but one false move and the stack collapses (which we call "),s("em",[t._v("failing")]),t._v(").")]),t._v(" "),s("p",[t._v("As there are no variables, the position of the elements in the stack is crucial: the instructions you use will operate on the elements according to their positions.")]),t._v(" "),s("h2",{attrs:{id:"structure-of-a-smart-contract"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#structure-of-a-smart-contract"}},[t._v("#")]),t._v(" Structure of a Smart Contract")]),t._v(" "),s("p",[t._v("A smart contract in Michelson displays a simple structure with 3 parts:")]),t._v(" "),s("ol",[s("li",[t._v("A part indicating the type of the parameter")]),t._v(" "),s("li",[t._v("A part indicating the type of the storage")]),t._v(" "),s("li",[t._v("The code to be executed on incoming transactions")])]),t._v(" "),s("p",[t._v("For every incoming transaction, there will be only one argument. However, the argument can be, for example, a pair that contains 2 elements. Likewise, the storage is made of a single value, which can also be a pair, a map, etc. that contains multiple values. When a transaction is sent to the smart contract, a pair is pushed onto the stack containing the parameter sent to the contract and its current storage.")]),t._v(" "),s("p",[t._v("Here is an example of a very simple smart contract (which doesn't modify its storage):")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("DROP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage unit;\nparameter unit;\ncode { DROP ; PUSH unit Unit ; NIL operation ; PAIR };")])]),t._v(" "),s("p",[t._v("The smart contract removes the pair containing the parameter and the storage from the top of the stack, pushes a unit, an empty list of operation and pair them before returning them.")]),t._v(" "),s("p",[t._v("A smart contract in Michelson always has to return a pair containing a list of operations to be run after the end of the current execution and the new storage.")]),t._v(" "),s("p",[t._v("When you are ready to run the smart contract, you can open a new cell and type the following command:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("RUN: use %default; drop all; push (Unit, Unit);\n  DROP: pop (Unit, Unit);\n  PUSH: push Unit;\n  NIL: push [];\n  PAIR: pop [], Unit; push ([], Unit);")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                    ")]),s("th",[t._v("type                                     ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("Unit")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("unit")])])])])])]),t._v(" "),s("p",[s("strong",[t._v("RUN")]),t._v(" starts the execution of the smart contract, "),s("strong",[t._v("%default")]),t._v(" targets the default entry point of the smart contract (the only one there is at the moment), the first "),s("strong",[t._v("Unit")]),t._v(" is the parameter and the second "),s("strong",[t._v("Unit")]),t._v(" is the storage.")]),t._v(" "),s("h2",{attrs:{id:"operation-codes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#operation-codes"}},[t._v("#")]),t._v(" Operation codes")]),t._v(" "),s("p",[t._v("The "),s("em",[t._v("code")]),t._v(" part of the Michelson contract consists of a serie of instructions that the contract will perform every time it is called. These instructions are run top to bottom and may or may not be followed by arguments. In general, for the operation codes that accept arguments, these arguments indicate the position of the element to manipulate in the stack, the type of value associated to the newly created element or the value itself."),s("br"),t._v("\nNote that every instruction ends when a semi-colon is inserted (however, you can omit it for the last instruction in a block (for example "),s("strong",[s("code",[t._v("PAIR")])]),t._v(" at the end).")]),t._v(" "),s("p",[t._v("Let's have a look at the instructions introduced earlier:")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("DROP")])]),t._v(": this instruction gets rid of the first element on top of the stack.")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("PUSH")])]),t._v(": this instruction is the opposite of the "),s("code",[t._v("DROP")]),t._v(" instruction and adds an element on top of the stack."),s("br"),t._v("\n      You must specify the type and the value, for example "),s("code",[t._v('PUSH string "hello"')]),t._v(" or "),s("code",[t._v("PUSH int 3")]),t._v(".")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("NIL")])]),t._v(": like "),s("code",[t._v("PUSH")]),t._v(", "),s("code",[t._v("NIL")]),t._v(" introduces a new element on top of the stack. This element is a list."),s("br"),t._v("\n      After the opcode, you must specify the type of values the list will contain (lists can only contain one single type)."),s("br"),t._v("\n      As we need a list of operations to end the execution of the smart contract, we add an empty list of operations.")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("PAIR")])]),t._v(": finally, as the contract is expecting a pair containing a list of instructions and the new storage, we must create this pair."),s("br"),t._v("\n      The "),s("code",[t._v("PAIR")]),t._v(" opcode takes the two elements on top of the stack and put them together in a pair."),s("br"),t._v("\n      The first one will be in the left position of the pair, the second one in the right position.")]),t._v(" "),s("h2",{attrs:{id:"running-the-contract-step-by-step"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#running-the-contract-step-by-step"}},[t._v("#")]),t._v(" Running the contract step-by-step")]),t._v(" "),s("p",[t._v("This notebook allows you to run the smart contract step-by-step and visualize the state of the stack at every step!")]),t._v(" "),s("p",[t._v("In order to use this feature, there are 3 instructions you must remember. These instructions are only used in the context of these notebooks and are NOT Michelson instructions:")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("BEGIN")])]),t._v(": use it to start the execution of the contract. You must also specify the parameter and the storage as in : "),s("code",[t._v("BEGIN param storage")]),t._v(".")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("DUMP")])]),t._v(": add it to display the current state of the stack.")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("COMMIT")])]),t._v(": use it to end the execution of the contract and return the list/storage pair.")])]),t._v(" "),s("p",[t._v("Let's rewrite the example above and use these three instructions.")]),t._v(" "),s("p",[t._v("First, we set up the storage and parameter types:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage unit;\nparameter unit;")])]),t._v(" "),s("p",[t._v("Then, we start the execution of the smart contract with the "),s("strong",[s("code",[t._v("BEGIN")])]),t._v(" instruction followed by the parameter and the storage:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("BEGIN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                              ")]),s("th",[t._v("type                                               ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("Pair Unit Unit")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("pair unit unit")])])])])])]),t._v(" "),s("p",[t._v("In this example, we are not going to use the storage or the parameter that are automatically pushed onto the stack at the beginning of the execution.")]),t._v(" "),s("p",[t._v("The "),s("strong",[s("code",[t._v("DROP")])]),t._v(" instruction removes the element on top of the stack. Its syntax will be explained in details in the next chapter:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("DROP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("p",[t._v("The "),s("strong",[s("code",[t._v("DUMP")])]),t._v(" instruction is specific to these Jupyter notebooks (it is not a Michelson instruction) and it will simply print the current state of the stack:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token comment"},[t._v("## The stack is empty now as we removed the only element that was there")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("p",[t._v("Next, we are going to insert a new element in the stack.")]),t._v(" "),s("p",[t._v("The "),s("strong",[s("code",[t._v("PUSH")])]),t._v(" instruction pushes a new element on top of the stack. When using it, you must specify the type of the element and its value, for example you can have "),s("code",[t._v("PUSH unit Unit")]),t._v(", "),s("code",[t._v("PUSH int 3")]),t._v(", "),s("code",[t._v('PUSH string "Hello world"')]),t._v(", etc. Make sure the value you choose is of the type you need:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("p",[t._v("Every contract written in Michelson must return a pair value containing two things: a list of operations to be executed when the current execution ends and the new storage.")]),t._v(" "),s("p",[t._v("In case you don't want to execute any operation at the end of your code, you still have to return an empty list of transactions. This is what "),s("strong",[s("code",[t._v("NIL operation")])]),t._v(" does. It pushes an empty list of the type mentioned after "),s("code",[t._v("NIL")]),t._v(" on top of the stack:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("p",[t._v("As mentioned above, our smart contract must return a pair containing a list and the storage. We now have these two elements in the stack, so we can use the "),s("strong",[s("code",[t._v("PAIR")])]),t._v(" instruction to put them together in a pair. Please note that the order of the elements is important: the one in first position will be the left value in the newly created pair, the one in second position will be the right value:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("p",[t._v("After the pair is created, we can manually end the execution of the contract using the Jupyter notebook specific instruction "),s("strong",[s("code",[t._v("COMMIT")])]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("COMMIT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("Binder",{attrs:{filepath:"notebooks/tutorials/01/01_michelson_basics.ipynb"}})],1)}),[],!1,null,null,null);a.default=n.exports}}]);