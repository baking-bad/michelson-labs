(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{382:function(t,a,s){"use strict";s.r(a);var n=s(43),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"chapter-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chapter-5"}},[t._v("#")]),t._v(" Chapter 5")]),t._v(" "),s("p",[t._v("In this new installment of our tutorials, we are going to talk about money!"),s("br"),t._v('\nOne of the main advantages of smart contracts is that they are "programmable money": they let you store, manipulate and send tez in a predictable way. Smart contracts can work as middle men and verify that a set of conditions is met before initiating a transaction, sending a certain amount of tez or doing any other modification.')]),t._v(" "),s("p",[t._v("In the previous tutorials, we encountered a couple of instructions that push useful information about the smart contract and its context onto the stack: you may remember "),s("strong",[s("code",[t._v("NOW")])]),t._v(" that adds the current timestamp on top of the stack. This is not the only one. Michelson provides a few instructions that give you access to a lot of information. In this chapter, we are going to focus on instructions that are related to the financial aspect of smart contracts: "),s("strong",[s("code",[t._v("BALANCE")])]),t._v(", "),s("strong",[s("code",[t._v("AMOUNT")])]),t._v(", "),s("strong",[s("code",[t._v("TRANFER_TOKENS")])]),t._v(". You will also get a refresher about "),s("code",[t._v("mutez")]),t._v(" operations. At the end of the chapter, you will have everything you need to know in order to handle financial operations in your smart contracts ðŸ¤‘")]),t._v(" "),s("h2",{attrs:{id:"mutez-and-mutez-operations"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mutez-and-mutez-operations"}},[t._v("#")]),t._v(" "),s("code",[t._v("mutez")]),t._v(" and "),s("code",[t._v("mutez")]),t._v(" operations")]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("mutez")]),t._v(" (or "),s("em",[t._v("micro-tez")]),t._v(") type is a special type that allows you to manipulate financial values in your smart contracts. "),s("code",[t._v("mutez")]),t._v(" are indivisible and always non-negative (as exposed below, a few restrictions are set to avoid negative values of "),s("code",[t._v("mutez")]),t._v("). It may seem a little strange at the beginning, but "),s("code",[t._v("mutez")]),t._v(" values are NOT tez, they only represent a financial value. If you write "),s("code",[t._v("PUSH mutez 1000")]),t._v(", this doesn't mean you added 1,000 microtez out of thin air in your smart contract. You merely create a value of a certain type to easily manipulate other values.")]),t._v(" "),s("p",[t._v("You can use different arithmetic operations for values of type "),s("code",[t._v("mutez")]),t._v(": "),s("strong",[s("code",[t._v("ADD")])]),t._v(", "),s("strong",[s("code",[t._v("SUB")])]),t._v(", "),s("strong",[s("code",[t._v("MUL")])]),t._v(", "),s("strong",[s("code",[t._v("EDIV")])]),t._v(" with a few restrictions:")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("ADD")])]),t._v(" only works with two values of type "),s("code",[t._v("mutez")])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("SUB")])]),t._v(" only works with two values of type "),s("code",[t._v("mutez")]),t._v(" AND fails if the result of the subtraction is negative")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("MUL")])]),t._v(" only works with one value of type "),s("code",[t._v("mutez")]),t._v(" and one value of type "),s("code",[t._v("nat")]),t._v(", the result is of type "),s("code",[t._v("mutez")])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("EDIV")])]),t._v(" only works with one value of type "),s("code",[t._v("mutez")]),t._v(" and one value of type "),s("code",[t._v("nat")]),t._v(", the result is of type "),s("code",[t._v("option")]),t._v(", "),s("code",[t._v("None")]),t._v(" in case of a division by zero, "),s("code",[t._v("(Some (pair quotient remainder))")]),t._v(" including a pair containing the quotient on the left and the remainder on the right")])]),t._v(" "),s("p",[t._v("In addition to these operations, it is also possible to compare two values of type "),s("code",[t._v("mutez")]),t._v(". Like any other value, this comparison yields an "),s("code",[t._v("int")]),t._v(" between "),s("code",[t._v("-1")]),t._v(" and "),s("code",[t._v("1")]),t._v(".")]),t._v(" "),s("p",[t._v("Now let's see some examples:")]),t._v(" "),s("p",[t._v("We initialize a simple contract to test these operations:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("BEGIN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("1000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage mutez;\nparameter unit;\nBEGIN: use %default; drop all; push (Unit, 1000);")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                              ")]),s("th",[t._v("type                                                ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("Pair Unit 1000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("pair unit mutez")])])])])])]),t._v(" "),s("p",[t._v("Now let's separate the storage and push a new value of type "),s("code",[t._v("mutez")]),t._v(" (nothing new here):")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("CDR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("@storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("2000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("CDR: pop (Unit, 1000); push 1000;\nPUSH: push 2000;")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                    ")]),s("th",[t._v("type                                      ")]),s("th",[t._v("name                                         ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("2000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])]),s("td")]),t._v(" "),s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("1000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("@storage")])])])])])]),t._v(" "),s("p",[t._v("With the "),s("strong",[s("code",[t._v("ADD")])]),t._v(" instruction, we can remove the two values of type "),s("code",[t._v("mutez")]),t._v(" from the stack, add them together and push the result back to the stack:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("ADD")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                    ")]),s("th",[t._v("type                                      ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("3000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])])])])])]),t._v(" "),s("p",[t._v("After adding values together, let's try to subtract one from another! We push a new value of type "),s("code",[t._v("mutez")]),t._v(" and use the one already present in the stack to demonstrate "),s("strong",[s("code",[t._v("SUB")])]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("500")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("SWAP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("SUB")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("PUSH: push 500;\nSWAP: pop 500, 3000; push 500; push 3000;\nSUB: pop 3000, 500; push 2500;")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                    ")]),s("th",[t._v("type                                      ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("2500")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])])])])])]),t._v(" "),s("p",[t._v("Did you notice the "),s("strong",[s("code",[t._v("SWAP")])]),t._v(" instruction? You must make sure that the two elements are in the right order. If you try "),s("code",[t._v("mutez 500 - mutez 3000")]),t._v(", the contract will fail because "),s("code",[t._v("mutez")]),t._v(" values cannot be negative.")]),t._v(" "),s("p",[t._v("Next, we can multiply "),s("code",[t._v("mutez")]),t._v(" values with "),s("code",[t._v("nat")]),t._v(" values (to ensure positive results). In this situation, the order of the values doesn't matter, so no need to swap them:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("nat")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("4")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("MUL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("PUSH: push 4;\nMUL: pop 4, 2500; push 10000;")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                     ")]),s("th",[t._v("type                                      ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("10000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])])])])])]),t._v(" "),s("p",[t._v("As you can see, the value returned by "),s("strong",[s("code",[t._v("MUL")])]),t._v(" is also of type "),s("code",[t._v("mutez")]),t._v(".")]),t._v(" "),s("p",[t._v("As it was the case for the other numeric values, using "),s("strong",[s("code",[t._v("EDIV")])]),t._v(" with "),s("code",[t._v("mutez")]),t._v(" is also a bit more complex. If you remember from the previous chapter, the result of "),s("strong",[s("code",[t._v("EDIV")])]),t._v(" is an option. If you try a division by zero, the option will have the value "),s("code",[t._v("None")]),t._v(". Otherwise, it has a value of type "),s("code",[t._v("pair")]),t._v(" that contains the quotient on the left and the remainder on the right.")]),t._v(" "),s("p",[t._v("We can write a small piece of code that tries to divide the value on top of the stack by the value we've just pushed. If this value is "),s("code",[t._v("0")]),t._v(", the contract fails. Otherwise, it extracts the quotient and the remainder and rearrange them in this order in the stack:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("nat")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("10")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("SWAP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("EDIV")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("IF_NONE")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("string")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"DivisionByZero"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("FAILWITH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("DUP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("CAR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("@quotient")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("SWAP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("CDR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("@remainder")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("SWAP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("PUSH: push 10;\nSWAP: pop 10, 10000; push 10; push 10000;\nEDIV: pop 10000, 10; push ((1000, 0),);\nIF_NONE: pop ((1000, 0),); push (1000, 0);\n  DUP: push (1000, 0);\n  CAR: pop (1000, 0); push 1000;\n  SWAP: pop 1000, (1000, 0); push 1000; push (1000, 0);\n  CDR: pop (1000, 0); push 0;\n  SWAP: pop 0, 1000; push 0; push 1000;")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                    ")]),s("th",[t._v("type                                      ")]),s("th",[t._v("name                                           ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("1000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("@quotient")])])]),t._v(" "),s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("0")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("@remainder")])])])])])]),t._v(" "),s("p",[t._v("The two values we get on the stack are exactly the expected ones: "),s("code",[t._v("10000 / 10 = 1000")]),t._v(" with a remainder of "),s("code",[t._v("0")]),t._v(".")]),t._v(" "),s("p",[t._v("Lastly, we can compare two values of type "),s("code",[t._v("mutez")]),t._v(" and check if one is equal, greater or less than the other one. This will be particularly useful when you want to verify that users send the correct amount of tez required by your contract:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("500")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("COMPARE")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("EQ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("PUSH: push 500;\nCOMPARE: pop 500, 1000; push -1;\nEQ: pop -1; push False;")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                     ")]),s("th",[t._v("type                                     ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("False")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("bool")])])])])])]),t._v(" "),s("p",[t._v("We're adding here an extra step to check if the newly added value in the stack is equal to the one already present. As they are not equal, "),s("code",[t._v("False")]),t._v(" is pushed onto the stack. Obviously, you can use any of the instructions we studied in Chapter three outside of "),s("strong",[s("code",[t._v("EQ")])]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"balance-amount-and-now"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#balance-amount-and-now"}},[t._v("#")]),t._v(" "),s("strong",[s("code",[t._v("BALANCE")])]),t._v(", "),s("strong",[s("code",[t._v("AMOUNT")])]),t._v(" and "),s("strong",[s("code",[t._v("NOW")])])]),t._v(" "),s("p",[t._v("Michelson provides a few instructions that are very useful to check the context of execution.")]),t._v(" "),s("p",[t._v('Every time a smart contract runs, a few "variables" are available about data related to the current execution. For example, every transaction sent to a smart contract has an amount of tez attached to it (even if this is amount may be '),s("code",[t._v("0")]),t._v("). You may want to have access to this amount, for example, to check if the users sent enough tez for the service they requested or to update their token balance."),s("br"),t._v("\nYou can easily add this piece of information to the stack by using "),s("strong",[s("code",[t._v("AMOUNT")])]),t._v(". The "),s("strong",[s("code",[t._v("AMOUNT")])]),t._v(" instruction will simply push a new element on top of the stack of type "),s("code",[t._v("mutez")]),t._v(" whose value is equal to the amount sent along the transaction.")]),t._v(" "),s("p",[t._v("Here are two examples to showcase what you can do with the "),s("strong",[s("code",[t._v("AMOUNT")])]),t._v(" instruction:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("CDR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("IFCMPGT")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("FAIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("100")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage mutez;\nparameter unit;\ncode { CDR ; AMOUNT ; { { COMPARE ; GT } ; IF { AMOUNT ; NIL operation ; PAIR } { { UNIT ; FAILWITH } } } };\nRUN: use %default; drop all; push (Unit, 100);\nCDR: pop (Unit, 100); push 100;\nAMOUNT: push 0;\nCOMPARE: pop 0, 100; push -1;\nGT: pop -1; push False;\nIF: pop False;\nUNIT: push Unit;\nFAILWITH: pop Unit;")])]),t._v(" "),s("div",{staticClass:"stderr"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stderr")]),s("br"),t._v("MichelsonRuntimeError: Unit\nat RUN -> IF -> FAILWITH")])]),t._v(" "),s("p",[t._v("The contract fails as expected. Indeed, there is no tez attached to this transaction, so the value contained in "),s("strong",[s("code",[t._v("AMOUNT")])]),t._v(" is not greater than the one in the storage."),s("br"),t._v("\nBecause this environment is detached from the blockchain, you have to specify yourself the value you want to give to "),s("code",[t._v("amount")]),t._v(" and use a non-Michelson instruction that works only in the context of these notebooks: "),s("strong",[s("code",[t._v("PATCH")])]),t._v(". Here is how it works:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token keyword"},[t._v("PATCH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("200")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("CDR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("IFCMPGT")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("FAIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("100")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage mutez;\nparameter unit;\ncode { PATCH AMOUNT 200 ; CDR ; AMOUNT ; { { COMPARE ; GT } ; IF { AMOUNT ; NIL operation ; PAIR } { { UNIT ; FAILWITH } } } };\nRUN: use %default; drop all; push (Unit, 100);\nPATCH: set AMOUNT=200;\nCDR: pop (Unit, 100); push 100;\nAMOUNT: push 200;\nCOMPARE: pop 200, 100; push 1;\nGT: pop 1; push True;\nIF: pop True;\nAMOUNT: push 200;\nNIL: push [];\nPAIR: pop [], 200; push ([], 200);")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                   ")]),s("th",[t._v("type                                      ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("200")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])])])])])]),t._v(" "),s("p",[t._v("You can see that the newly returned storage is "),s("code",[t._v("mutez 200")]),t._v(" as expected, because "),s("code",[t._v("200")]),t._v(" is greater than "),s("code",[t._v("100")]),t._v(".")]),t._v(" "),s("p",[t._v("Other scenario: you create a smart contract and you want to prevent people from sending any tez. To do so, you must check if the amount is equal to "),s("code",[t._v("0")]),t._v(" before proceeding and if it is not the case, the contract fails:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("string")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token keyword"},[t._v("PATCH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("DROP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("0")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("IFCMPNEQ")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("FAIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("string")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"No amount!"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('""')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage string;\nparameter unit;\ncode { PATCH AMOUNT ; DROP ; AMOUNT ; PUSH mutez 0 ; { { COMPARE ; NEQ } ; IF { { UNIT ; FAILWITH } } { PUSH string \"No amount!\" ; NIL operation ; PAIR } } };\nRUN: use %default; drop all; push (Unit, '');\nPATCH: unset AMOUNT;\nDROP: pop (Unit, '');\nAMOUNT: push 0;\nPUSH: push 0;\nCOMPARE: pop 0, 0; push 0;\nNEQ: pop 0; push False;\nIF: pop False;\nPUSH: push No amount!;\nNIL: push [];\nPAIR: pop [], No amount!; push ([], 'No amount!');")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                            ")]),s("th",[t._v("type                                       ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v('"No amount!"')])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("string")])])])])])]),t._v(" "),s("p",[t._v("You can also use "),s("code",[t._v("PATCH AMOUNT")]),t._v(" with no value, which will be "),s("code",[t._v("0")]),t._v(" by default. We then use the "),s("strong",[s("code",[t._v("IFCMPNEQ")])]),t._v(" instruction to check if the value on top of the stack (the "),s("code",[t._v("0")]),t._v(" we pushed just before) is not equal to the one below (the amount). Be careful to push a value of type "),s("code",[t._v("mutez")]),t._v(" for the comparison."),s("br"),t._v("\nIf the result of the comparison is true (i.e the amount is not equal to "),s("code",[t._v("0")]),t._v("), the contract fails. Otherwise, we pushed the amount again (remember that every instruction starting with "),s("strong",[s("code",[t._v("IF")])]),t._v(" removes the value(s) on top of the stack) and end the execution by saving the amount in the storage.")]),t._v(" "),s("p",[t._v("In some cases, you would like to know the current balance of the contract before running a piece of code. For example, one of your users requests to withdraw his/her share in the smart contract and you need to make sure there are enough funds before initiating the transaction. You may also want to block incoming transactions if the balance of the contract reaches a certain limit.")]),t._v(" "),s("p",[t._v("In these cases, you can use "),s("strong",[s("code",[t._v("BALANCE")])]),t._v(". Just like "),s("strong",[s("code",[t._v("AMOUNT")])]),t._v(", "),s("strong",[s("code",[t._v("BALANCE")])]),t._v(" is an instruction that pushes a new value on top of the stack containing the current balance of the smart contract in "),s("code",[t._v("mutez")]),t._v(".")]),t._v(" "),s("p",[t._v("Let's write a smart contract that keeps track in the storage of the last transaction sent after making sure the current balance doesn't exceed a certain limit:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("DROP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token keyword"},[t._v("PATCH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("10000000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token comment"},[t._v("## manual setting of amount")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token keyword"},[t._v("PATCH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("BALANCE")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("25700000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token comment"},[t._v("## manual setting of balance")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("AMOUNT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("BALANCE")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("ADD")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("DUP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("100000000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token comment"},[t._v("# 100 tez")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("IFCMPGT")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("string")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"BalanceExceeded"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("FAILWITH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("1000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v('storage mutez;\nparameter unit;\ncode { DROP ; PATCH AMOUNT 10000000 ; PATCH BALANCE 25700000 ; AMOUNT ; BALANCE ; ADD ; DUP ; PUSH mutez 100000000 ; { { COMPARE ; GT } ; IF { NIL operation ; PAIR } { PUSH string "BalanceExceeded" ; FAILWITH } } };\nRUN: use %default; drop all; push (Unit, 1000);\nDROP: pop (Unit, 1000);\nPATCH: set AMOUNT=10000000;\nPATCH: set BALANCE=25700000;\nAMOUNT: push 10000000;\nBALANCE: push 25700000;\nADD: pop 25700000, 10000000; push 35700000;\nDUP: push 35700000;\nPUSH: push 100000000;\nCOMPARE: pop 100000000, 35700000; push 1;\nGT: pop 1; push True;\nIF: pop True;\nNIL: push [];\nPAIR: pop [], 35700000; push ([], 35700000);')])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                        ")]),s("th",[t._v("type                                      ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("35700000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])])])])])]),t._v(" "),s("p",[t._v("This is a very simple smart contract that does one simple thing: it adds the incoming amount to the balance, compares the result with the limit we manually introduce (with "),s("code",[t._v("PUSH mutez 100000000 ;")]),t._v("), if the limit is greater than the addition of the amount and the balance, everything is fine, we save the amount in the storage and end the execution. However, if the limit is exceeded, we throw an error with the "),s("strong",[s("code",[t._v("FAIL")])]),t._v(" instruction.")]),t._v(" "),s("p",[t._v("If you try to change the values (for example adding a "),s("code",[t._v("0")]),t._v(" to the balance), you can make the contract fail to test that it works properly.")]),t._v(" "),s("p",[t._v("We already introduced "),s("strong",[s("code",[t._v("NOW")])]),t._v(" in the previous chapters. The instruction pushes the current timestamp onto the stack. This is a very useful feature for time-related actions: for example, we can make a smart contract fail if a transaction comes before a certain period ended since the last transaction:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("timestamp")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("CDR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("int")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("3600")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token comment"},[t._v("## 60 sec * 60 min = 1 hour interval")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("ADD")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token keyword"},[t._v("PATCH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NOW")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("1592381823")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NOW")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("IFCMPGE")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NOW")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("string")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"InvalidInterval"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("FAILWITH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("1592379223")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v('storage timestamp;\nparameter unit;\ncode { CDR ; PUSH int 3600 ; ADD ; NOW ; { { COMPARE ; GE } ; IF { NOW ; NIL operation ; PAIR } { PUSH string "InvalidInterval" ; FAILWITH } } };\nRUN: use %default; drop all; push (Unit, 1592379223);\nCDR: pop (Unit, 1592379223); push 1592379223;\nPUSH: push 3600;\nADD: pop 3600, 1592379223; push 1592382823;\nNOW: push 1592456946;\nCOMPARE: pop 1592456946, 1592382823; push 1;\nGE: pop 1; push True;\nIF: pop True;\nNOW: push 1592456946;\nNIL: push [];\nPAIR: pop [], 1592456946; push ([], 1592456946);')])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                          ")]),s("th",[t._v("type                                          ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("1592456946")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("timestamp")])])])])])]),t._v(" "),s("p",[t._v("As you can see, the contract stores the timestamp of the last successful execution. When a transaction comes, it adds 3,600 seconds to that timestamp and compares it to the current timestamp. If one hour has passed, the new timestamp is saved into the storage. Otherwise, an error is raised and the contract fails.")]),t._v(" "),s("p",[t._v("In the contract, we use "),s("code",[t._v("PATCH NOW 1592381823")]),t._v(" in order to force a certain value for our "),s("strong",[s("code",[t._v("NOW")])]),t._v(" instruction and see the contract fail. If you comment out this line (just add "),s("code",[t._v("##")]),t._v(" at the very beginning of the line) and run the contract again, you can see that it passes now, because there is more than one hour between "),s("code",[t._v("NOW")]),t._v(" and the timestamp in the storage. The value returned by "),s("strong",[s("code",[t._v("NOW")])]),t._v(" is then saved into the storage.")]),t._v(" "),s("h2",{attrs:{id:"address-contract-and-token-transfer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#address-contract-and-token-transfer"}},[t._v("#")]),t._v(" Address, contract and token transfer")]),t._v(" "),s("p",[t._v("One of the many features of smart contracts is their ability to transfer money. You can send tez to a smart contract, you can send them from the smart contract to an address and you can even exchange tez between smart contracts! You can let anyone transfer money in and out but you can also enforce certain rules that dictate who can make transfers and how these transfers can happen. After reading this section, you will know everything you need to manage tez in your smart contracts!")]),t._v(" "),s("p",[t._v("Let's start from the beginning, with the "),s("code",[t._v("address")]),t._v(" type. "),s("code",[t._v("address")]),t._v(" is a type in Michelson reserved for addresses. It can be used both for implicit account (starting with "),s("em",[t._v("tz1")]),t._v(", "),s("em",[t._v("tz2")]),t._v(" or "),s("em",[t._v("tz3")]),t._v(") and smart contract (starting with "),s("em",[t._v("KT1")]),t._v(") addresses. You can type an address as a string when you want, for example, to add it onto the stack:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("address")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("DROP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("address")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('""')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage address;\nparameter unit;\ncode { DROP ; PUSH address \"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb\" ; NIL operation ; PAIR };\nRUN: use %default; drop all; push (Unit, '');\nDROP: pop (Unit, '');\nPUSH: push tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb;\nNIL: push [];\nPAIR: pop [], tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb; push ([], 'tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb');")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                                                      ")]),s("th",[t._v("type                                        ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb"')])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("address")])])])])])]),t._v(" "),s("p",[t._v("Be aware that the "),s("code",[t._v("address")]),t._v(" type does not ensure that the address is a valid address, only that the string follows the address format.")]),t._v(" "),s("p",[t._v("If you want to ensure that the address is valid, you can use the "),s("code",[t._v("contract (param)")]),t._v(" type. This type guarantees that the address is a valid, existing account with a parameter of type "),s("code",[t._v("param")]),t._v(". In case of an implicit account, "),s("code",[t._v("param")]),t._v(" is equal to "),s("code",[t._v("unit")]),t._v('. It is impossible to "push" a value of type '),s("code",[t._v("contract")]),t._v(" onto the stack but you can receive it as a parameter, you can get it with the "),s("strong",[s("code",[t._v("IMPLICIT_ACCOUNT")])]),t._v(" and "),s("strong",[s("code",[t._v("SELF")])]),t._v(" instructions or you have to start with a value of type "),s("code",[t._v("address")]),t._v(" and cast it to a value of type "),s("code",[t._v("contract")]),t._v(". Let's see an example before detailing what happens:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("(")]),s("span",{staticClass:"token class-name"},[t._v("contract")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(")")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("code")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("DROP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("address")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("CONTRACT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("IF_NONE")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token variable"},[t._v("FAIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("RUN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token attr-name"},[t._v("%default")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('""')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage (contract unit);\nparameter unit;\ncode { DROP ; PUSH address \"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb\" ; CONTRACT unit ; IF_NONE { { UNIT ; FAILWITH } } { NIL operation ; PAIR } };\nRUN: use %default; drop all; push (Unit, '');\nDROP: pop (Unit, '');\nPUSH: push tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb;\nCONTRACT: pop tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb; skip check; push ('tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default',);\nIF_NONE: pop ('tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default',); push tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default;\nNIL: push [];\nPAIR: pop [], tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default; push ([], 'tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default');")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                                                              ")]),s("th",[t._v("type                                              ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default"')])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("contract unit")])])])])])]),t._v(" "),s("p",[t._v("In this example, we convert a value of type "),s("code",[t._v("address")]),t._v(" to a value of type "),s("code",[t._v("contract")]),t._v(" and save the result in the storage. Several steps are necessary to achieve it:")]),t._v(" "),s("ol",[s("li",[t._v("We remove the first element of the stack with "),s("strong",[s("code",[t._v("DROP")])]),t._v(".")]),t._v(" "),s("li",[t._v("We add the address on top of the stack with "),s("strong",[s("code",[t._v("PUSH")])]),t._v(".")]),t._v(" "),s("li",[t._v("We use a special instruction called "),s("strong",[s("code",[t._v("CONTRACT")])]),t._v(" to cast the address to a contract value. Note that we provide a parameter of type "),s("code",[t._v("unit")]),t._v(" indicating that the resulting value will be an implicit account.")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("smart contracts can also have a parameter of type "),s("code",[t._v("unit")]),t._v(", this kind of parameter doesn't necessarily confirm that you are dealing with an implicit account.")])]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("Two things may happen at this point: if the address is invalid or doesn't exist, "),s("strong",[s("code",[t._v("CONTRACT")])]),t._v(" returns the value "),s("code",[t._v("None")]),t._v(" of type option. We can use it to make the contract fail. If the address is valid and exists, "),s("strong",[s("code",[t._v("CONTRACT")])]),t._v(" returns the value "),s("code",[t._v("(Some (contract param))")]),t._v(" of type option that we unwrap in the second branch of the conditional structure to get the value of type "),s("code",[t._v("(contract unit)")]),t._v(". This value is then saved in the storage.")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("In the Jupyter notebooks, the "),s("code",[t._v("Contract")]),t._v(" values are not typechecked, so they always return "),s("code",[t._v("(Some value)")]),t._v(". Be careful when you use your code in a compiler as it can be a source of error.")])]),t._v(" "),s("p",[t._v("In a real-life scenario, you wouldn't probably go through all these steps just to save the result in the storage. This operation can be particularly useful when you want to send tokens from a contract. Michelson provides an instruction that allows you to withdraw tez from the contract balance and send them to an implicit account or another contract: "),s("strong",[s("code",[t._v("TRANSFER_TOKENS")])]),t._v(". The use of this instruction is not difficult by itself but you have to make sure to get its necessary parameters in the right order in the stack before calling it. Let's see an example first to observe what "),s("strong",[s("code",[t._v("TRANSFER_TOKENS")])]),t._v(" does:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token keyword"},[t._v("storage")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("parameter")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("BEGIN")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("PATCH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("BALANCE")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("10000000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("DROP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("storage unit;\nparameter unit;\nBEGIN: use %default; drop all; push (Unit, Unit);\nPATCH: set BALANCE=10000000;\nDROP: pop (Unit, Unit);")])]),t._v(" "),s("p",[t._v("This initializes the storage and the parameter before dropping the first element of the stack. We also add 10 tez to the balance so we have something to send to the receiver's address.")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("address")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("CONTRACT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("PUSH: push tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb;\nCONTRACT: pop tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb; skip check; push ('tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default',);")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                                                                   ")]),s("th",[t._v("type                                                       ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v('Some "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default"')])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("option (contract unit)")])])])])])]),t._v(" "),s("p",[t._v("Like in the previous contract, we push the receiver's address to the stack and convert it to a "),s("code",[t._v("(contract unit)")]),t._v(" type.")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("IF_NONE")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("string")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v('"InvalidAddress"')]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token operator"},[t._v("FAILWITH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("{")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v("}")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                                                              ")]),s("th",[t._v("type                                              ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default"')])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("contract unit")])])])])])]),t._v(" "),s("p",[s("strong",[s("code",[t._v("IF_NONE")])]),t._v(" verifies that the "),s("strong",[s("code",[t._v("CONTRACT")])]),t._v(" instruction succeeded and that a value has been returned. In this case, the value is the address where we will send the tez, of type "),s("code",[t._v("(contract unit)")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("mutez")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("5000000")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                                                              ")]),s("th",[t._v("type                                              ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("5000000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])])]),t._v(" "),s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default"')])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("contract unit")])])])])])]),t._v(" "),s("p",[t._v("We then push the amount we want to send to the receiver's address.")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("PUSH")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token number"},[t._v("Unit")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                                                              ")]),s("th",[t._v("type                                              ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("Unit")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("unit")])])]),t._v(" "),s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("5000000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("mutez")])])]),t._v(" "),s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v('"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb%default"')])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("contract unit")])])])])])]),t._v(" "),s("p",[t._v("Because we are sending an amount to an implicit account, the expected parameter of the value of type "),s("code",[t._v("(contract unit)")]),t._v(" is "),s("code",[t._v("unit")]),t._v(", so we just need to provide an element of type "),s("code",[t._v("unit")]),t._v(" to the "),s("strong",[s("code",[t._v("TRANFER_TOKENS")])]),t._v(" instruction."),s("br"),t._v("\nNote that the three parameters necessary to transfer tokens are now on top of the stack and in the right order:")]),t._v(" "),s("ol",[s("li",[t._v("The parameter expected for the address ("),s("code",[t._v("unit")]),t._v(" for implicit accounts)")]),t._v(" "),s("li",[t._v("The amount to be sent in "),s("code",[t._v("mutez")])]),t._v(" "),s("li",[t._v("The receiver's address converted to a value of type "),s("code",[t._v("(contract param)")])])]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("TRANSFER_TOKENS")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value  ")]),s("th",[t._v("type                                          ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("amount: '5000000'\nentrypoint: default\nkind: transaction\nparameters: Unit\ntarget: tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("operation")])])])])])]),t._v(" "),s("p",[t._v("Calling the "),s("strong",[s("code",[t._v("TRANSFER_TOKENS")])]),t._v(" instruction forges a new operation. Remember that contract executions in Michelson are self-contained: they do not communicate with the outside. The execution goes from its beginning to its end and only then it is possible to send new transactions."),s("br"),t._v("\nYou can see that the value we now have on top of the stack is of type "),s("code",[t._v("operation")]),t._v(" and contains all the information we previously added to the stack: the amount to be sent, the entrypoint to call ("),s("code",[t._v("default")]),t._v(" by default or in case of a transaction to an implicit account), the operation kind, the parameters ("),s("code",[t._v("unit")]),t._v(" for transactions to implicit accounts) and the target address. The only thing left now is to add this operation to the list of operations returned at the end of the contract.")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("NIL")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token class-name"},[t._v("operation")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("SWAP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("CONS")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("DUMP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("NIL: push [];\nSWAP: pop [], <send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>; push []; push <send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>;\nCONS: pop <send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>, []; push ['<send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>'];")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value  ")]),s("th",[t._v("type                                               ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("- amount: '5000000'\n  entrypoint: default\n  kind: transaction\n  parameters: Unit\n  target: tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("list operation")])])])])])]),t._v(" "),s("p",[t._v("Are you excited about finally using that list of operations we have been returning empty so far? ðŸ˜…")]),t._v(" "),s("p",[t._v("In order to include the operation into the list of operations, you add an empty list as usual with "),s("code",[t._v("NIL operation")]),t._v(", you use "),s("strong",[s("code",[t._v("SWAP")])]),t._v(" because the element to add to the list must be just above in the stack and you call the "),s("strong",[s("code",[t._v("CONS")])]),t._v(" instruction which prepends the value to the list. Now you can return the pair with the list of operations and the storage:")]),t._v(" "),s("div",{staticClass:"language-Michelson extra-class"},[s("pre",{staticClass:"language-Michelson"},[s("code",{staticClass:"language-Michelson"},[s("span",{staticClass:"token operator"},[t._v("UNIT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("SWAP")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token operator"},[t._v("PAIR")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")]),s("span",{staticClass:"token keyword"},[t._v("COMMIT")]),s("span",{staticClass:"token punctuation"},[t._v(" ")]),s("span",{staticClass:"token punctuation"},[t._v(";")]),s("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),s("div",{staticClass:"stdout"},[s("pre",[s("span",{staticClass:"stream-name"},[t._v("stdout")]),s("br"),t._v("UNIT: push Unit;\nSWAP: pop Unit, ['<send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>']; push Unit; push ['<send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>'];\nPAIR: pop ['<send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>'], Unit; push (['<send 5000000 to tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb>'], Unit);\nCOMMIT:")])]),t._v(" "),s("div",{staticClass:"embedded-html"},[s("table",[s("thead",[s("tr",[s("th",[t._v("value                                    ")]),s("th",[t._v("type                                     ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("Unit")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("unit")])])])])]),s("br"),s("table",[s("thead",[s("tr",[s("th",[t._v("kind                                            ")]),s("th",[t._v("target                                                                   ")]),s("th",[t._v("amount                                      ")]),s("th",[t._v("entrypoint                                  ")]),s("th",[t._v("parameters                               ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("transaction")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("5000000")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("default")])]),s("td",[s("pre",{staticStyle:{"text-align":"left"}},[t._v("Unit")])])])])])]),t._v(" "),s("p",[t._v("Nothing groundbreaking here, we push a new "),s("code",[t._v("unit")]),t._v(" on top of the stack, we use "),s("strong",[s("code",[t._v("SWAP")])]),t._v(" because the list of operations must be on the left of the pair and then "),s("strong",[s("code",[t._v("PAIR")])]),t._v(".")]),t._v(" "),s("Binder",{attrs:{filepath:"notebooks/tutorials/05/05_mutez_timestamp_amount_balance_now.ipynb"}})],1)}),[],!1,null,null,null);a.default=e.exports}}]);