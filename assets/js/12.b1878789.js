(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{376:function(t,s,a){"use strict";a.r(s);var n=a(43),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"chapter-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter-3"}},[t._v("#")]),t._v(" Chapter 3")]),t._v(" "),a("p",[t._v("This chapter introduces conditional structures, fail operators and some useful macros to use in your Michelson code.")]),t._v(" "),a("p",[t._v("It is always crucial in your smart contracts to compare values with each other. You may want to make sure that your users send the values your contract is expecting, that a value exists, that the amount sent by your users is sufficient or that the initiator of the transaction has the right to access some part of your code.")]),t._v(" "),a("p",[t._v("Like a lot of other languages, Michelson offers conditional structures that will allow you to compare values together and execute code depending on the result of the comparison of these values.")]),t._v(" "),a("p",[t._v("As you may expect, the instructions involved in these comparisons will look a lot like what you will find in high-level programming languages, with some very specific constraints and considerations due to the low-level nature of Michelson.")]),t._v(" "),a("p",[t._v("In this chapter, we are not going to write a full functional smart contract but manipulate the stack by sending instructions. You will notice that some code snippets start with the "),a("strong",[a("code",[t._v("DROP")])]),t._v(" instruction which function will simply be to remove the element created by the previous instruction from the stack and start with a clean stack. It is not involved in the functionalities that are presented.")]),t._v(" "),a("h2",{attrs:{id:"compare-and-generic-comparisons"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compare-and-generic-comparisons"}},[t._v("#")]),t._v(" Compare and generic comparisons")]),t._v(" "),a("p",[t._v("As usual, let's declare the storage and parameter type and initialize the smart contract:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token keyword"},[t._v("storage")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token keyword"},[t._v("parameter")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("storage int;\nparameter int;")])]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token keyword"},[t._v("BEGIN")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("3")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                        ")]),a("th",[t._v("type                                             ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("Pair 3 4")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("pair int int")])])])])])]),t._v(" "),a("p",[t._v("Now it's time to play with our stack!"),a("br"),t._v("\nThe following line is more of a refresher about basic instructions to extract the parameter and the storage."),a("br"),t._v("\nNotice the keyword after "),a("strong",[a("code",[t._v("CAR")])]),t._v(" and "),a("strong",[a("code",[t._v("CDR")])]),t._v("? It is an "),a("em",[t._v("annotation")]),t._v(", you can use it to track different values in the stack and see how they move:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DUP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("CAR")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token attr-name"},[t._v("@param")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("SWAP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("CDR")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token attr-name"},[t._v("@storage")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token keyword"},[t._v("DUMP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DUP: push (3, 4);\nCAR: pop (3, 4); push 3;\nSWAP: pop 3, (3, 4); push 3; push (3, 4);\nCDR: pop (3, 4); push 4;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                 ")]),a("th",[t._v("type                                    ")]),a("th",[t._v("name                                         ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("4")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("int")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("@storage")])])]),t._v(" "),a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("3")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("int")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("@param")])])])])])]),t._v(" "),a("p",[t._v("Let's introduce our first comparison instruction!"),a("br"),t._v(" "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" is an instruction that compares two values and returns a value that can only be "),a("code",[t._v("-1")]),t._v(", "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("1")]),t._v(". This is how it works:")]),t._v(" "),a("ol",[a("li",[a("strong",[a("code",[t._v("COMPARE")])]),t._v(" takes the two elements currently at the top out of the stack. These two elements "),a("strong",[t._v("must")]),t._v(" be both of a comparable type and of the same type.")]),t._v(" "),a("li",[t._v("The two elements are compared against each other. The comparison will yield one of the three values below:\n"),a("ul",[a("li",[t._v("If the two elements are equal, the result is "),a("code",[t._v("int 0")]),t._v(".")]),t._v(" "),a("li",[t._v("If the first element is greater than the second one, the result is "),a("code",[t._v("int 1")]),t._v(".")]),t._v(" "),a("li",[t._v("If the second element is greater than the first one, the result is "),a("code",[t._v("int -1")]),t._v(".")])])]),t._v(" "),a("li",[t._v("The result is pushed onto the stack.")])]),t._v(" "),a("p",[t._v("Observe the effect of "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" below. After the instruction is run, the two integer values that were in the stack are gone and an element of type "),a("code",[t._v("int")]),t._v(" containing the value "),a("code",[t._v("1")]),t._v(" is present ("),a("code",[t._v("1")]),t._v(" indicates that "),a("code",[t._v("4")]),t._v(" is greater than "),a("code",[t._v("3")]),t._v(", which is the case):")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("COMPARE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token keyword"},[t._v("DUMP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                 ")]),a("th",[t._v("type                                    ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("1")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("int")])])])])])]),t._v(" "),a("p",[t._v("In the next snippet, we clean up our stack to start from fresh!"),a("br"),t._v("\nLet's check what happens when the values we used above are reversed. Remember that the values are stacked one above the other, so pushing "),a("code",[t._v("4")]),t._v(" then "),a("code",[t._v("3")]),t._v(" means that "),a("code",[t._v("4")]),t._v(" is the second element and "),a("code",[t._v("3")]),t._v(" the first:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("3")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("COMPARE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop 1;\nPUSH: push 4;\nPUSH: push 3;\nCOMPARE: pop 3, 4; push -1;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                  ")]),a("th",[t._v("type                                    ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("-1")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("int")])])])])])]),t._v(" "),a("p",[t._v("The result is "),a("code",[t._v("-1")]),t._v(", which indicates that the first element is less than the second one.")]),t._v(" "),a("p",[t._v('Now, you may be wondering: "getting '),a("code",[t._v("1")]),t._v(", "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("-1")]),t._v(' from the comparison is cool, but what to do with that value?" This is exactly what we are going to see! We can use the value returned by '),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" and get a boolean value out of it."),a("br"),t._v("\nThe "),a("strong",[a("code",[t._v("EQ")])]),t._v(" instruction checks the value on top of the stack. If the value is equal to "),a("code",[t._v("int 0")]),t._v(", "),a("strong",[a("code",[t._v("EQ")])]),t._v(" returns "),a("code",[t._v("true")]),t._v(". Otherwise, it returns "),a("code",[t._v("false")]),t._v(". This is exactly what we need to verify whether our two values are equal or not:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("3")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("COMPARE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("EQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop -1;\nPUSH: push 4;\nPUSH: push 3;\nCOMPARE: pop 3, 4; push -1;\nEQ: pop -1; push False;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                     ")]),a("th",[t._v("type                                     ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("False")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("bool")])])])])])]),t._v(" "),a("p",[t._v("Let's detail the different steps of the code snippet above:")]),t._v(" "),a("ol",[a("li",[t._v("We add an element on top of the stack of type "),a("code",[t._v("int")]),t._v(" with the value "),a("code",[t._v("4")]),t._v(".")]),t._v(" "),a("li",[t._v("We add another element on top of the previous one of type "),a("code",[t._v("int")]),t._v(" with the value "),a("code",[t._v("3")]),t._v(".")]),t._v(" "),a("li",[t._v("We use the "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" instruction. It removes the two elements on the stack. "),a("code",[t._v("3")]),t._v(" is less than "),a("code",[t._v("4")]),t._v(", so "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("int -1")]),t._v(" and pushes this new value on our empty stack.")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("EQ")])]),t._v(" checks the first (and only) element in the stack. It is not equal to "),a("code",[t._v("0")]),t._v(", so it returns false.")])]),t._v(" "),a("p",[t._v("Now let's see what happens if we use two equal values:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("COMPARE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("EQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop False;\nPUSH: push 4;\nPUSH: push 4;\nCOMPARE: pop 4, 4; push 0;\nEQ: pop 0; push True;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                    ")]),a("th",[t._v("type                                     ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("True")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("bool")])])])])])]),t._v(" "),a("p",[t._v("As expected, "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("0")]),t._v(" because the two values are identical and "),a("strong",[a("code",[t._v("EQ")])]),t._v(" turns the "),a("code",[t._v("0")]),t._v(" in the stack into the boolean value "),a("code",[t._v("True")]),t._v(".")]),t._v(" "),a("p",[t._v("What about checking if the two values are NOT equal? There is an instruction for that too! You can use "),a("strong",[a("code",[t._v("NEQ")])]),t._v(" in the same way to return "),a("code",[t._v("False")]),t._v(" if the two values are equal or "),a("code",[t._v("True")]),t._v(" if they are not equal:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("3")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("COMPARE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("NEQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop True;\nPUSH: push 3;\nPUSH: push 4;\nCOMPARE: pop 4, 3; push 1;\nNEQ: pop 1; push True;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                    ")]),a("th",[t._v("type                                     ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("True")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("bool")])])])])])]),t._v(" "),a("p",[t._v("There are a few other instructions you can use like "),a("strong",[a("code",[t._v("EQ")])]),t._v(" or "),a("strong",[a("code",[t._v("NEQ")])]),t._v(" to check the value returned by "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("strong",[a("code",[t._v("LT")])]),t._v(": checks if the value is less than "),a("code",[t._v("0")]),t._v(", "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("-1")]),t._v(" if the first element is less than the second, using "),a("strong",[a("code",[t._v("LT")])]),t._v(" will return "),a("code",[t._v("True")]),t._v(" if "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("-1")]),t._v(".")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("GT")])]),t._v(": checks if the value is greater than "),a("code",[t._v("0")]),t._v(", "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("1")]),t._v(" if the first element is greater than the second, using "),a("strong",[a("code",[t._v("GT")])]),t._v(" will return "),a("code",[t._v("True")]),t._v(" if "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("1")]),t._v(".")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("LE")])]),t._v(": checks if the value is equal or less than "),a("code",[t._v("0")]),t._v(", "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("-1")]),t._v(" if the first element is equal or less than the second, using "),a("strong",[a("code",[t._v("LE")])]),t._v(" will return "),a("code",[t._v("True")]),t._v(" if "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("-1")]),t._v(".")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("GE")])]),t._v(": checks if the value is equal or greater than "),a("code",[t._v("0")]),t._v(", "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("1")]),t._v(" if the first element is equal or greater than the second, using "),a("strong",[a("code",[t._v("GE")])]),t._v(" will return "),a("code",[t._v("True")]),t._v(" if "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" returns "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("1")]),t._v(".")])]),t._v(" "),a("p",[t._v("Writing two instructions one after the other and remembering that "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" will return "),a("code",[t._v("-1")]),t._v(", "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("1")]),t._v(" that you can then use with another instruction can seem a bit tedious. Michelson knows you want to do more and write less, so it provides useful macros that group instructions together in one single instruction ðŸ˜‰"),a("br"),t._v("\nFor example, instead of writing "),a("strong",[a("code",[t._v("COMPARE ; EQ ;")])]),t._v(", you can use "),a("strong",[a("code",[t._v("CMPEQ")])]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token variable"},[t._v("CMPEQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop True;\nPUSH: push 4;\nPUSH: push 4;\nCOMPARE: pop 4, 4; push 0;\nEQ: pop 0; push True;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                    ")]),a("th",[t._v("type                                     ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("True")])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("bool")])])])])])]),t._v(" "),a("p",[t._v("As you can see, it does exactly the same thing as two code snippets above. You can use any of these macros by using the "),a("strong",[a("code",[t._v("CMP")])]),t._v(" prefix followed by one of the instructions listed above: "),a("strong",[a("code",[t._v("CMPEQ")])]),t._v(", "),a("strong",[a("code",[t._v("CMPNEQ")])]),t._v(", "),a("strong",[a("code",[t._v("CMPLT")])]),t._v(", "),a("strong",[a("code",[t._v("CMPGT")])]),t._v(", "),a("strong",[a("code",[t._v("CMPLE")])]),t._v(", "),a("strong",[a("code",[t._v("CMPGE")])]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"conditionals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conditionals"}},[t._v("#")]),t._v(" Conditionals")]),t._v(" "),a("p",[t._v("Now, let's get things a little further. What about running a piece of code only if a "),a("strong",[a("code",[t._v("CMP{EQ|NEQ|LT|GT|LE|GE}")])]),t._v(" instruction returns true or false? In a lot of other programming languages, the "),a("strong",[a("code",[t._v("IF")])]),t._v(" keyword is used to check if a condition is met and run code accordingly. This is also the case in Michelson. However, when using "),a("strong",[a("code",[t._v("IF")])]),t._v(" in Michelson, you have to keep in mind that you "),a("em",[t._v("must")]),t._v(" have a boolean value in the top element of the stack. Michelson doesn't take shortcuts and only boolean values evaluate to "),a("code",[t._v("True")]),t._v(" or "),a("code",[t._v("False")]),t._v(', there are no "truthy" or "falsy" values.')]),t._v(" "),a("p",[t._v("Here is an example (remember that we have "),a("code",[t._v("True")]),t._v(" on top of the stack from the previous example):")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("IF")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"Is true"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"Is false"')]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("IF: pop True;\n  PUSH: push Is true;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                         ")]),a("th",[t._v("type                                       ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v('"Is true"')])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("string")])])])])])]),t._v(" "),a("p",[t._v("This is obviously a very naive example, but it showcases well what the "),a("strong",[a("code",[t._v("IF")])]),t._v(" instruction does in Michelson: it takes the element of type "),a("code",[t._v("bool")]),t._v(" from the top of the stack and evaluates it. If the element is "),a("code",[t._v("True")]),t._v(", it will execute the code in the first block delimited by curly braces. If the element is "),a("code",[t._v("False")]),t._v(", it will execute the code in the second block.")]),t._v(" "),a("p",[t._v("Here is a full example to follow what happens step-by-step:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("DUP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("COMPARE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("EQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("IF")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"It\'s equal :)"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"It is not equal :("')]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("PUSH: push 4;\nDUP: push 4;\nCOMPARE: pop 4, 4; push 0;\nEQ: pop 0; push True;\nIF: pop True;\n  PUSH: push It's equal :);")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                               ")]),a("th",[t._v("type                                       ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v('"It\'s equal :)"')])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("string")])])])])])]),t._v(" "),a("p",[t._v("Let's detail the magic happening in the code above:")]),t._v(" "),a("ol",[a("li",[a("strong",[a("code",[t._v("PUSH int 4 ; DUP ;")])]),t._v(": pushes 1 integer on top of the stack and duplicates it to have the same value.")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("COMPARE")])]),t._v(": checks if the values are equal or not and returns the result as an integer with a value between "),a("code",[t._v("-1")]),t._v(" and "),a("code",[t._v("1")]),t._v(".")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("EQ")])]),t._v(": checks the value at the top of the stack and verifies if it is equal to "),a("code",[t._v("0")]),t._v(". If it is, it returns "),a("code",[t._v("True")]),t._v(", otherwise, it returns "),a("code",[t._v("False")]),t._v(".")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("IF")])]),t._v(": checks the boolean value on top of the stack and runs specific code accordingly. If the value is "),a("code",[t._v("True")]),t._v(", the first block between curly braces is run. If it is "),a("code",[t._v("False")]),t._v(", the second one is run.")])]),t._v(" "),a("p",[t._v("You already know by now that Michelson doesn't want you to type a long series of instructions just to check if two integers are of the same value ðŸ˜œ You remember how it was possible to crush "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(" and "),a("strong",[a("code",[t._v("EQ")])]),t._v(" together to get "),a("strong",[a("code",[t._v("CMPEQ")])]),t._v("? It is also possible with "),a("strong",[a("code",[t._v("COMPARE")])]),t._v(", "),a("strong",[a("code",[t._v("EQ")])]),t._v(" and "),a("strong",[a("code",[t._v("IF")])]),t._v("!")]),t._v(" "),a("p",[t._v("Let's see how that would work:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("DUP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token variable"},[t._v("IFCMPEQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"It\'s equal :)"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"It is not equal :("')]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop It's equal :);\nPUSH: push 4;\nDUP: push 4;\nCOMPARE: pop 4, 4; push 0;\nEQ: pop 0; push True;\nIF: pop True;\n  PUSH: push It's equal :);")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                               ")]),a("th",[t._v("type                                       ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v('"It\'s equal :)"')])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("string")])])])])])]),t._v(" "),a("p",[t._v("You must admit that this is a lot shorter and simpler! After pushing the two integers on top of the stack, we use the "),a("strong",[a("code",[t._v("IFCMPEQ")])]),t._v(" instruction to check if the two values are equal and run some code according to the result. You can also use any of the following combinations: "),a("strong",[a("code",[t._v("IFCMP{EQ|NEQ|LT|GT|LE|GE}")])]),t._v(".")]),t._v(" "),a("p",[t._v("We have been using integers since the beginning to demonstrate how comparisons and conditionals work in Michelson, but you can actually use any comparable type of value. For example, you can also verify whether two strings are the same:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"hello world"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"hell0 world"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token variable"},[t._v("IFCMPEQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"It\'s the same string :)"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"It is not the same string :("')]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop It's equal :);\nPUSH: push hello world;\nPUSH: push hell0 world;\nCOMPARE: pop hell0 world, hello world; push -1;\nEQ: pop -1; push False;\nIF: pop False;\n  PUSH: push It is not the same string :(;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                                              ")]),a("th",[t._v("type                                       ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v('"It is not the same string :("')])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("string")])])])])])]),t._v(" "),a("h2",{attrs:{id:"fail-and-assert"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fail-and-assert"}},[t._v("#")]),t._v(" FAIL and ASSERT")]),t._v(" "),a("p",[t._v('In a real-world smart contract, you want to protect the data saved into the storage from attackers or from undesirable behaviors. If you create the next big token on Tezos, you must make sure the funds stored in your contract are safe. In some cases, you want a kind of "circuit breaker" that will just abort the current execution of the contract if something unexpected or undesirable happens. This will be the job of two macros: '),a("strong",[a("code",[t._v("FAIL")])]),t._v(" and "),a("strong",[a("code",[t._v("ASSERT")])]),t._v(".")]),t._v(" "),a("p",[t._v("Every time your contract will meet a "),a("strong",[a("code",[t._v("FAIL")])]),t._v(" macro, the execution of the contract will stop and an exception will be thrown with a "),a("code",[t._v("unit")]),t._v(" value as an argument. Nothing is returned (more accurately, a "),a("code",[t._v("unit")]),t._v(" is returned, which is nothing in practice), nothing is changed:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("5")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token variable"},[t._v("IFCMPEQ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"Same number!"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token variable"},[t._v("FAIL")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop It's the same string :);\nPUSH: push 4;\nPUSH: push 5;\nCOMPARE: pop 5, 4; push 1;\nEQ: pop 1; push False;\nIF: pop False;\n  UNIT: push Unit;\n  FAILWITH: pop Unit;")])]),t._v(" "),a("div",{staticClass:"stderr"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stderr")]),a("br"),t._v("MichelsonRuntimeError: Unit\nat IF -> FAILWITH")])]),t._v(" "),a("p",[t._v("You can see that "),a("strong",[a("code",[t._v("IFCMPEQ")])]),t._v(" is going to check whether "),a("code",[t._v("4")]),t._v(" is equal to "),a("code",[t._v("5")]),t._v(". As it is not the case, the second code block will be executed, the one containing "),a("strong",[a("code",[t._v("FAIL")])]),t._v(". The contract raises a "),a("code",[t._v("MichelsonRuntimeError")]),t._v(" followed by the unit returned after "),a("strong",[a("code",[t._v("FAIL")])]),t._v(". The execution is stopped and nothing happens.")]),t._v(" "),a("p",[t._v("The "),a("strong",[a("code",[t._v("IF")])]),t._v(" instruction allows to check the result of the comparison of two values of the same type. However, in Michelson, we also have a special type of value called an "),a("code",[t._v("option")]),t._v(". This value can be "),a("code",[t._v("(Some value)")]),t._v(" if there is a value or "),a("code",[t._v("None")]),t._v(" if there is no value. In some cases, you are going to make operations that will push an option on top of the stack. You want then to verify if the option has a value ("),a("code",[t._v("Some")]),t._v(") or is empty ("),a("code",[t._v("None")]),t._v(")."),a("br"),t._v("\nTo this purpose, you can use a special instruction: "),a("strong",[a("code",[t._v("IF_NONE")])]),t._v(". "),a("strong",[a("code",[t._v("IF_NONE")])]),t._v(" takes the top element of the stack out (it must be of type "),a("code",[t._v("option")]),t._v(" though) and will execute the first code block if the value is equal to "),a("code",[t._v("None")]),t._v(". Otherwise, it will exectute the second code block. Note that if the value is equal to "),a("code",[t._v("(Some value)")]),t._v(", the "),a("code",[t._v("value")]),t._v(" between parentheses will be pushed on to the stack.")]),t._v(" "),a("p",[t._v("Here is what happens if the value on top of the stack is "),a("strong",[a("code",[t._v("None")])]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("(")]),a("span",{staticClass:"token class-name"},[t._v("option")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(")")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("None")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("IF_NONE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"No value!"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token variable"},[t._v("FAIL")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop 4;\nPUSH: push None;\nIF_NONE: pop None;\n  PUSH: push No value!;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                           ")]),a("th",[t._v("type                                       ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v('"No value!"')])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("string")])])])])])]),t._v(" "),a("p",[t._v("Now this is what happens if there is "),a("strong",[a("code",[t._v("(Some value)")])]),t._v(" on top of the stack:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("(")]),a("span",{staticClass:"token class-name"},[t._v("option")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(")")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("(")]),a("span",{staticClass:"token number"},[t._v("Some")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"hello world"')]),a("span",{staticClass:"token punctuation"},[t._v(")")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("IF_NONE")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token variable"},[t._v("FAIL")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop No value!;\nPUSH: push ('hello world',);\nIF_NONE: pop ('hello world',); push hello world;")])]),t._v(" "),a("div",{staticClass:"embedded-html"},[a("table",[a("thead",[a("tr",[a("th",[t._v("value                                             ")]),a("th",[t._v("type                                       ")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v('"hello world"')])]),a("td",[a("pre",{staticStyle:{"text-align":"left"}},[t._v("string")])])])])])]),t._v(" "),a("p",[t._v("You can now see that the string that was wrapped in the "),a("code",[t._v("(Some value)")]),t._v(" is at the top of the stack.")]),t._v(" "),a("p",[t._v("What if I told you that there is another shortcut to check the value present at the top of the stack? The "),a("strong",[a("code",[t._v("ASSERT")])]),t._v(" instruction!"),a("br"),t._v(" "),a("strong",[a("code",[t._v("ASSERT")])]),t._v(" expects a boolean value and under the hood, it is a macro for "),a("strong",[a("code",[t._v("IF { } { FAIL }")])]),t._v(". You probably understand this last code by now: if the boolean value is "),a("code",[t._v("True")]),t._v(", the code will just continue its execution. If it is "),a("code",[t._v("False")]),t._v(", it will fail and return nothing."),a("br"),t._v("\nHere is a simple example:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("DROP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("bool")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("True")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token variable"},[t._v("ASSERT")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("DROP: pop hello world;\nPUSH: push True;\nIF: pop True;")])]),t._v(" "),a("p",[t._v("As you can see, the contract pushes a boolean value equal to "),a("code",[t._v("True")]),t._v(" on top of the stack. "),a("strong",[a("code",[t._v("ASSERT")])]),t._v(" will then check this value and because it is "),a("code",[t._v("True")]),t._v(", the contract doesn't fail and continue its execution.")]),t._v(" "),a("p",[t._v("Now we can take the power of "),a("strong",[a("code",[t._v("ASSERT")])]),t._v(" even further and extend its capabilities with other macros. Just like "),a("strong",[a("code",[t._v("IF")])]),t._v(", you can use comparison instructions if you want to use other types but booleans."),a("br"),t._v("\nLet's check how "),a("strong",[a("code",[t._v("ASSERT_CMPEQ")])]),t._v(" would work:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("4")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("5")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token variable"},[t._v("ASSERT_CMPEQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("PUSH: push 4;\nPUSH: push 5;\nCOMPARE: pop 5, 4; push 1;\nEQ: pop 1; push False;\nIF: pop False;\n  UNIT: push Unit;\n  FAILWITH: pop Unit;")])]),t._v(" "),a("div",{staticClass:"stderr"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stderr")]),a("br"),t._v("MichelsonRuntimeError: Unit\nat IF -> FAILWITH")])]),t._v(" "),a("p",[t._v("The code above pushes two integers on top of the stack, compares them against each other and returns "),a("code",[t._v("-1")]),t._v(", "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("1")]),t._v(", checks if the returned value is equal to zero or not and returns a boolean value, then finally, checks if the boolean value is "),a("code",[t._v("true")]),t._v(" or "),a("code",[t._v("false")]),t._v(".")]),t._v(" "),a("p",[t._v("Now if you use two values that are actually equal, you will see no runtime error:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("5")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("int")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("5")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token variable"},[t._v("ASSERT_CMPEQ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("PUSH: push 5;\nPUSH: push 5;\nCOMPARE: pop 5, 5; push 0;\nEQ: pop 0; push True;\nIF: pop True;")])]),t._v(" "),a("p",[t._v("To finish with this chapter packed with new information, let's see another way of making your contracts fail."),a("br"),t._v("\nUntil now, we have used the "),a("strong",[a("code",[t._v("FAIL")])]),t._v(" instruction. If you remember, it stops everything and returns nothing or more precisely, it returns a unit. Actually, "),a("strong",[a("code",[t._v("FAIL")])]),t._v(" is also a macro and replaces "),a("code",[t._v("UNIT ; FAILWITH ;")]),t._v(". The "),a("strong",[a("code",[t._v("FAILWITH")])]),t._v(" instruction is also going to make your contract fail but it will return whatever value is at the top of the stack at this moment. This can be a good solution if you would like to return an error message!")]),t._v(" "),a("p",[t._v("Check the example below:")]),t._v(" "),a("div",{staticClass:"language-Michelson extra-class"},[a("pre",{staticClass:"language-Michelson"},[a("code",{staticClass:"language-Michelson"},[a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("bool")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v("False")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token operator"},[t._v("IF")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"Is true!"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("{")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("PUSH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token class-name"},[t._v("string")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token number"},[t._v('"Is false!"')]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token operator"},[t._v("FAILWITH")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v("}")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")]),a("span",{staticClass:"token keyword"},[t._v("DUMP")]),a("span",{staticClass:"token punctuation"},[t._v(" ")]),a("span",{staticClass:"token punctuation"},[t._v(";")]),a("span",{staticClass:"token punctuation"},[t._v("\n")])])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("PUSH: push False;\nIF: pop False;\n  PUSH: push Is false!;\n  FAILWITH: pop Is false!;")])]),t._v(" "),a("div",{staticClass:"stderr"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stderr")]),a("br"),t._v("MichelsonRuntimeError: Is false!\nat IF -> FAILWITH")])]),t._v(" "),a("p",[t._v("As you can see in the red runtime error box, the error message "),a("em",[t._v("Is false!")]),t._v(" has been returned instead of "),a("em",[t._v("Unit")]),t._v(" as it was the case in the previous error messages.")]),t._v(" "),a("h2",{attrs:{id:"recap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#recap"}},[t._v("#")]),t._v(" Recap")]),t._v(" "),a("p",[t._v("This chapter was a bit lengthy but it introduces fundamental concepts to write Michelson smart contracts: comparisons, conditions and fails."),a("br"),t._v("\nWith these tools, you can write safer, more robust and more complex contracts that can analyze the data you feed them, run specific code according to the data they receive and fail if they encounter an unexpected situation. Sure, it seems trivial to compare "),a("code",[t._v("5")]),t._v(" and "),a("code",[t._v("4")]),t._v(" or to push "),a("code",[t._v("True")]),t._v(" before running "),a("code",[t._v("IF")]),t._v(", but in a real-life scenario, you may want to compare the balance of your users with their withdrawal request before sending them money or verify if a certain user is allowed to withdraw money from a certain account!")]),t._v(" "),a("Binder",{attrs:{filepath:"notebooks/tutorials/03/03_conditional_fail_macro.ipynb"}})],1)}),[],!1,null,null,null);s.default=e.exports}}]);